<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="David Hobach" />
  <title>blib Code Reference v1.4</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <style type="text/css">body {
border-left: 1px solid black;
border-right: 1px solid black;
padding-right: 1em;
padding-left: 1em;
font-family: Verdana, sans-serif;
font-size: 100%;
line-height: 140%;
position: relative;
top: 0;
left: 300px;
width: calc(97% - 311px);
margin-left: 11px;
z-index: -1;
}
pre {
border: 1px dotted gray;
background-color: #ececec;
padding: 0.5em;
}
code {
font-family: monospace;
}
a:link, a:visited, a:hover, a:active {
text-decoration-style: dotted;
color: #9000ff; }
h4, h5, h6 {
margin-bottom: 0;
padding-bottom: 0;
}
h4+p, h5+p, h6+p {
margin-top:0;
padding-top: 0;
}
h1 a, h2 a, h3 a, h4 a, h5 a, h6 a { text-decoration: none;
color: #7a5ada; }
h1, h2, h3, h4, h5, h6 { font-weight: bold;
border-bottom: 1px dotted black;
color: #7a5ada;
}
h1, h2 {
font-size: 130%;
}
h3 {
font-size: 110%;
}
h4 {
font-size: 95%;
}
h5 {
font-size: 90%;
font-style: italic;
}
h6 {
font-size: 85%;
font-style: italic;
}
h1.title {
font-size: 200%;
font-weight: bold;
padding-top: 0.2em;
padding-bottom: 0.2em;
text-align: left;
border: none;
}
dt code {
font-weight: bold;
}
dd p {
margin-top: 0;
}
table {
border-collapse: collapse;
width: 100%;
}
table td, table th {
border: 1px solid #ddd;
padding: 5px 8px 5px 8px;
}
table tr:nth-child(even) {
background-color: #f8f8f8;
}
table th {
padding-top: 8px;
padding-bottom: 8px;
background-color: #cc99ff;
color: white;
}
#reflist {
margin-left: 0;
padding-left:10px;
position: fixed;
top: 0;
left: 0;
width: 300px;
height: 100%;
overflow: auto;
z-index: 1;
background-color: white;
}
#reflist p {
margin: 0;
font-size: 80%;
}
.author {
display: none;
}
.par, .ann, .ret {
display: block;
}
.par {
margin-left: 2em;
background-color: #ebf5fb;
}
</style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">blib Code Reference v1.4</h1>
<p class="author">David Hobach</p>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#blib">blib</a>
<ul>
<li><a href="#disclaimer">Disclaimer</a></li>
<li><a href="#coding-conventions">Coding Conventions</a></li>
<li><a href="#library-usage">Library Usage</a></li>
<li><a href="#dependencies">Dependencies</a></li>
<li><a href="#imports">Imports</a></li>
<li><a href="#global-variables">Global Variables</a></li>
<li><a href="#global-aliases">Global Aliases</a></li>
<li><a href="#functions">Functions</a></li>
</ul></li>
<li><a href="#args">args</a>
<ul>
<li><a href="#dependencies-1">Dependencies</a></li>
<li><a href="#imports-1">Imports</a></li>
<li><a href="#global-variables-1">Global Variables</a></li>
<li><a href="#functions-1">Functions</a></li>
</ul></li>
<li><a href="#arr">arr</a>
<ul>
<li><a href="#dependencies-2">Dependencies</a></li>
<li><a href="#imports-2">Imports</a></li>
<li><a href="#functions-2">Functions</a></li>
</ul></li>
<li><a href="#cdoc">cdoc</a>
<ul>
<li><a href="#dependencies-3">Dependencies</a></li>
<li><a href="#imports-3">Imports</a></li>
<li><a href="#functions-3">Functions</a></li>
</ul></li>
<li><a href="#daemon">daemon</a>
<ul>
<li><a href="#dependencies-4">Dependencies</a></li>
<li><a href="#imports-4">Imports</a></li>
<li><a href="#global-variables-2">Global Variables</a></li>
<li><a href="#functions-4">Functions</a></li>
</ul></li>
<li><a href="#date">date</a>
<ul>
<li><a href="#dependencies-5">Dependencies</a></li>
<li><a href="#imports-5">Imports</a></li>
<li><a href="#functions-5">Functions</a></li>
</ul></li>
<li><a href="#delay">delay</a>
<ul>
<li><a href="#dependencies-6">Dependencies</a></li>
<li><a href="#imports-6">Imports</a></li>
<li><a href="#global-variables-3">Global Variables</a></li>
<li><a href="#functions-6">Functions</a></li>
</ul></li>
<li><a href="#dmcrypt">dmcrypt</a>
<ul>
<li><a href="#dependencies-7">Dependencies</a></li>
<li><a href="#imports-7">Imports</a></li>
<li><a href="#functions-7">Functions</a></li>
</ul></li>
<li><a href="#fd">fd</a>
<ul>
<li><a href="#dependencies-8">Dependencies</a></li>
<li><a href="#imports-8">Imports</a></li>
<li><a href="#functions-8">Functions</a></li>
</ul></li>
<li><a href="#flog">flog</a>
<ul>
<li><a href="#dependencies-9">Dependencies</a></li>
<li><a href="#imports-9">Imports</a></li>
<li><a href="#global-variables-4">Global Variables</a></li>
<li><a href="#functions-9">Functions</a></li>
</ul></li>
<li><a href="#fs">fs</a>
<ul>
<li><a href="#dependencies-10">Dependencies</a></li>
<li><a href="#imports-10">Imports</a></li>
<li><a href="#functions-10">Functions</a></li>
</ul></li>
<li><a href="#hash">hash</a>
<ul>
<li><a href="#dependencies-11">Dependencies</a></li>
<li><a href="#imports-11">Imports</a></li>
<li><a href="#b_hash_file">b_hash_file [file] [algorithm]</a></li>
<li><a href="#b_hash_str">b_hash_str [string] [algorithm]</a></li>
</ul></li>
<li><a href="#http">http</a>
<ul>
<li><a href="#dependencies-12">Dependencies</a></li>
<li><a href="#imports-12">Imports</a></li>
<li><a href="#global-variables-5">Global Variables</a></li>
<li><a href="#functions-11">Functions</a></li>
</ul></li>
<li><a href="#ini">ini</a>
<ul>
<li><a href="#dependencies-13">Dependencies</a></li>
<li><a href="#imports-13">Imports</a></li>
<li><a href="#functions-12">Functions</a></li>
</ul></li>
<li><a href="#keys">keys</a>
<ul>
<li><a href="#dependencies-14">Dependencies</a></li>
<li><a href="#imports-14">Imports</a></li>
<li><a href="#functions-13">Functions</a></li>
</ul></li>
<li><a href="#meta">meta</a>
<ul>
<li><a href="#dependencies-15">Dependencies</a></li>
<li><a href="#imports-15">Imports</a></li>
<li><a href="#functions-14">Functions</a></li>
</ul></li>
<li><a href="#multithreadingipcm">multithreading/ipcm</a>
<ul>
<li><a href="#dependencies-16">Dependencies</a></li>
<li><a href="#imports-16">Imports</a></li>
<li><a href="#functions-15">Functions</a></li>
</ul></li>
<li><a href="#multithreadingipcv">multithreading/ipcv</a>
<ul>
<li><a href="#dependencies-17">Dependencies</a></li>
<li><a href="#imports-17">Imports</a></li>
<li><a href="#functions-16">Functions</a></li>
</ul></li>
<li><a href="#multithreadingmtx">multithreading/mtx</a>
<ul>
<li><a href="#dependencies-18">Dependencies</a></li>
<li><a href="#imports-18">Imports</a></li>
<li><a href="#functions-17">Functions</a></li>
</ul></li>
<li><a href="#multithreadingmultiw">multithreading/multiw</a>
<ul>
<li><a href="#dependencies-19">Dependencies</a></li>
<li><a href="#imports-19">Imports</a></li>
<li><a href="#functions-18">Functions</a></li>
</ul></li>
<li><a href="#net">net</a>
<ul>
<li><a href="#dependencies-20">Dependencies</a></li>
<li><a href="#imports-20">Imports</a></li>
<li><a href="#global-variables-6">Global Variables</a></li>
<li><a href="#functions-19">Functions</a></li>
</ul></li>
<li><a href="#notify">notify</a>
<ul>
<li><a href="#dependencies-21">Dependencies</a></li>
<li><a href="#imports-21">Imports</a></li>
<li><a href="#functions-20">Functions</a></li>
</ul></li>
<li><a href="#ososid">os/osid</a>
<ul>
<li><a href="#dependencies-22">Dependencies</a></li>
<li><a href="#imports-22">Imports</a></li>
<li><a href="#functions-21">Functions</a></li>
</ul></li>
<li><a href="#osqubes4dom0">os/qubes4/dom0</a>
<ul>
<li><a href="#dependencies-23">Dependencies</a></li>
<li><a href="#imports-23">Imports</a></li>
<li><a href="#global-variables-7">Global Variables</a></li>
<li><a href="#functions-22">Functions</a></li>
</ul></li>
<li><a href="#proc">proc</a>
<ul>
<li><a href="#dependencies-24">Dependencies</a></li>
<li><a href="#imports-24">Imports</a></li>
<li><a href="#functions-23">Functions</a></li>
</ul></li>
<li><a href="#sqlite3">sqlite3</a>
<ul>
<li><a href="#dependencies-25">Dependencies</a></li>
<li><a href="#imports-25">Imports</a></li>
<li><a href="#functions-24">Functions</a></li>
</ul></li>
<li><a href="#str">str</a>
<ul>
<li><a href="#dependencies-26">Dependencies</a></li>
<li><a href="#imports-26">Imports</a></li>
<li><a href="#functions-25">Functions</a></li>
</ul></li>
<li><a href="#tcolors">tcolors</a>
<ul>
<li><a href="#dependencies-27">Dependencies</a></li>
<li><a href="#imports-27">Imports</a></li>
<li><a href="#global-variables-8">Global Variables</a></li>
</ul></li>
<li><a href="#traps">traps</a>
<ul>
<li><a href="#dependencies-28">Dependencies</a></li>
<li><a href="#imports-28">Imports</a></li>
<li><a href="#functions-26">Functions</a></li>
</ul></li>
<li><a href="#types">types</a>
<ul>
<li><a href="#dependencies-29">Dependencies</a></li>
<li><a href="#imports-29">Imports</a></li>
<li><a href="#global-variables-9">Global Variables</a></li>
<li><a href="#functions-27">Functions</a></li>
</ul></li>
<li><a href="#ui">ui</a>
<ul>
<li><a href="#dependencies-30">Dependencies</a></li>
<li><a href="#imports-30">Imports</a></li>
<li><a href="#functions-28">Functions</a></li>
</ul></li>
<li><a href="#wm">wm</a>
<ul>
<li><a href="#dependencies-31">Dependencies</a></li>
<li><a href="#imports-31">Imports</a></li>
<li><a href="#functions-29">Functions</a></li>
</ul></li>
<li><a href="#teststest_common.bash">tests/test_common.bash</a>
<ul>
<li><a href="#dependencies-32">Dependencies</a></li>
<li><a href="#imports-32">Imports</a></li>
<li><a href="#global-variables-10">Global Variables</a></li>
<li><a href="#functions-30">Functions</a></li>
</ul></li>
<li><a href="#testsuser_test_data.bash">tests/user_test_data.bash</a>
<ul>
<li><a href="#dependencies-33">Dependencies</a></li>
<li><a href="#imports-33">Imports</a></li>
<li><a href="#global-variables-11">Global Variables</a></li>
</ul></li>
<li><a href="#reflist">Reference List</a></li>
</ul>
</nav>
<section id="blib" class="level2">
<h2>blib</h2>
<p>blib - a bash library</p>
<p>The basic functions which are imported by default.</p>
<p>Copyright (C) 2022 David Hobach LGPLv3<br />
version: Execute <code>blib version</code> or use <a href="#b_version">b_version</a>.</p>
<section id="disclaimer" class="level3">
<h3>Disclaimer</h3>
<p>This program is free software: you can redistribute it and/or modify<br />
it under the terms of the Lesser GNU General Public License as published by<br />
the Free Software Foundation, either version 3 of the License, or<br />
(at your option) any later version.</p>
<p>This program is distributed in the hope that it will be useful,<br />
but WITHOUT ANY WARRANTY; without even the implied warranty of<br />
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the<br />
Lesser GNU General Public License for more details.</p>
<p>You should have received a copy of the Lesser GNU General Public License<br />
along with this program. If not, see <a href="https://www.gnu.org/licenses/" class="uri">https://www.gnu.org/licenses/</a>.</p>
<p><strong>The above statements apply to all modules of blib if not mentioned otherwise.</strong></p>
</section>
<section id="coding-conventions" class="level3">
<h3>Coding Conventions</h3>
<ol>
<li>embrace the KISS principle</li>
<li>some general guidelines: <a href="http://www.kfirlavi.com/blog/2012/11/14/defensive-bash-programming/" class="uri">http://www.kfirlavi.com/blog/2012/11/14/defensive-bash-programming/</a></li>
<li>use b_[module]_[camel case function name] to denote functions meant to be used by users of the library, B_[module]_[upper case var name] for global variables</li>
<li>use BLIB_[module]_[upper case var name] for global variables (to be avoided whenever possible) not meant to be used by library users (“private” variables); library users can use setters or getters</li>
<li>use the BLIB_STORE with the above naming conventions for “private” variables whenever possible</li>
<li>use blib_[module]_[camel case function name] to denote private functions not meant to be used by library users; the function name should not contain any underscores</li>
<li>the blib module itself is the only exception which can use b_, B_, blib_, BLIB_ without module name</li>
<li>prefixes such as t_, T_ and UTD_ are exclusively related to test code</li>
<li>set exit codes (!= 0 –&gt; issue) wherever it makes sense</li>
<li>keep the global namespace clean whenever possible</li>
<li>declare -g must be used in order to allow sourcing from a function (<a href="#b_import">b_import</a>)</li>
<li>modules must check their dependencies via <a href="#b_deps">b_deps</a></li>
<li>modules should provide a header similar to that of the blib source file in order to make the documentation generation work</li>
<li>modules may be placed in subfolders of arbitrary depth</li>
<li>use 0 to indicate true and 1 to indicate false for variables; for exit codes use a non-zero exit code to indicate the number of errors</li>
<li>functions should be tagged with the following tags, if applicable:<br />
<em><span class="citation" data-cites="StateChanging">@StateChanging</span></em> - the function changes the internal state of the script in a way that will not propagate to supershells (e.g. global variables) and should thus not be called from subshells (unless the user wants the state to only change in that shell)<br />
<em><span class="citation" data-cites="B_E">@B_E</span></em> - the function uses <a href="#B_E">B_E</a> for error handling and may thus behave differently depending on the implemented error handler</li>
</ol>
</section>
<section id="library-usage" class="level3">
<h3>Library Usage</h3>
<p>with the default bash options:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a> <span class="bu">source</span> blib</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a> <span class="ex">b_checkVersion</span> 1 0 <span class="kw">||</span> <span class="kw">{</span> <span class="op">&gt;&amp;2</span> <span class="bu">echo</span> <span class="st">&quot;This script depends on blib (https://github.com/3hhh/blib) version 1.0 or higher. Please install a supported version.&quot;</span> <span class="kw">;</span> <span class="bu">exit</span> 1 <span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a> <span class="ex">b_import</span> [module]</span></code></pre></div>
</section>
<section id="dependencies" class="level3">
<h3>Dependencies</h3>
<p>bats<br />
cat<br />
dirname<br />
find<br />
mktemp<br />
mv<br />
readlink<br />
rm<br />
sort<br />
su<br />
whoami</p>
</section>
<section id="imports" class="level3">
<h3>Imports</h3>
<p>no imports</p>
</section>
<section id="global-variables" class="level3">
<h3>Global Variables</h3>
<section id="B_LIB_DIR" class="level4">
<h4>B_LIB_DIR</h4>
<p><small><em>blib/B_LIB_DIR</em></small><br />
Path of the blib installation directory.</p>
</section>
<section id="B_TEST_MODE" class="level4">
<h4>B_TEST_MODE</h4>
<p><small><em>blib/B_TEST_MODE</em></small><br />
blib will set this variable to 0, if blib is running in test mode.<br />
This variable may be used to bypass code during testing, if bats cannot test that code due to its limitations (e.g. for EXIT traps which bats uses for itself).</p>
</section>
<section id="B_CALLER_NAME" class="level4">
<h4>B_CALLER_NAME</h4>
<p><small><em>blib/B_CALLER_NAME</em></small><br />
Name of the executable or script as String which called blib and any child libraries.</p>
</section>
<section id="B_ERR" class="level4">
<h4>B_ERR</h4>
<p><small><em>blib/B_ERR</em></small><br />
Global variable used for error handling throughout blib, cf. <a href="#B_E">B_E</a>.</p>
<p>It is recommended to always set an at least partially static error message on confirmed errors as variables may be empty (which would indicate “no error” for <a href="#B_E">B_E</a>).</p>
</section>
<section id="B_RC" class="level4">
<h4>B_RC</h4>
<p><small><em>blib/B_RC</em></small><br />
Can be used to set the return code for <a href="#B_E">B_E</a> in the case of an error. It defaults to 1.</p>
<p>This should be set to an integer value between 1 and 255. Any other value may cause undefined behaviour.</p>
</section>
<section id="B_CONF_DIR" class="level4">
<h4>B_CONF_DIR</h4>
<p><small><em>blib/B_CONF_DIR</em></small><br />
Path to the blib configuration directory. Modules may create subfolders named by their module name there. May not exist.</p>
</section>
<section id="B_SCRIPT" class="level4">
<h4>B_SCRIPT</h4>
<p><small><em>blib/B_SCRIPT</em></small><br />
Global variable which can be used to obtain the two global variables <a href="#B_SCRIPT_DIR">B_SCRIPT_DIR</a> and <a href="#B_SCRIPT_NAME">B_SCRIPT_NAME</a> as follows:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="bu">eval</span> <span class="st">&quot;</span><span class="va">$B_SCRIPT</span><span class="st">&quot;</span></span></code></pre></div>
</section>
<section id="B_SCRIPT_NAME" class="level4">
<h4>B_SCRIPT_NAME</h4>
<p><small><em>blib/B_SCRIPT_NAME</em></small><br />
Path of the sourced or executed bash script executing the eval (symlinks are resolved) of <a href="#B_SCRIPT">B_SCRIPT</a>.</p>
</section>
<section id="B_SCRIPT_DIR" class="level4">
<h4>B_SCRIPT_DIR</h4>
<p><small><em>blib/B_SCRIPT_DIR</em></small><br />
Name of the sourced or executed bash script executing the eval (symlinks are resolved) of <a href="#B_SCRIPT">B_SCRIPT</a>.</p>
</section>
</section>
<section id="global-aliases" class="level3">
<h3>Global Aliases</h3>
<p>Alias expansion is automatically enabled by blib as it is required for its core functionality. So if you have strange aliases defined in your shell environment, this may cause undefined blib behaviour.</p>
<section id="B_E" class="level4">
<h4>B_E</h4>
<p><small><em>blib/B_E</em></small><br />
<em>The</em> blib error handler: All blib modules use it whenever execution errors require special handling that the currently executing code cannot achieve.</p>
<p>Syntax:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="va">B_ERR=</span><span class="st">&quot;This is an error message.&quot;</span> ; <span class="ex">B_E</span> <span class="kw">;</span></span></code></pre></div>
<p>If you need to set the return/exit code, you can do it with <a href="#B_RC">B_RC</a>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="va">B_ERR=</span><span class="st">&quot;This is another error message.&quot;</span> ; <span class="va">B_RC=</span>6 ; <span class="ex">B_E</span> <span class="kw">;</span></span></code></pre></div>
<p>Calling <a href="#B_E">B_E</a> means:<br />
Check <a href="#B_ERR">B_ERR</a> for an error message and if there is one, handle it. It can be placed at the end of a line or on its own line. <a href="#B_E">B_E</a> will then process the error message in the way defined by the error handler (cf. <a href="#b_defaultErrorHandler">b_defaultErrorHandler</a>) and stop any further execution of code in the current context (function, script, …) returning a non-zero exit code (1) unless the described error was fixed. In the latter unlikely case it’ll let execution proceed.</p>
<p>More examples:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="co">#handle a potentially failing command:</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a><span class="ex">cmd</span> <span class="kw">||</span> <span class="kw">{</span> <span class="va">B_ERR=</span><span class="st">&quot;cmd failed.&quot;</span> ; <span class="ex">B_E</span> <span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a><span class="co">#capture stdout of a potentially failing command:</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a><span class="bu">local</span> <span class="va">out=</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a><span class="va">out=</span><span class="st">&quot;</span><span class="va">$(</span><span class="ex">cmd</span><span class="va">)</span><span class="st">&quot;</span> <span class="kw">||</span> <span class="kw">{</span> <span class="va">B_ERR=</span><span class="st">&quot;cmd failed.&quot;</span> ; <span class="ex">B_E</span> <span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true"></a><span class="co">#handle multiple potentially failing commands in a try/catch like manner:</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true"></a><span class="kw">(</span>   <span class="kw">set</span> <span class="ex">-e</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true"></a>    <span class="ex">cmd1</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true"></a>    <span class="ex">cmd2</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true"></a>    <span class="ex">cmd3</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true"></a><span class="kw">)</span> #<span class="ex">NOTE</span>: <span class="kw">||</span> <span class="ex">doesn</span><span class="st">&#39;t work here!</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true"></a><span class="st">if [ $? -ne 0 ] ; then</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true"></a><span class="st">    B_ERR=&quot;Some commands failed.&quot;</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true"></a><span class="st">    B_E</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true"></a><span class="st">fi</span></span></code></pre></div>
<p>The error handler can be re-defined at runtime with <a href="#b_setErrorHandler">b_setErrorHandler</a>.</p>
</section>
</section>
<section id="functions" class="level3">
<h3>Functions</h3>
<section id="b_printStackTrace" class="level4">
<h4>b_printStackTrace [skip level]</h4>
<p><small><em>blib/b_printStackTrace</em></small><br />
<span class="par">[skip level]: skip that many levels of the stack trace (optional, default: 1 - skip this function call)</span><br />
print the current stack trace in a human readable way<br />
<span class="ret"><strong>returns</strong>: stack trace with the first levels skipped as defined</span></p>
</section>
<section id="b_nop" class="level4">
<h4>b_nop</h4>
<p><small><em>blib/b_nop</em></small><br />
Do nothing.<br />
<span class="ret"><strong>returns</strong>: nothing; sets a zero exit code</span></p>
</section>
<section id="b_version" class="level4">
<h4>b_version [part]</h4>
<p><small><em>blib/b_version</em></small><br />
Get the version of this blib instance.<br />
<span class="par">[part]: Optional parameter defining the part of the version to retrieve (0: all as String (default), 1: major as Integer, 2: minor as Integer).</span><br />
<span class="ret"><strong>returns</strong>: blib version as string; always sets a zero exit code</span></p>
</section>
<section id="b_checkVersion" class="level4">
<h4>b_checkVersion [minimum allowed major] [minimum allowed minor] [maximum allowed major] [maximum allowed minor]</h4>
<p><small><em>blib/b_checkVersion</em></small><br />
Check whether the currently running blib instance meets the given blib version requirements.<br />
To e.g. make sure you’re on blib version 1.1 or higher, use</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a> <span class="bu">source</span> blib</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a> <span class="ex">b_checkVersion</span> 1 2 <span class="kw">||</span> <span class="kw">{</span> <span class="op">&gt;&amp;2</span> <span class="bu">echo</span> <span class="st">&quot;This script depends on blib (https://github.com/3hhh/blib) version 1.2 or higher. Please install a supported version.&quot;</span> <span class="kw">;</span> <span class="bu">exit</span> 1 <span class="kw">;</span> <span class="kw">}</span></span></code></pre></div>
<p><span class="par">[minimum allowed major]: The lowest acceptable major version number (default: 0).</span><br />
<span class="par">[minimum allowed minor]: The lowest acceptable minor version number (default: 0).</span><br />
<span class="par">[maximum allowed major]: The highest acceptable major version number (default: infinite).</span><br />
<span class="par">[maximum allowed minor]: The highest acceptable minor version number (default: infinite).</span><br />
<span class="ret"><strong>returns</strong>: Sets a zero exit code, if an only if the currently running blib instance meets the version requirements.</span></p>
</section>
<section id="b_defaultErrorHandler" class="level4">
<h4>b_defaultErrorHandler [error out] [send err] [send stack trace]</h4>
<p><small><em>blib/b_defaultErrorHandler</em></small><br />
The blib default error handler.<br />
As any error handler it must</p>
<ol>
<li>handle the error message (if not the error itself) lying in <a href="#B_ERR">B_ERR</a></li>
<li>not take any non-numeric arguments</li>
<li>not error out itself</li>
<li>implement the below <em>[error out]</em> as its first parameter (to make <a href="#b_setBE">b_setBE</a> work)</li>
<li>ideally use <a href="#b_error">b_error</a> to send error messages to the user</li>
<li>return one of the following exit codes:
<ol type="a">
<li>0: <strong>if and only if</strong> the error was fixed entirely and the caller may ignore the error (i.e. probably never)</li>
<li>1: The error wasn’t fixed. Functions should return to their caller indicating an error (non-zero status code). Direct shell calls will exit. <a href="#B_ERR">B_ERR</a> is <strong>not</strong> reset to blank, i.e. the next call to <a href="#B_E">B_E</a> in the same context will cause another error. The caller may use this to either <em>throw</em> the error further or handle and clear the error.
<ol start="3" type="a">
<li>2: Force a stop of execution in the current shell / error out.</li>
</ol></li>
</ol></li>
</ol>
<p><span class="par">[error out]: Whether or not to call exit after the error message handling, if the error couldn’t be handled (default: 0 = always error out / call exit). If set to 1, <a href="#B_E">B_E</a> will allow e.g. functions to return to their callers.</span><br />
<span class="par">[send err]: Whether or not to send the error message to the user (default: 0 = send).</span><br />
<span class="par">[send stack trace]: Whether or not to send a stack trace to the user (default: identical to [send err]).</span><br />
<span class="ret"><strong>returns</strong>: see the description above</span></p>
</section>
<section id="b_setBE" class="level4">
<h4>b_setBE [error out]</h4>
<p><small><em>blib/b_setBE</em></small><br />
Set the [error out] behaviour of the currently configured error handler.</p>
<p>Contrary to <a href="#b_setErrorHandler">b_setErrorHandler</a> this function may be called by blib modules as all error handlers are required to support [error out] as parameter.</p>
<p>Example for switching the error out behaviour:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a> <span class="ex">b_setBE</span> 1</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a> <span class="ex">funcThatMayCallB_E</span> #without subshell</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a> <span class="va">ret=$?</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true"></a> <span class="ex">b_resetErrorHandler</span></span></code></pre></div>
<p><span class="par">[error out]: see <a href="#b_defaultErrorHandler">b_defaultErrorHandler</a> (default: 0)</span><br />
<span class="ret"><strong>returns</strong>: nothing, always sets a zero exit code</span><br />
<span class="ann"><em><span class="citation" data-cites="StateChanging">@StateChanging</span></em></span></p>
</section>
<section id="b_setErrorHandler" class="level4">
<h4>b_setErrorHandler [handler]</h4>
<p><small><em>blib/b_setErrorHandler</em></small><br />
Set the error handler for all future exections of <a href="#B_E">B_E</a> in the current scope.</p>
<p>You can do this in e.g. subshells to limit the effect.</p>
<p>blib modules should only use this function if absolutely necessary to temporarily modify the error behaviour whilst making sure that <a href="#b_resetErrorHandler">b_resetErrorHandler</a> is called in the end. Otherwise it will prevent library users from setting the general behaviour in their scripts.</p>
<p>Usually you do not want to write an entirely new handler, but modify the <a href="#b_defaultErrorHandler">b_defaultErrorHandler</a> parameters with this setter or use <a href="#b_setBE">b_setBE</a> for that.<br />
<span class="par">[handler]: Function to handle errors. See <a href="#b_defaultErrorHandler">b_defaultErrorHandler</a> for details.</span><br />
<span class="ret"><strong>returns</strong>: nothing</span><br />
<span class="ann"><em><span class="citation" data-cites="StateChanging">@StateChanging</span></em></span></p>
</section>
<section id="b_resetErrorHandler" class="level4">
<h4>b_resetErrorHandler [reset B_ERR]</h4>
<p><small><em>blib/b_resetErrorHandler</em></small><br />
Set the error handler to whatever it was before the last call to <a href="#b_setErrorHandler">b_setErrorHandler</a> or <a href="#b_setBE">b_setBE</a>.<br />
<span class="par">[reset B_ERR]: Whether or not to also reset <a href="#B_ERR">B_ERR</a> (default: true/0).</span><br />
<span class="ret"><strong>returns</strong>: nothing, always sets a zero exit code</span><br />
<span class="ann"><em><span class="citation" data-cites="StateChanging">@StateChanging</span></em></span></p>
</section>
<section id="b_getErrorHandler" class="level4">
<h4>b_getErrorHandler</h4>
<p><small><em>blib/b_getErrorHandler</em></small><br />
Get the currently for <a href="#B_E">B_E</a> configured error handler.<br />
<span class="ret"><strong>returns</strong>: the error handler function</span></p>
</section>
<section id="b_silence" class="level4">
<h4>b_silence [function] [param 1] .. [param p]</h4>
<p><small><em>blib/b_silence</em></small><br />
Call the given function with its parameters in the current shell context whilst suppressing all of its output to both stdout and stderr. Anything written to <a href="#B_ERR">B_ERR</a> however is passed to <a href="#B_E">B_E</a> (which can still write to stderr).</p>
<p>This function is useful when you want to keep an error message set with <a href="#B_ERR">B_ERR</a>, but discard everything else.<br />
In contrast <code class="sourceCode bash"><span class="ex">yourfunction</span> <span class="op">&amp;&gt;</span> /dev/null</code> may also drop the error message, if you’re using an error handler (see <a href="#B_E">B_E</a>) that writes to stdout or stderr.<br />
<span class="par">[function]: The function to execute.</span><br />
<span class="par">[param p]: An arbitrary number of function parameters.</span><br />
<span class="ret"><strong>returns</strong>: Sets the status code of the called function, but doesn’t print anything. <a href="#B_E">B_E</a> is called on errors.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_assertLastPipes" class="level4">
<h4>b_assertLastPipes [error message]</h4>
<p><small><em>blib/b_assertLastPipes</em></small><br />
Assert that the last pipe statements all had a zero exit code.<br />
An alternative to <code>set -o pipefail</code>.<br />
<span class="par">[error message]: Optional error message to use for <a href="#B_E">B_E</a> in case the assertion fails.</span><br />
<span class="ret"><strong>returns</strong>: Nothing. Assertion failures trigger <a href="#B_E">B_E</a>.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_defaultMessageHandler" class="level4">
<h4>b_defaultMessageHandler [message type] [message] [first part] [last part]</h4>
<p><small><em>blib/b_defaultMessageHandler</em></small><br />
Handles the given message by printing information to stdout and errors to stderr.<br />
This is the default message handler used by blib. It can be changed by <a href="#b_setMessageHandler">b_setMessageHandler</a>.<br />
Message handler implementations must support at least the parameters of this function, but may add additional parameters. If an handler implementation does not support partial messages (i.e. the [first part] and [last part] parameters), it should be chained to a <a href="#b_cachingMessageHandler">b_cachingMessageHandler</a>.<br />
<span class="par">[message type]: 0=informational message, 1=error message.</span><br />
<span class="par">[message]: String representing the message.</span><br />
<span class="par">[first part]: If set to 0, assume that the given message is the first part of an overall chain of messages (default: 0).</span><br />
<span class="par">[last part]: If set to 0, assume that the given message is the final part of an overall chain of messages (default: 0).</span><br />
<span class="ret"><strong>returns</strong>: Nothing. Never causes errors.</span></p>
</section>
<section id="b_cachingMessageHandler" class="level4">
<h4>b_cachingMessageHandler [message handler] [message type] [message] [first part] [last part]</h4>
<p><small><em>blib/b_cachingMessageHandler</em></small><br />
A message handler implementation which caches partial messages for a receiving message handler that cannot handle them until they are completed.<br />
Use <code class="sourceCode bash"><span class="ex">b_initCachingMessageHandler</span> <span class="kw">&amp;&amp;</span> <span class="ex">b_setMessageHandler</span> <span class="st">&quot;b_cachingMessageHandler [your message handler]&quot;</span></code> to set your receiving message handler as message handler to cache messages for.<br />
This implementation uses the <a href="#b_getDefaultMessageHandlerIntermediate">b_getDefaultMessageHandlerIntermediate</a> as separator between partial messages.<br />
<span class="par">[message handler]: The function implementing the receiving message handler. It must handle the [message type] and the [message].</span><br />
<span class="par">[message type]: See <a href="#b_defaultMessageHandler">b_defaultMessageHandler</a>.</span><br />
<span class="par">[message]: See <a href="#b_defaultMessageHandler">b_defaultMessageHandler</a>.</span><br />
<span class="par">[first part]: See <a href="#b_defaultMessageHandler">b_defaultMessageHandler</a>.</span><br />
<span class="par">[last part]: See <a href="#b_defaultMessageHandler">b_defaultMessageHandler</a>.</span><br />
<span class="ret"><strong>returns</strong>: Nothing. Never causes errors.</span></p>
</section>
<section id="b_initCachingMessageHandler" class="level4">
<h4>b_initCachingMessageHandler [maximum message type]</h4>
<p><small><em>blib/b_initCachingMessageHandler</em></small><br />
Initializes a new cache for a <a href="#b_cachingMessageHandler">b_cachingMessageHandler</a>. This function <em>must</em> be called at least once before using <a href="#b_cachingMessageHandler">b_cachingMessageHandler</a>.<br />
<span class="par">[maximum message type]: Maximum message type for which to allocate caches (default: 1 –&gt; allocate caches for 0..1/info..error).</span><br />
<span class="ret"><strong>returns</strong>: Nothing.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_setDefaultMessageHandlerIntermediate" class="level4">
<h4>b_setDefaultMessageHandlerIntermediate [intermediate]</h4>
<p><small><em>blib/b_setDefaultMessageHandlerIntermediate</em></small><br />
<span class="par">[intermediate]: String to use as intermediate between two message parts with <a href="#b_defaultMessageHandler">b_defaultMessageHandler</a>, i.e. the resulting message should be [part 1][intermediate][part 2]. Default: Space.</span><br />
<span class="ret"><strong>returns</strong>: Nothing.</span></p>
</section>
<section id="b_getDefaultMessageHandlerIntermediate" class="level4">
<h4>b_getDefaultMessageHandlerIntermediate</h4>
<p><small><em>blib/b_getDefaultMessageHandlerIntermediate</em></small><br />
Get the currently configured intermediate string for the <a href="#b_defaultMessageHandler">b_defaultMessageHandler</a>.<br />
<span class="ret"><strong>returns</strong>: The intermediate String.</span></p>
</section>
<section id="b_setDefaultMessageHandlerPrefix" class="level4">
<h4>b_setDefaultMessageHandlerPrefix [message type] [prefix]</h4>
<p><small><em>blib/b_setDefaultMessageHandlerPrefix</em></small><br />
Set the prefix to use for the default message handler and the given message type.<br />
<span class="par">[message type]: 0=informational message, 1=error message.</span><br />
<span class="par">[prefix]: A string to prefix all messages of the given type.</span><br />
<span class="ret"><strong>returns</strong>: Nothing.</span></p>
</section>
<section id="b_getDefaultMessageHandlerPrefix" class="level4">
<h4>b_getDefaultMessageHandlerPrefix [message type]</h4>
<p><small><em>blib/b_getDefaultMessageHandlerPrefix</em></small><br />
Get the prefix used for the default message handler and the given message type.<br />
<span class="par">[message type]: 0=informational message, 1=error message.</span><br />
<span class="ret"><strong>returns</strong>: The currently configured prefix.</span></p>
</section>
<section id="b_info" class="level4">
<h4>b_info [message] [first part] [last part] [message handler param 1] … [message handler param n]</h4>
<p><small><em>blib/b_info</em></small><br />
Send an informational message to the user. The message is dispatched via the currently configured message handler (default: <a href="#b_defaultMessageHandler">b_defaultMessageHandler</a>).<br />
<span class="par">[message]: to send</span><br />
<span class="par">[first part]: If set to 0, assume that the given message is the first part of an overall chain of messages (default: 0).</span><br />
<span class="par">[last part]: If set to 0, assume that the given message is the final part of an overall chain of messages (default: 0).</span><br />
<span class="par">[message handler param i]: Arbitrary parameters to pass to the currently configured message handler (cf. <a href="#b_setMessageHandler">b_setMessageHandler</a>).</span><br />
<span class="ret"><strong>returns</strong>: Nothing, always sets a zero exit code.</span></p>
</section>
<section id="b_error" class="level4">
<h4>b_error [message] [first part] [last part] [message handler param 1] … [message handler param n]</h4>
<p><small><em>blib/b_error</em></small><br />
Send an error message to the user <em>without</em> erroring out. The message is dispatched via the currently configured message handler (default: <a href="#b_defaultMessageHandler">b_defaultMessageHandler</a>).<br />
99.9% of all users will want to use the combination of <a href="#B_ERR">B_ERR</a> and <a href="#B_E">B_E</a> for proper error handling instead.<br />
<span class="par">[message]: to send</span><br />
<span class="par">[first part]: If set to 0, assume that the given message is the first part of an overall chain of messages (default: 0).</span><br />
<span class="par">[last part]: If set to 0, assume that the given message is the final part of an overall chain of messages (default: 0).</span><br />
<span class="par">[message handler param i]: Arbitrary parameters to pass to the currently configured message handler (cf. <a href="#b_setMessageHandler">b_setMessageHandler</a>).</span><br />
<span class="ret"><strong>returns</strong>: Nothing, always sets a zero exit code.</span></p>
</section>
<section id="b_setMessageHandler" class="level4">
<h4>b_setMessageHandler [handler]</h4>
<p><small><em>blib/b_setMessageHandler</em></small><br />
Set the handler used to send messages to the user. By default, <a href="#b_defaultMessageHandler">b_defaultMessageHandler</a> is used.<br />
<span class="par">[handler]: Function to handle the messages. See <a href="#b_defaultMessageHandler">b_defaultMessageHandler</a> for the requirements.</span><br />
<span class="ret"><strong>returns</strong>: Nothing.</span></p>
</section>
<section id="b_getMessageHandler" class="level4">
<h4>b_getMessageHandler</h4>
<p><small><em>blib/b_getMessageHandler</em></small><br />
Get the currently configured message handler.<br />
<span class="ret"><strong>returns</strong>: The message handler.</span></p>
</section>
<section id="b_enforceUser" class="level4">
<h4>b_enforceUser [user name]</h4>
<p><small><em>blib/b_enforceUser</em></small><br />
enforce that the user is the given one and if not, exit the script and set a non-zero status code<br />
<span class="par">[user name]: user name to check against</span><br />
<span class="ret"><strong>returns</strong>: nothing</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_isFunction" class="level4">
<h4>b_isFunction [potential function name]</h4>
<p><small><em>blib/b_isFunction</em></small><br />
check whether the given function is defined<br />
<span class="ret"><strong>returns</strong>: zero exit code if the function is defined</span></p>
</section>
<section id="b_getBlibModules" class="level4">
<h4>b_getBlibModules</h4>
<p><small><em>blib/b_getBlibModules</em></small><br />
get all available blib module names as a newline-separated list<br />
<span class="ret"><strong>returns</strong>: all available blib module names as newline-separated list</span></p>
</section>
<section id="b_listContains" class="level4">
<h4>b_listContains [list] [entry]</h4>
<p><small><em>blib/b_listContains</em></small><br />
check whether the given list contains the given entry<br />
<span class="par">[list]: newline-separated list</span><br />
<span class="par">[entry]: string to be found on a single line within the list (equality check)</span><br />
<span class="ret"><strong>returns</strong>: a zero exit code if the list contains the entry; a non-zero exit code otherwise</span></p>
</section>
<section id="b_deps" class="level4">
<h4>b_deps [dependency 1] … [dependency n]</h4>
<p><small><em>blib/b_deps</em></small><br />
Assert that the given dependencies are met and error out with <a href="#B_E">B_E</a> otherwise.<br />
This function is meant to be used by modules or scripts to declare all of their dependencies.<br />
<span class="par">[dependency i]: Command that is absolutely required to run this script.</span><br />
<span class="ret"><strong>returns</strong>: Nothing. Errors out with <a href="#B_E">B_E</a>, if dependencies are not met.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_import" class="level4">
<h4>b_import [module] [double import]</h4>
<p><small><em>blib/b_import</em></small><br />
Import the given module into the current context.<br />
<span class="par">[module]: relative path of the module to import (relative to the blib/lib root directory)</span><br />
<span class="par">[double import]: if set to 1, import the given module regardless of whether it was imported before (default: 0 = don’t do duplicate imports)</span><br />
<span class="ret"><strong>returns</strong>: nothing, errors out if the import failed and sets a non-zero status code; if the import was successful or previously done, a zero exit code is set</span><br />
<span class="ann"><em><span class="citation" data-cites="StateChanging">@StateChanging</span></em></span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_generateStandalone" class="level4">
<h4>b_generateStandalone [function] [module dep 1] .. [module dep n] - [function dep 1] .. [function dep d] - [function param 1] .. [function param p]</h4>
<p><small><em>blib/b_generateStandalone</em></small><br />
Create a standalone variant of blib in a single file running the given function when called (sourcing that file will only make the functions available) and print that file to stdout.</p>
<p>The current execution state is not retained.<br />
<span class="par">[function]: The function to call when the generated script is executed. All script parameters when calling [output file] are passed to this function. The function must be available in the current context.</span><br />
<span class="par">[module dep i]: Names of the modules to include in the standalone file. They do not need to be imported. They are loaded in the specified order.</span><br />
<span class="par">[-]: Dash used as separator between the various types of arguments. If none is provided, all parameters are assumed to be modules.</span><br />
<span class="par">[function dep j]: An arbitrary number of functions that need to be added in order to satisfy the dependencies of the function to call (e.g. if function A is meant to be called, but uses function B internally, you’ll have to pass B as one of its dependencies). Dependencies that can be found in added modules should <em>not</em> be added.</span><br />
<span class="par">[function param p]: Static parameters to add to the function as single String. Dynamic parameters should be passed to the generated script.</span><br />
<span class="ret"><strong>returns</strong>: Sets a zero exit code and prints the output file to stdout on success. May error out otherwise.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_execFuncInCurrentContext" class="level4">
<h4>b_execFuncInCurrentContext [function] [module dep 1] .. [module dep n] - [function param 1] .. [function param p]</h4>
<p><small><em>blib/b_execFuncInCurrentContext</em></small><br />
Execute the given function in the current context.<br />
<span class="par">[function]: The function to execute.</span><br />
<span class="par">[module dep i]: Names of the modules required by the function. They do not need to be imported by the function itself.</span><br />
<span class="par">[-]: A dash as separator character between the various parameters.</span><br />
<span class="par">[function param p]: An arbitrary number of function parameters.</span><br />
<span class="ret"><strong>returns</strong>: Whatever the executed function returns.</span></p>
</section>
<section id="b_execFuncAs" class="level4">
<h4>b_execFuncAs [user] [function] [module dep 1] .. [module dep n] - [function dep 1] .. [function dep d] - [function param 1] .. [function param p]</h4>
<p><small><em>blib/b_execFuncAs</em></small><br />
Attempt to execute the Bash function as the given user.</p>
<p>Whether or not this works highly depends on the underlying OS and its (sudo &amp; su) configuration. In particular this function may cause further execution to wait for the user to type in the password of the requested user.</p>
<p>If the given user is identical to the current user, <a href="#b_execFuncAs">b_execFuncAs</a> may decide to run the function in the current context. Otherwise it may run in a different process, i.e. all initialization and state may be lost. Thus make sure to create any required state within your function.<br />
<span class="par">[user]: User to execute the function as (default: root).</span><br />
<span class="par">[function]: The function to execute.</span><br />
<span class="par">[module dep i]: Names of the modules required by the function. They do not need to be imported by the function itself. They are loaded in the specified order.</span><br />
<span class="par">[-]: A dash as separator character between the various parameters.</span><br />
<span class="par">[function dep j]: An arbitrary number of functions that need to be added in order to satisfy the dependencies of the function to call (e.g. if function A is meant to be called, but uses function B internally, you’ll have to pass B as one of its dependencies). Dependencies that can be found in added modules should <em>not</em> be added.</span><br />
<span class="par">[function param p]: An arbitrary number of function parameters.</span><br />
<span class="ret"><strong>returns</strong>: Whatever the executed function returns. A non-zero exit code may also indicate that the user switch didn’t work. In particular <a href="#B_E">B_E</a> is <em>not</em> called if the executed function returns an error.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_isModule" class="level4">
<h4>b_isModule [module name]</h4>
<p><small><em>blib/b_isModule</em></small><br />
Test whether the given name represents a blib module name.<br />
<span class="ret"><strong>returns</strong>: sets a zero exit code if the given name is a valid module name</span></p>
</section>
</section>
</section>
<section id="args" class="level2">
<h2>args</h2>
<p>Stateful argument parser for bash.</p>
<p>Regular arguments and options are parsed via <a href="#b_args_parse">b_args_parse</a>. Afterwards they can be retrieved via <a href="#b_args_get">b_args_get</a> and <a href="#b_args_getOption">b_args_getOption</a>. Options may have parameters, can be repeated and combined.</p>
<p>The module can also check the correctness of options. All remaining correctness checks (e.g. for regular or option parameters) are left to the user of this module.</p>
<p>Conventions:</p>
<ul>
<li>Options always start with <code>-</code> and may occur everywhere.</li>
<li>Single character options may be combined, e.g. <code>-ajh</code> will be considered the same as <code>-a -j -h</code>. Long options such as <code>--option</code> cannot be combined.<br />
<em>Recommendation</em>: Use long options for those options which require parameters and single letter options for everything else.</li>
<li>Everything after a space-separated double dash (<code>--</code>) is not considered an option, but a regular argument.</li>
</ul>
<p>Copyright (C) 2020 David Hobach LGPLv3<br />
0.9</p>
<section id="dependencies-1" class="level3">
<h3>Dependencies</h3>
<p>no dependencies</p>
</section>
<section id="imports-1" class="level3">
<h3>Imports</h3>
<p><a href="#types">types</a></p>
</section>
<section id="global-variables-1" class="level3">
<h3>Global Variables</h3>
<section id="B_ARGS" class="level4">
<h4>B_ARGS</h4>
<p><small><em>args/B_ARGS</em></small><br />
Array of regular/non-option arguments in the order of their appearance.<br />
Instead of using it directly, it is recommended to use <a href="#b_args_get">b_args_get</a> instead. The array may be removed in future versions.</p>
</section>
<section id="B_ARGS_OPTS" class="level4">
<h4>B_ARGS_OPTS</h4>
<p><small><em>args/B_ARGS_OPTS</em></small><br />
Map of options. <code>[option]_[index]</code> is used as key with <code>[index]</code> starting at zero. The values are the option parameters (if any). Multiple option parameters are separated by tabs.<br />
The latter separator can be changed via <a href="#b_args_setOptionParamSeparator">b_args_setOptionParamSeparator</a> before calling <a href="#b_args_parse">b_args_parse</a>.<br />
The index will only increase if options are repeated.<br />
Instead of using it directly, it is recommended to use <a href="#b_args_getOption">b_args_getOption</a> instead. The array may be removed in future versions.</p>
</section>
</section>
<section id="functions-1" class="level3">
<h3>Functions</h3>
<section id="b_args_setOptionParamSeparator" class="level4">
<h4>b_args_setOptionParamSeparator [separator]</h4>
<p><small><em>args/b_args_setOptionParamSeparator</em></small><br />
Set the separator for multiple option parameters.<br />
<span class="par">[separator]: String to use as separator for multiple option parameters.</span><br />
<span class="ret"><strong>returns</strong>: Nothing.</span></p>
</section>
<section id="b_args_getOptionParamSeparator" class="level4">
<h4>b_args_getOptionParamSeparator</h4>
<p><small><em>args/b_args_getOptionParamSeparator</em></small><br />
Get the separator for multiple option parameters.<br />
<span class="ret"><strong>returns</strong>: Nothing.</span></p>
</section>
<section id="b_args_init" class="level4">
<h4>b_args_init [allow flag] [option 1] [option param count 1] … [option n] [option param count n]</h4>
<p><small><em>args/b_args_init</em></small><br />
Initialize the args module. It is recommended to call this function before using this module, if you want to achieve any non-default behaviour.<br />
<span class="par">[allow flag]: If set to 0, assume that non-specified options do not have any parameters (default). If set to 1, enforce that only the given options are allowed and otherwise error out.</span><br />
<span class="par">[option i]: An allowed option including its leading <code>-</code> prefix.</span><br />
<span class="par">[option param count i]: Number of expected parameters for that option. The parameters must directly follow the option. If less parameters are found, the parser will error out.</span><br />
<span class="ret"><strong>returns</strong>: Nothing, always sets a zero exit code.</span><br />
<span class="ann"><em><span class="citation" data-cites="StateChanging">@StateChanging</span></em></span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_args_parse" class="level4">
<h4>b_args_parse [arguments]</h4>
<p><small><em>args/b_args_parse</em></small><br />
Parse the given arguments.<br />
Call <a href="#b_args_init">b_args_init</a> before parsing, if you desire any non-default parsing behaviour.<br />
<span class="par">[arguments]: The arguments meant to be parsed, usually “$@”.</span><br />
<span class="ret"><strong>returns</strong>: Sets a zero exit code on success and calls <a href="#B_E">B_E</a> otherwise.</span><br />
<span class="ann"><em><span class="citation" data-cites="StateChanging">@StateChanging</span></em></span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_args_assertOptions" class="level4">
<h4>b_args_assertOptions [option 1] … [option n]</h4>
<p><small><em>args/b_args_assertOptions</em></small><br />
Assert that the parsed options contain only the given allowed options (or less).<br />
<span class="par">[option i]: Option to check against.</span><br />
<span class="ret"><strong>returns</strong>: Sets a zero exit code, if the current parsed state contains only allowed options and errors out with <a href="#B_E">B_E</a> otherwise. Prints a list of invalid options in the error case.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_args_get" class="level4">
<h4>b_args_get [index] [fallback]</h4>
<p><small><em>args/b_args_get</em></small><br />
Get the argument at the given index.<br />
<span class="par">[index]: Index of the argument to retrieve, starting at 0.</span><br />
<span class="par">[fallback]: Value to return, if the given index was provided as empty argument or is missing. Default: empty String</span><br />
<span class="ret"><strong>returns</strong>: The argument at the given index. An <em>empty</em> (existing!) argument will cause the fallback to be returned with a zero exit code. If no argument was found at that index, a nonzero exit code is set and the fallback is returned.</span></p>
</section>
<section id="b_args_getInt" class="level4">
<h4>b_args_getInt [index] [fallback]</h4>
<p><small><em>args/b_args_getInt</em></small><br />
Convenience wrapper for <a href="#b_args_get">b_args_get</a> that also checks the type of the argument to be an integer.<br />
<span class="ret"><strong>returns</strong>: See <a href="#b_args_get">b_args_get</a>. Also sets a nonzero exit code, if the argument is not an integer.</span></p>
</section>
<section id="b_args_getCount" class="level4">
<h4>b_args_getCount</h4>
<p><small><em>args/b_args_getCount</em></small><br />
Get the number of arguments.<br />
<span class="ret"><strong>returns</strong>: Number of arguments.</span></p>
</section>
<section id="b_args_getOption" class="level4">
<h4>b_args_getOption [option] [fallback] [repeat index] [parameter index]</h4>
<p><small><em>args/b_args_getOption</em></small><br />
Check whether the given option is set and retrieve its parameter, if it was.<br />
<span class="par">[option]: String defining the option, e.g. <code>--option</code> or <code>-a</code>.</span><br />
<span class="par">[fallback]: Value to return if the option did not have any parameter or was not set. Default: empty String</span><br />
<span class="par">[repeat index]: Index of the option to retrieve, if the option was repeated multiple times (default: 0 = first option).</span><br />
<span class="par">[parameter index]: Index of the option parameter to retrieve, starting at 0 (default: return all option parameters, separated by <a href="#b_args_getOptionParamSeparator">b_args_getOptionParamSeparator</a>).</span><br />
<span class="ret"><strong>returns</strong>: The option parameter, if the option was set. The fallback is returned and a zero exit code is set, if the option was set, but an <em>empty</em> (existing!) parameter was provided. A nonzero exit code indicates that the option was not set (the fallback is still returned).</span></p>
</section>
<section id="b_args_getOptionInt" class="level4">
<h4>b_args_getOptionInt [option] [fallback] [repeat index] [parameter index]</h4>
<p><small><em>args/b_args_getOptionInt</em></small><br />
Convenience wrapper for <a href="#b_args_getOption">b_args_getOption</a> that also checks the type of the option to be an integer.<br />
<span class="ret"><strong>returns</strong>: See <a href="#b_args_getOption">b_args_getOption</a>. Also sets a nonzero exit code, if the option is not an integer.</span></p>
</section>
<section id="b_args_getOptionCount" class="level4">
<h4>b_args_getOptionCount</h4>
<p><small><em>args/b_args_getOptionCount</em></small><br />
Get the number of options that were set.<br />
<span class="ret"><strong>returns</strong>: Number of options (incl. repeated options).</span></p>
</section>
<section id="b_args_getAll" class="level4">
<h4>b_args_getAll [exclude regex 1] … [exclude regex n]</h4>
<p><small><em>args/b_args_getAll</em></small><br />
Retrieve all arguments (excl. options).<br />
<span class="par">[exclude regex i]: Arguments matching any of the given regular expressions are excluded from the return value.</span><br />
<span class="ret"><strong>returns</strong>: All arguments as a single escaped string that can be used to pass them to functions or other scripts (without quotes).</span></p>
</section>
<section id="b_args_getAllOptions" class="level4">
<h4>b_args_getAllOptions [exclude regex 1] … [exclude regex n]</h4>
<p><small><em>args/b_args_getAllOptions</em></small><br />
Retrieve all options.<br />
<span class="par">[exclude regex i]: Options matching any of the given regular expressions are excluded from the return value.</span><br />
<span class="ret"><strong>returns</strong>: All options as a single escaped string that can be used to pass them to functions or other scripts (without quotes).</span></p>
</section>
</section>
</section>
<section id="arr" class="level2">
<h2>arr</h2>
<p>Collection of array related functions.</p>
<p>Copyright (C) 2018 David Hobach LGPLv3<br />
0.2</p>
<section id="dependencies-2" class="level3">
<h3>Dependencies</h3>
<p>no dependencies</p>
</section>
<section id="imports-2" class="level3">
<h3>Imports</h3>
<p>no imports</p>
</section>
<section id="functions-2" class="level3">
<h3>Functions</h3>
<section id="b_arr_join" class="level4">
<h4>b_arr_join [delimiter] [array]</h4>
<p><small><em>arr/b_arr_join</em></small><br />
Join the given array; elements are separated with the given delimiter. The array is not checked to exist.<br />
<span class="par">[delimiter]: String to use as delimiter.</span><br />
<span class="par">[array]: Expanded array to join, e.g. “${arr[@]}”.</span><br />
<span class="ret"><strong>returns</strong>: Joined version of the array. The exit code is always zero.</span></p>
</section>
<section id="b_arr_toList" class="level4">
<h4>b_arr_toList [array]</h4>
<p><small><em>arr/b_arr_toList</em></small><br />
Create a newline-separated list from the given array.<br />
<span class="par">[array]: Expanded array to join, e.g. “${arr[@]}”.</span><br />
<span class="ret"><strong>returns</strong>: List version of the array. The exit code is always zero.</span></p>
</section>
<section id="b_arr_contains" class="level4">
<h4>b_arr_contains [element] [array]</h4>
<p><small><em>arr/b_arr_contains</em></small><br />
Check whether an array contains an element.<br />
<span class="par">[element]: element to check for its existence in the array</span><br />
<span class="par">[array]: expanded array to check, e.g. “${arr[@]}”</span><br />
<span class="ret"><strong>returns</strong>: an exit code of 0, if the element was found and 1 otherwise</span></p>
</section>
<section id="b_arr_mapsAreEqual" class="level4">
<h4>b_arr_mapsAreEqual [map spec 1] [map spec 2]</h4>
<p><small><em>arr/b_arr_mapsAreEqual</em></small><br />
Check whether the two given maps/associative arrays are equal.<br />
<span class="par">[map spec 1]: First map specification to check. Since maps cannot be passed directly to functions in Bash 4.2, you’ll have to use <code>&quot;$(declare -p &quot;yourmap&quot;)&quot;</code> instead.</span><br />
<span class="par">[map spec 1]: Second map specification to check.</span><br />
<span class="ret"><strong>returns</strong>: an exit code of 0, if the maps are equal and 1 otherwise; <a href="#B_E">B_E</a> is only triggered on programming errors</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
</section>
</section>
<section id="cdoc" class="level2">
<h2>cdoc</h2>
<p>Generate code documentation in many formats (e.g. html, pdf, manpage, …) from code comments.</p>
<p>Lines applicable for the documentation in your code are assumed to match static (configurable) regular expressions. These lines are then fed to <a href="https://pandoc.org/">pandoc</a> in order to generate a single html page (or pdf, manpage, …) as documentation. If no conversion is required (input format = desired output format), pandoc is bypassed.</p>
<p>It should be possible to use this way of generating code documentation with most programming languages (incl. bash). The defaults however are set for bash and the blib way of documenting its code, i.e. you’ll have to use the getters and setters of this module if you want something different. For instance the default is to check for lines starting with <em>#+</em> (a special bash comment line) and add everything afterwards to the output documentation.</p>
<p>Various callback functions can be used to add content to the output of b_cdoc_generate. See the documentation of that function for details.</p>
<p>If you wish to create code documentation for your bash project in blib style, please use <code>../util/blib-cdoc</code>.</p>
<p>Copyright (C) 2020 David Hobach LGPLv3<br />
0.6</p>
<section id="dependencies-3" class="level3">
<h3>Dependencies</h3>
<p>cat<br />
mktemp<br />
mv<br />
rm</p>
</section>
<section id="imports-3" class="level3">
<h3>Imports</h3>
<p><a href="#fs">fs</a></p>
</section>
<section id="functions-3" class="level3">
<h3>Functions</h3>
<section id="b_cdoc_setExtractionRegex" class="level4">
<h4>b_cdoc_setExtractionRegex [regex]</h4>
<p><small><em>cdoc/b_cdoc_setExtractionRegex</em></small><br />
Set the regular expression used to check for matching lines in code files. The first match (${BASH_REMATCH[1]}) is added to the documentation output.<br />
<span class="ret"><strong>returns</strong>: nothing</span><br />
<span class="ann"><em><span class="citation" data-cites="StateChanging">@StateChanging</span></em></span></p>
</section>
<section id="b_cdoc_getExtractionRegex" class="level4">
<h4>b_cdoc_getExtractionRegex</h4>
<p><small><em>cdoc/b_cdoc_getExtractionRegex</em></small><br />
See the setter.<br />
<span class="ret"><strong>returns</strong>: The property that was set.</span></p>
</section>
<section id="b_cdoc_setFileCallback" class="level4">
<h4>b_cdoc_setFileCallback [callback function name]</h4>
<p><small><em>cdoc/b_cdoc_setFileCallback</em></small><br />
Set the function to call by b_cdoc_generate exactly once before starting to process a source code file.</p>
<p>The callback function can be used to filter certain files from processing or add them as-is.<br />
It should be declared as follows:</p>
<pre><code>callback_function_name [file] [output format]
[file]:           The next file to process is passed here.
[output format]:  chosen output format
returns:          Nothing. Possible exit codes:
                  0 = continue normal processing (default)
                  1 = include the file as-is without any processing
                  2 = silently ignore that file / do not process it
                  other = abort all further processing with an error</code></pre>
<p><span class="ret"><strong>returns</strong>: nothing</span><br />
<span class="ann"><em><span class="citation" data-cites="StateChanging">@StateChanging</span></em></span></p>
</section>
<section id="b_cdoc_getFileCallback" class="level4">
<h4>b_cdoc_getFileCallback</h4>
<p><small><em>cdoc/b_cdoc_getFileCallback</em></small><br />
See the setter.<br />
<span class="ret"><strong>returns</strong>: The property that was set.</span></p>
</section>
<section id="b_cdoc_setDocumentBeginCallback" class="level4">
<h4>b_cdoc_setDocumentBeginCallback [callback function name]</h4>
<p><small><em>cdoc/b_cdoc_setDocumentBeginCallback</em></small><br />
Set the function to call by b_cdoc_generate exactly once right before it starts generating the output document.</p>
<p>The callback function should be declared as follows:</p>
<pre><code>callback_function_name [document output file] [document output format]
[document output file]: path to the document output file
          (may not exist and should not be written to)
[document output format]: chosen output format
returns:  whatever should be added at the beginning of the output document;
          a non-zero exit code will abort further processing</code></pre>
<p><span class="ret"><strong>returns</strong>: nothing</span><br />
<span class="ann"><em><span class="citation" data-cites="StateChanging">@StateChanging</span></em></span></p>
</section>
<section id="b_cdoc_getDocumentBeginCallback" class="level4">
<h4>b_cdoc_getDocumentBeginCallback</h4>
<p><small><em>cdoc/b_cdoc_getDocumentBeginCallback</em></small><br />
See the setter.<br />
<span class="ret"><strong>returns</strong>: The property that was set.</span></p>
</section>
<section id="b_cdoc_setPostProcessingCallback" class="level4">
<h4>b_cdoc_setPostProcessingCallback [callback function name]</h4>
<p><small><em>cdoc/b_cdoc_setPostProcessingCallback</em></small><br />
Set the function to call by b_cdoc_generate each time a code file was fully processed.</p>
<p>The callback function should be declared as follows:</p>
<pre><code>callback_function_name [processed input] [input file] [document output format]
[processed input]: Everything that was found to match the 
                   extraction regex in the [input file] by b_cdoc_generate.
[input file]:      The original input file.
[document output format]: chosen output format
returns:           whatever should be added to the output document for the 
                   given input file (usually the processed input or some filtered
                   version of it); a non-zero exit code will abort further processing</code></pre>
<p><span class="ret"><strong>returns</strong>: nothing</span><br />
<span class="ann"><em><span class="citation" data-cites="StateChanging">@StateChanging</span></em></span></p>
</section>
<section id="b_cdoc_getPostProcessingCallback" class="level4">
<h4>b_cdoc_getPostProcessingCallback</h4>
<p><small><em>cdoc/b_cdoc_getPostProcessingCallback</em></small><br />
See the setter.<br />
<span class="ret"><strong>returns</strong>: The property that was set.</span></p>
</section>
<section id="b_cdoc_setDocumentEndCallback" class="level4">
<h4>b_cdoc_setDocumentEndCallback [callback function name]</h4>
<p><small><em>cdoc/b_cdoc_setDocumentEndCallback</em></small><br />
Set the function to call by b_cdoc_generate exactly once right after it generated the output document.</p>
<p>The callback function should be declared as follows:</p>
<pre><code>callback_function_name [document output file] [document output format]
[document output file]: path to the document output file
                        (may not exist and should not be written to)
[document output format]: chosen output format
returns:                whatever should be added to the end of the output
                        document; a non-zero exit code will abort further processing</code></pre>
<p><span class="ret"><strong>returns</strong>: nothing</span><br />
<span class="ann"><em><span class="citation" data-cites="StateChanging">@StateChanging</span></em></span></p>
</section>
<section id="b_cdoc_getDocumentEndCallback" class="level4">
<h4>b_cdoc_getDocumentEndCallback</h4>
<p><small><em>cdoc/b_cdoc_getDocumentEndCallback</em></small><br />
See the setter.<br />
<span class="ret"><strong>returns</strong>: The property that was set.</span></p>
</section>
<section id="b_cdoc_setBlockCallback" class="level4">
<h4>b_cdoc_setBlockCallback [callback function name]</h4>
<p><small><em>cdoc/b_cdoc_setBlockCallback</em></small><br />
Set the function to call by b_cdoc_generate each time it hits a block of matching comments.</p>
<p>The callback function should be declared as follows:</p>
<pre><code>callback_function_name [block] [input file] [document output format]
[block]:         The full block of documentation that was identified.
[block counter]: Number of blocks previously seen.
[input file]:    The original input file.
[document output format]: chosen output format
returns:         whatever should be added instead of the given block;
                 a non-zero exit code will abort further processing</code></pre>
<p><span class="ret"><strong>returns</strong>: nothing</span><br />
<span class="ann"><em><span class="citation" data-cites="StateChanging">@StateChanging</span></em></span></p>
</section>
<section id="b_cdoc_getBlockCallback" class="level4">
<h4>b_cdoc_getBlockCallback</h4>
<p><small><em>cdoc/b_cdoc_getBlockCallback</em></small><br />
See the setter.<br />
<span class="ret"><strong>returns</strong>: The property that was set.</span></p>
</section>
<section id="b_cdoc_generate" class="level4">
<h4>b_cdoc_generate [input files] [output file] [output format] [additional pandoc options]</h4>
<p><small><em>cdoc/b_cdoc_generate</em></small><br />
Generate a documentation file from the given list of input files or directories.</p>
<p>The concept is really simple: Each <em>block</em> of documentation will trigger the <a href="#b_cdoc_getBlockCallback">b_cdoc_getBlockCallback</a> exactly once and you may add additional parsing logic on a block-wise level.<br />
The following example will call the block callback twice (once with three <code>block 1</code> lines and once with two <code>block 2</code> lines):</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a> <span class="co">#+block 1</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true"></a> <span class="co">#+block 1</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true"></a> <span class="co">#+block 1</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true"></a> </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true"></a> <span class="co">#say hello</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true"></a> <span class="bu">echo</span> <span class="st">&quot;hello world&quot;</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true"></a> <span class="co">#+block 2</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true"></a> <span class="co">#+block 2</span></span></code></pre></div>
<p>The other callback functions may be used for further processing.</p>
<p><span class="par">[input files]: Newline-separated list of files or directories to generate the documentation from. The given order is respected; directories are recursively searched for files. It is currently assumed that these files are encoded in UTF-8.</span><br />
<span class="par">[output file]: Path to the documentation file to generate. Should not exist.</span><br />
<span class="par">[output format]: The target format of the documentation to generate. See <a href="https://pandoc.org/">pandoc</a> for a list of available output formats. If none is specified, <a href="https://pandoc.org/">pandoc</a> is bypassed and the input format is chosen as output format. Passing “pandoc” will let <a href="https://pandoc.org/">pandoc</a> decide based on the extension of the output file.</span><br />
<span class="par">[additional pandoc options]: All remainining parameters will be directly passed to <a href="https://pandoc.org/">pandoc</a>. If none are provided, -s is implicitly added as default.</span><br />
<span class="ret"><strong>returns</strong>: Sets a non-zero exit code and exits the script on errors. Output from <a href="https://pandoc.org/">pandoc</a> and other calls may be printed. Otherwise nothing is returned.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_cdoc_generateBlibStyle" class="level4">
<h4>b_cdoc_generateBlibStyle [input files] [output file] [output format] [delete existing]</h4>
<p><small><em>cdoc/b_cdoc_generateBlibStyle</em></small><br />
A convenience wrapper for b_cdoc_generate which sets various reasonable parameters depending on the output format.<br />
<span class="par">[input files]: see b_cdoc_generate</span><br />
<span class="par">[output file]: where to write the generated output documentation to</span><br />
<span class="par">[output format]: currently one of raw|html|pdf|man is supported (default: raw)</span><br />
<span class="par">[delete existing]: whether or not to delete previously created output files (default: true/0); if set to false (1), the function will error out if a previously created file was found</span><br />
<span class="ret"><strong>returns</strong>: full path to the created documentation file on success; otherwise the function may error out</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
<section id="callback-functions" class="level5">
<h5>Callback Functions</h5>
<section id="b_cdoc_cbPrintNewline" class="level6">
<h6>b_cdoc_cbPrintNewline</h6>
<p><small><em>cdoc/b_cdoc_cbPrintNewline</em></small><br />
Prints a newline character.<br />
<span class="ret"><strong>returns</strong>: nothing</span></p>
</section>
<section id="b_cdoc_cbPrintFirstParam" class="level6">
<h6>b_cdoc_cbPrintFirstParam [param]</h6>
<p><small><em>cdoc/b_cdoc_cbPrintFirstParam</em></small><br />
Prints the first parameter.<br />
<span class="par">[param]: The parameter to print.</span><br />
<span class="ret"><strong>returns</strong>: the first parameter</span></p>
</section>
</section>
</section>
</section>
</section>
<section id="daemon" class="level2">
<h2>daemon</h2>
<p>Module providing access to a single background process providing some service (daemon). Exiting the foreground control process will <em>not</em> terminate the background process. Attempting to start multiple background daemons will be prevented in a thread-safe way.</p>
<p>Each background process is assumed to implement a <code>daemon_main</code> function and must be identified by a unique String.</p>
<p>If you need to exchange data with the background service, please have a look at the <a href="#multithreadingipcv">multithreading/ipcv</a> or <a href="#multithreadingipcm">multithreading/ipcm</a> modules.</p>
<p>Known Issue:<br />
Since the daemon cannot detach from its session via <code>setsid</code> in bash, the daemon will remain in the process group of its parent. So killing the parent with e.g. Ctrl-C will cause the parent group including the daemon to terminate. As a workaround, users may either ignore SIGINT requests or make sure the parent exits as soon as possible (recommended).</p>
<p>Copyright (C) 2019 David Hobach LGPLv3<br />
0.5</p>
<section id="dependencies-4" class="level3">
<h3>Dependencies</h3>
<p>kill<br />
mkdir<br />
mktemp<br />
rm<br />
umask</p>
</section>
<section id="imports-4" class="level3">
<h3>Imports</h3>
<p><a href="#fd">fd</a><br />
<a href="#multithreadingmtx">multithreading/mtx</a><br />
<a href="#proc">proc</a></p>
</section>
<section id="global-variables-2" class="level3">
<h3>Global Variables</h3>
<section id="B_DAEMON_ID" class="level4">
<h4>B_DAEMON_ID</h4>
<p><small><em>daemon/B_DAEMON_ID</em></small><br />
Contains the ID of the daemon, if and only if the current process is the daemon process.</p>
</section>
</section>
<section id="functions-4" class="level3">
<h3>Functions</h3>
<section id="b_daemon_init" class="level4">
<h4>b_daemon_init [quiet flag] [main name] [stdout file] [stderr file] [umask setting]</h4>
<p><small><em>daemon/b_daemon_init</em></small><br />
Init the module paramters. It is necessary to call this method <em>before</em> using any other of this module unless you want to use the default paramters.<br />
<span class="par">[quiet flag]: If set to 0 (default), don’t print anything to stdout during the execution of start|stop|restart|status. Otherwise use <a href="#b_info">b_info</a> to print informational messages.</span><br />
<span class="par">[main name]: Name of the main loop function to execute in the background process. Returning from that function will exit the background process. Default: <code>daemon_main</code></span><br />
<span class="par">[stdout file]: Where the background process should write its stdout stream to (default: /dev/null). Lines are appended.</span><br />
<span class="par">[stderr file]: Where the background process should write its stderr stream to (default: /dev/null). Lines are appended.</span><br />
<span class="par">[umask settings]: The umask settings to apply to the daemon (default: 0).</span><br />
<span class="ret"><strong>returns</strong>: Nothing.</span><br />
<span class="ann"><em><span class="citation" data-cites="StateChanging">@StateChanging</span></em></span></p>
</section>
<section id="b_daemon_start" class="level4">
<h4>b_daemon_start [id] [arg 1] … [arg n]</h4>
<p><small><em>daemon/b_daemon_start</em></small><br />
Start the background process.<br />
If you need to start it as a different user, simply run this function as a different user with e.g. (b_execFuncAs)[#b_execFuncAs]. Please keep in mind that control processes must have the permission to send signals to the daemon PID though.<br />
<span class="par">[id]: Unique identifying String of the daemon to distinguish it from others.</span><br />
<span class="par">[arg i]: An arbitrary number of arguments which can be passed to the main loop.</span><br />
<span class="ret"><strong>returns</strong>: Sets a zero exit code on success. Otherwise sets a non-zero exit code. In particular <a href="#B_E">B_E</a> is called, if the daemon is already running.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_daemon_stop" class="level4">
<h4>b_daemon_stop [id] [termination signal] [kill timeout]</h4>
<p><small><em>daemon/b_daemon_stop</em></small><br />
Stop the background process.<br />
<span class="par">[id]: Unique identifying String of the daemon to distinguish it from others.</span><br />
<span class="par">[termination signal]: A number or string specifying the signal to send to the daemon (default: 15 / SIGTERM). See <code>kill -l</code> for an overview.</span><br />
<span class="par">[kill timeout]: Time in seconds after which the background process will be killed, if it remains unresponsive to the termination signal (default: 0 = wait indefinitely).</span><br />
<span class="ret"><strong>returns</strong>: Sets a zero exit code, if the daemon terminated by itself. An exit code of 2 indicates that the daemon had to be killed. An exit code of 3 means that it wasn’t running. <a href="#B_E">B_E</a> is called on unexpected errors.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_daemon_restart" class="level4">
<h4>b_daemon_restart [id] [termination signal] [kill timeout] [arg 1] … [arg n]</h4>
<p><small><em>daemon/b_daemon_restart</em></small><br />
Restart the background process.<br />
<span class="par">[id]: Unique identifying String of the daemon to distinguish it from others.</span><br />
<span class="par">[termination signal]: See <a href="#b_daemon_stop">b_daemon_stop</a>.</span><br />
<span class="par">[kill timeout]: See <a href="#b_daemon_stop">b_daemon_stop</a>.</span><br />
<span class="par">[arg i]: An arbitrary number of arguments which can be passed to the main loop.</span><br />
<span class="ret"><strong>returns</strong>: See <a href="#b_daemon_start">b_daemon_start</a>.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_daemon_statusPid" class="level4">
<h4>b_daemon_statusPid [id]</h4>
<p><small><em>daemon/b_daemon_statusPid</em></small><br />
Check the status of the background process.<br />
Doesn’t print informational messages to stdout.<br />
<span class="par">[id]: Unique identifying String of the daemon to distinguish it from others.</span><br />
<span class="ret"><strong>returns</strong>: The PID and sets a zero exit code, if the daemon is running and a non-zero exit code otherwise. <a href="#B_E">B_E</a> is only called on exceptional errors.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_daemon_status" class="level4">
<h4>b_daemon_status [id]</h4>
<p><small><em>daemon/b_daemon_status</em></small><br />
Check the status of the background process and print informational messages to stdout (if configured).<br />
<span class="par">[id]: Unique identifying String of the daemon to distinguish it from others.</span><br />
<span class="ret"><strong>returns</strong>: Sets a zero exit code, if the daemon is running and a non-zero exit code otherwise. <a href="#B_E">B_E</a> is only called on exceptional errors.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_daemon_getPid" class="level4">
<h4>b_daemon_getPid [id]</h4>
<p><small><em>daemon/b_daemon_getPid</em></small><br />
Get the process ID of the background process.<br />
<span class="par">[id]: Unique identifying String of the daemon to distinguish it from others.</span><br />
<span class="ret"><strong>returns</strong>: The process ID and sets a zero exit code, if it could be obtained. Please note that the process may be dead anyway (use <a href="#b_daemon_statusPid">b_daemon_statusPid</a> for that). Otherwise a non-zero exit code is set. <a href="#B_E">B_E</a> is only called on exceptional errors.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_daemon_sendSignal" class="level4">
<h4>b_daemon_sendSignal [id] [signal]</h4>
<p><small><em>daemon/b_daemon_sendSignal</em></small><br />
Send a signal to the daemon.<br />
For termination signals, please use <a href="#b_daemon_stop">b_daemon_stop</a> instead.<br />
<span class="par">[id]: Unique identifying String of the daemon to distinguish it from others.</span><br />
<span class="par">[signal]: A number or string specifying the signal to send to the daemon. See <code>kill -l</code> for an overview.</span><br />
<span class="ret"><strong>returns</strong>: Sets a zero exit code, if the daemon was running and a non-zero exit code otherwise. <a href="#B_E">B_E</a> is only called on exceptional errors.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
</section>
</section>
<section id="date" class="level2">
<h2>date</h2>
<p>Collection of date and time related functions.</p>
<p>Copyright (C) 2018 David Hobach LGPLv3<br />
0.3</p>
<section id="dependencies-5" class="level3">
<h3>Dependencies</h3>
<p>date</p>
</section>
<section id="imports-5" class="level3">
<h3>Imports</h3>
<p>no imports</p>
</section>
<section id="functions-5" class="level3">
<h3>Functions</h3>
<section id="b_date_add" class="level4">
<h4>b_date_add <a href="#date">date</a> [time] [unit] [format] [utc flag]</h4>
<p><small><em>date/b_date_add</em></small><br />
Add the given number of seconds to the given date.<br />
<span class="par">[date]: date to add seconds to; the format must be understood by the Unix date utility</span><br />
<span class="par">[time]: amount of time to add</span><br />
<span class="par">[unit]: unit of the time to add, may be one of d (days), h (hours) m (minutes), s (seconds, default)</span><br />
<span class="par">[format]: output format of the date, in Unix date notation (default: use the localized output)</span><br />
<span class="par">[utc flag]: if set to 0, use UTC as time zone if not specified for the input <em>and</em> use it for the output (default: 1 = local time zone)</span><br />
<span class="ret"><strong>returns</strong>: The input date with the given number of seconds added, in the requested format; returns a non-zero exit code on errors.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_date_addDays" class="level4">
<h4>b_date_addDays <a href="#date">date</a> [days] [format] [utc flag]</h4>
<p><small><em>date/b_date_addDays</em></small><br />
Convenience wrapper to <a href="#b_date_add">b_date_add</a> with days.<br />
<span class="par">[date]: See <a href="#b_date_add">b_date_add</a>.</span><br />
<span class="par">[days]: Number of days to add.</span><br />
<span class="par">[format]: See <a href="#b_date_add">b_date_add</a>.</span><br />
<span class="par">[utc flag]: See <a href="#b_date_add">b_date_add</a>.</span><br />
<span class="ret"><strong>returns</strong>: See <a href="#b_date_add">b_date_add</a>.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_date_diff" class="level4">
<h4>b_date_diff [date 1] [date 2] [unit]</h4>
<p><small><em>date/b_date_diff</em></small><br />
Get the amount of time between the two dates, i.e. [date 2] - [date 1].<br />
<span class="par">[date 2], [date 1]: the two dates to subtract; the time part is assumed to be identical if not specified within the dates</span><br />
<span class="par">[unit]: unit of the result, may be one of d (days), h (hours) m (minutes), s (seconds, default)</span><br />
<span class="ret"><strong>returns</strong>: The amount of time between the given two dates [date 2] - [date 1], rounded down. Returns a non-zero exit code on errors.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_date_getFileModAge" class="level4">
<h4>b_date_getFileModAge [file] [unit]</h4>
<p><small><em>date/b_date_getFileModAge</em></small><br />
Get the time that passed since the last modification of the file.<br />
<span class="par">[file]: Full path to the file to check.</span><br />
<span class="par">[unit]: unit of the time to retrieve, may be one of d (days), h (hours) m (minutes), s (seconds, default)</span><br />
<span class="ret"><strong>returns</strong>: The amount of time in the given unit since the last modification. May be rounded down. Sets a non-zero exit code on errors.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
</section>
</section>
<section id="delay" class="level2">
<h2>delay</h2>
<p>Simplistic module to delay commands to a future time.<br />
Requires polling.</p>
<p>All timestamps in this module must be integers and a larger timestamp must denote a time <em>after</em> a smaller timestamp.</p>
<p>Copyright (C) 2019 David Hobach LGPLv3<br />
0.3</p>
<section id="dependencies-6" class="level3">
<h3>Dependencies</h3>
<p>no dependencies</p>
</section>
<section id="imports-6" class="level3">
<h3>Imports</h3>
<p>no imports</p>
</section>
<section id="global-variables-3" class="level3">
<h3>Global Variables</h3>
<section id="B_DELAY_EXECUTED" class="level4">
<h4>B_DELAY_EXECUTED</h4>
<p><small><em>delay/B_DELAY_EXECUTED</em></small><br />
The number of commands executed during the last invocation of <a href="#b_delay_execute">b_delay_execute</a>.</p>
</section>
</section>
<section id="functions-6" class="level3">
<h3>Functions</h3>
<section id="b_delay_to" class="level4">
<h4>b_delay_to [timestamp] [command]</h4>
<p><small><em>delay/b_delay_to</em></small><br />
Delay the given command to be executed at the given time.<br />
<span class="par">[timestamp]: An integer timestamp (e.g. $SECONDS, Unix timestamp in s/ms/ns, …).</span><br />
<span class="par">[command]: The command to execute at the given time.</span><br />
<span class="ret"><strong>returns</strong>: Nothing.</span><br />
<span class="ann"><em><span class="citation" data-cites="StateChanging">@StateChanging</span></em></span></p>
</section>
<section id="b_delay_execute" class="level4">
<h4>b_delay_execute [timestamp]</h4>
<p><small><em>delay/b_delay_execute</em></small><br />
Execute all commands which are due at the given time.<br />
<span class="par">[timestamp]: Integer timestamp representing the current point in time.</span><br />
<span class="ret"><strong>returns</strong>: Nothing. The exit code is equal to the number of commands with a non-zero exit code. <a href="#B_DELAY_EXECUTED">B_DELAY_EXECUTED</a> is updated with the number of commands executed.</span><br />
<span class="ann"><em><span class="citation" data-cites="StateChanging">@StateChanging</span></em></span></p>
</section>
<section id="b_delay_getCommandAt" class="level4">
<h4>b_delay_getCommandAt [timestamp]</h4>
<p><small><em>delay/b_delay_getCommandAt</em></small><br />
Get the set of commands to be executed at the given point in time.<br />
<span class="par">[timestamp]: Integer timestamp denoting the time for which to retrieve the commands.</span><br />
<span class="ret"><strong>returns</strong>: The commands to execute at that time.</span></p>
</section>
</section>
</section>
<section id="dmcrypt" class="level2">
<h2>dmcrypt</h2>
<p>Abstraction layer for cryptsetup / dm-crypt.</p>
<p>Features:<br />
- automatic management of dm-crypt devices<br />
- password support for non-tty environments</p>
<p>Copyright (C) 2020 David Hobach LGPLv3<br />
0.6</p>
<section id="dependencies-7" class="level3">
<h3>Dependencies</h3>
<p>dirname<br />
head<br />
mkdir<br />
readlink</p>
</section>
<section id="imports-7" class="level3">
<h3>Imports</h3>
<p><a href="#hash">hash</a><br />
<a href="#ui">ui</a></p>
</section>
<section id="functions-7" class="level3">
<h3>Functions</h3>
<section id="b_dmcrypt_init" class="level4">
<h4>b_dmcrypt_init [ui mode]</h4>
<p><small><em>dmcrypt/b_dmcrypt_init</em></small><br />
Initialize this module. This function <em>must</em> be called at least once before using any of the other functions.<br />
<span class="par">[ui mode]: How to request a password from the user: auto|gui|tty (default: auto).</span><br />
<span class="ret"><strong>returns</strong>: Nothing.</span><br />
<span class="ann"><em><span class="citation" data-cites="StateChanging">@StateChanging</span></em></span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_dmcrypt_getMapperName" class="level4">
<h4>b_dmcrypt_getMapperName [path]</h4>
<p><small><em>dmcrypt/b_dmcrypt_getMapperName</em></small><br />
Get the name of the dm-crypt mapper for a given path.<br />
<span class="par">[path]: Full path to an encrypted file.</span><br />
<span class="ret"><strong>returns</strong>: A mapper name. This doesn’t necessarily mean that the encrypted container is open. Use <a href="#b_dmcrypt_isOpen">b_dmcrypt_isOpen</a> for that.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_dmcrypt_createLuks" class="level4">
<h4>b_dmcrypt_createLuks [path] [size] [fs type] [entropy source] [password prompt] [dm-crypt option 1] … [dm-crypt option n]</h4>
<p><small><em>dmcrypt/b_dmcrypt_createLuks</em></small><br />
Create an encrypted luks container file at the given location.<br />
This function may request a password from the user and usually requires root access rights.<br />
<span class="par">[path]: Full path to the encrypted file to create.</span><br />
<span class="par">[size]: Filesystem size in bytes to create. Supported suffixes: b 512, kB 1000, K 1024, MB 1000<em>1000, M 1024</em>1024, GB 1000<em>1000</em>1000, G 1024<em>1024</em>1024</span><br />
<span class="par">[fs type]: Filesystem to create inside the encrypted container. If none is specified (default), no file system is created.</span><br />
<span class="par">[entropy source]: Source of entropy to use for the file setup (default: /dev/urandom).</span><br />
<span class="par">[password prompt]: Prompt string to ask the user for his password (optional).</span><br />
<span class="par">[dm-crypt option i]: These options are directly passed to <code>cryptsetup</code>.</span><br />
<span class="ret"><strong>returns</strong>: Sets a zero exit code on success and errors out with <a href="#B_E">B_E</a> otherwise.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_dmcrypt_open" class="level4">
<h4>b_dmcrypt_open [path] [mount point] [output var] [password prompt] [dm-crypt option 1] … [dm-crypt option n]</h4>
<p><small><em>dmcrypt/b_dmcrypt_open</em></small><br />
Open/Decrypt the given container and optionally mount it.<br />
<span class="par">[path]: Full path to the encrypted file.</span><br />
<span class="par">[mount point]: Where to mount the decrypted data (optional). If no mount point is specified, it will not be mounted.</span><br />
<span class="par">[output var]: The name of the variable to write the created device to (optional).</span><br />
<span class="par">[password prompt]: Prompt string to ask the user for his password (optional).</span><br />
<span class="par">[dm-crypt option i]: These options are directly passed to <code>cryptsetup</code>.</span><br />
<span class="ret"><strong>returns</strong>: Sets a zero exit code on success.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_dmcrypt_close" class="level4">
<h4>b_dmcrypt_close [path] [dm-crypt option 1] … [dm-crypt option n]</h4>
<p><small><em>dmcrypt/b_dmcrypt_close</em></small><br />
Close the given encrypted container.<br />
<span class="par">[path]: Full path to the encrypted file.</span><br />
<span class="par">[dm-crypt option i]: These options are directly passed to <code>cryptsetup</code>.</span><br />
<span class="ret"><strong>returns</strong>: A zero exit code on success. The exit code may also be zero for non-existing or already closed containers.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_dmcrypt_isOpen" class="level4">
<h4>b_dmcrypt_isOpen [path]</h4>
<p><small><em>dmcrypt/b_dmcrypt_isOpen</em></small><br />
Check whether the given encrypted container is open (not necessarily mounted).<br />
<span class="par">[path]: Full path to the encrypted file.</span><br />
<span class="ret"><strong>returns</strong>: Sets a zero exit code, if and only if the container is open. <a href="#B_E">B_E</a> is only called for exceptional errors.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
</section>
</section>
<section id="fd" class="level2">
<h2>fd</h2>
<p>Collection of file descriptor related functions.</p>
<p>Copyright (C) 2021 David Hobach LGPLv3<br />
0.3</p>
<section id="dependencies-8" class="level3">
<h3>Dependencies</h3>
<p>no dependencies</p>
</section>
<section id="imports-8" class="level3">
<h3>Imports</h3>
<p>no imports</p>
</section>
<section id="functions-8" class="level3">
<h3>Functions</h3>
<section id="b_fd_getOpen" class="level4">
<h4>b_fd_getOpen [pid]</h4>
<p><small><em>fd/b_fd_getOpen</em></small><br />
Retrieve all open file descriptors for the given PID.<br />
<span class="par">[pid]: process ID (default: <code>$$</code>)</span><br />
<span class="ret"><strong>returns</strong>: Newline-separated list of open file descriptor numbers; a non-zero exit code indicates that the process could not be found.</span></p>
</section>
<section id="b_fd_closeNonStandard" class="level4">
<h4>b_fd_closeNonStandard</h4>
<p><small><em>fd/b_fd_closeNonStandard</em></small><br />
Close all non-standard file descriptors (i.e. those &gt; 2) held by the current process.<br />
<span class="ret"><strong>returns</strong>: Nothing. <a href="#B_E">B_E</a> is called on unexpected errors.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_fd_closeAll" class="level4">
<h4>b_fd_closeAll</h4>
<p><small><em>fd/b_fd_closeAll</em></small><br />
Close all file descriptors held by the current process.<br />
<span class="ret"><strong>returns</strong>: Nothing. <a href="#B_E">B_E</a> is called on unexpected errors.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
</section>
</section>
<section id="flog" class="level2">
<h2>flog</h2>
<p>Flexible log writer for bash.</p>
<p>Features:<br />
- arbitrary output support (files, network streams, stdout, stderr, …) in a user-defined format<br />
- optional log file reduction<br />
- optional thread safety<br />
- support for partial messages</p>
<p>In order to log to the system log, please use the logger command instead. This library is mostly meant for application logs handled in a more custom manner.</p>
<p>Exact format of log entries:</p>
<pre><code> [header][message]
 [header]: Can be arbitrarily defined in the 
           respective callback function. If nothing
           is defined, the below default header
           is used:
 [default header] = &#39;[default date] &#39;
 [default date]: current date in the format as used
           by date +&quot;%F %T %Z&quot; (the format can be changed)</code></pre>
<p>Copyright (C) 2020 David Hobach LGPLv3<br />
0.6</p>
<section id="dependencies-9" class="level3">
<h3>Dependencies</h3>
<p>cat<br />
date<br />
mkdir<br />
mktemp<br />
readlink<br />
rm<br />
tail</p>
</section>
<section id="imports-9" class="level3">
<h3>Imports</h3>
<p><a href="#fs">fs</a><br />
<a href="#hash">hash</a><br />
<a href="#multithreadingmtx">multithreading/mtx</a></p>
</section>
<section id="global-variables-4" class="level3">
<h3>Global Variables</h3>
<section id="B_FLOG_SEV" class="level4">
<h4>B_FLOG_SEV</h4>
<p><small><em>flog/B_FLOG_SEV</em></small><br />
Global map for human readable severities which may be used by users of this script.<br />
It was inspired by the severities of RFC5424.<br />
Currently supported values: emergency|alert|critical|crit|error|err|warning|warn|notice|informational|info|debug</p>
</section>
</section>
<section id="functions-9" class="level3">
<h3>Functions</h3>
<section id="b_flog_printSeverity" class="level4">
<h4>b_flog_printSeverity [severity]</h4>
<p><small><em>flog/b_flog_printSeverity</em></small><br />
<span class="par">[severity]: see <a href="#b_flog_init">b_flog_init</a></span><br />
Print the given severity in a way for logging. This function is meant to be used as building block for header functions.<br />
<span class="ret"><strong>returns</strong>: a printed version of the given severity for logging</span></p>
</section>
<section id="b_flog_close" class="level4">
<h4>b_flog_close</h4>
<p><small><em>flog/b_flog_close</em></small><br />
close the currently open log; is automatically called, but users may want to call it themselves to force the respective file descriptor to be closed before the program is ended<br />
<span class="ret"><strong>returns</strong>: nothing</span><br />
<span class="ann"><em><span class="citation" data-cites="StateChanging">@StateChanging</span></em></span></p>
</section>
<section id="b_flog_init" class="level4">
<h4>b_flog_init [log file name] [header callback function] [log reduction lines] [thread safe] [intermediate]</h4>
<p><small><em>flog/b_flog_init</em></small><br />
Initialize this log writer. This function <strong>must</strong> be called before any others.<br />
<span class="par">[log file name]: name of the log file to write to; special files such as /dev/stdout, /dev/stderr (default), /dev/tcp, /dev/udp are supported if your bash version supports them; the file doesn’t need to exist</span><br />
<span class="par">[header callback function]: optional name of the function to be called whenever a new log entry is generated; the function must be defined as follows:</span></p>
<pre><code> [header callback function] [severity]
 [severity]: see [b_flog_log](#b_flog_log)
 returns: the full header meant to be used for the current moment in time
          with the given severity (without knowing the message details)
          and sets a non-zero exit code on errors; errors may cause the
          message to be logged without header</code></pre>
<p><span class="par">[log reduction lines]: if set to a positive integer, reduce the log file approximately to that number of lines during logging (default: 3000) - see b_flog_setLogReductionLinesApprox for details; this option has no effect on non-file outputs (stdout, network output, …)</span><br />
<span class="par">[thread safe]: Whether calls to <a href="#b_flog_log">b_flog_log</a> should be thread safe (0) or not (default: 1 = not thread safe).</span><br />
<span class="par">[intermediate]: String to use as intermediate separator when chaining partial log messages (default: <a href="#b_getDefaultMessageHandlerIntermediate">b_getDefaultMessageHandlerIntermediate</a>).</span><br />
<span class="ret"><strong>returns</strong>: sets a non-zero exit code on errors and may exit the script</span><br />
<span class="ann"><em><span class="citation" data-cites="StateChanging">@StateChanging</span></em></span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_flog_log" class="level4">
<h4>b_flog_log [message] [severity] [first part] [last part]</h4>
<p><small><em>flog/b_flog_log</em></small><br />
Log the given message with the given optional severity.<br />
If the [thread safe] variant <a href="#b_flog_init">was chosen</a>, may wait for other log sources to write their message first.<br />
<span class="par">[message]: message to log</span><br />
<span class="par">[severity]: users may pass arbitrary numbers or even Strings here, but it is recommended to stick to the priorities defined in $BLIB_FLOG_SEV (default: ${B_FLOG_SEV[“info”]})</span><br />
<span class="par">[first part]: If set to 0, assume that the given message is the first part of an overall chain of messages (default: 0).</span><br />
<span class="par">[last part]: If set to 0, assume that the given message is the final part of an overall chain of messages (default: 0). Please note that other threads may be blocked from writing to the output, if the last message of a chain was not yet received.</span><br />
<span class="ret"><strong>returns</strong>: Sets a non-zero exit code on errors. <a href="#B_E">B_E</a> is only called, if logging failed entirely.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_flog_messageHandler" class="level4">
<h4>b_flog_messageHandler [message type] [message] [first part] [last part]</h4>
<p><small><em>flog/b_flog_messageHandler</em></small><br />
A <a href="#b_defaultMessageHandler">message handler</a> implementation that handles messages by logging them via <a href="#b_flog_log">b_flog_log</a>.<br />
Issues with the logging system itself (e.g. log file not writable) are written to stderr.<br />
If you don’t want to log all messages and/or handle some of them differently, you can simply write a wrapper for this function.<br />
<span class="par">[message type]: See <a href="#b_defaultMessageHandler">b_defaultMessageHandler</a>.</span><br />
<span class="par">[message]: See <a href="#b_defaultMessageHandler">b_defaultMessageHandler</a>.</span><br />
<span class="par">[first part]: See <a href="#b_defaultMessageHandler">b_defaultMessageHandler</a>.</span><br />
<span class="par">[last part]: See <a href="#b_defaultMessageHandler">b_defaultMessageHandler</a>.</span><br />
<span class="ret"><strong>returns</strong>: Nothing. Never causes errors.</span></p>
</section>
<section id="b_flog_getDateFormat" class="level4">
<h4>b_flog_getDateFormat</h4>
<p><small><em>flog/b_flog_getDateFormat</em></small><br />
Get the date format used for the header by this log writer (see “man date” for explanations).<br />
<span class="ret"><strong>returns</strong>: see above</span></p>
</section>
<section id="b_flog_setDateFormat" class="level4">
<h4>b_flog_setDateFormat [format string]</h4>
<p><small><em>flog/b_flog_setDateFormat</em></small><br />
Set the date format used for the header by this log writer (see “man date” for explanations).<br />
<span class="ret"><strong>returns</strong>: nothing</span><br />
<span class="ann"><em><span class="citation" data-cites="StateChanging">@StateChanging</span></em></span></p>
</section>
<section id="b_flog_getLogReductionLinesLowerBound" class="level4">
<h4>b_flog_getLogReductionLinesLowerBound</h4>
<p><small><em>flog/b_flog_getLogReductionLinesLowerBound</em></small><br />
Get the number of lines that the log file will at least have after a log file reduction.<br />
<span class="ret"><strong>returns</strong>: see above</span></p>
</section>
<section id="b_flog_getLogReductionLinesUpperBound" class="level4">
<h4>b_flog_getLogReductionLinesUpperBound</h4>
<p><small><em>flog/b_flog_getLogReductionLinesUpperBound</em></small><br />
Get the maximum number of lines that the log file will have before it is reduced.<br />
<span class="ret"><strong>returns</strong>: see above</span></p>
</section>
<section id="b_flog_setLogReductionLinesLowerBound" class="level4">
<h4>b_flog_setLogReductionLinesLowerBound [bound]</h4>
<p><small><em>flog/b_flog_setLogReductionLinesLowerBound</em></small><br />
Set the number of lines that the log file will at least have after a log file reduction.<br />
<span class="par">[bound]: number of lines to use for that bound</span><br />
<span class="ret"><strong>returns</strong>: nothing</span><br />
<span class="ann"><em><span class="citation" data-cites="StateChanging">@StateChanging</span></em></span></p>
</section>
<section id="b_flog_setLogReductionLinesUpperBound" class="level4">
<h4>b_flog_setLogReductionLinesUpperBound</h4>
<p><small><em>flog/b_flog_setLogReductionLinesUpperBound</em></small><br />
Set the maximum number of lines that the log file will have before it is reduced.<br />
<span class="par">[bound]: number of lines to use for that bound</span><br />
<span class="ret"><strong>returns</strong>: nothing</span><br />
<span class="ann"><em><span class="citation" data-cites="StateChanging">@StateChanging</span></em></span></p>
</section>
<section id="b_flog_setLogReductionLinesApprox" class="level4">
<h4>b_flog_setLogReductionLinesApprox [line count]</h4>
<p><small><em>flog/b_flog_setLogReductionLinesApprox</em></small><br />
Set the number of average number of lines that the log file should have; counts &lt;= 0 indicate no limit.<br />
<span class="par">[line count]: reduce the log after reaching 1.2*[line count] lines to 0.8*[line count] lines</span><br />
<span class="ret"><strong>returns</strong>: nothing</span><br />
<span class="ann"><em><span class="citation" data-cites="StateChanging">@StateChanging</span></em></span></p>
</section>
<section id="b_flog_getHeaderFunction" class="level4">
<h4>b_flog_getHeaderFunction</h4>
<p><small><em>flog/b_flog_getHeaderFunction</em></small><br />
Get the name of the header callback function that is used.<br />
<span class="ret"><strong>returns</strong>: see above</span></p>
</section>
<section id="b_flog_setHeaderFunction" class="level4">
<h4>b_flog_setHeaderFunction [header function]</h4>
<p><small><em>flog/b_flog_setHeaderFunction</em></small><br />
Set the name of the header callback function to be used.<br />
<span class="par">[header function]: name of the header function to use</span><br />
<span class="ret"><strong>returns</strong>: nothing</span><br />
<span class="ann"><em><span class="citation" data-cites="StateChanging">@StateChanging</span></em></span></p>
<section id="header-functions" class="level5">
<h5>Header Functions</h5>
<section id="b_flog_defaultHeader" class="level6">
<h6>b_flog_defaultHeader [severity]</h6>
<p><small><em>flog/b_flog_defaultHeader</em></small><br />
Default header callback function used with <a href="#b_flog_init">b_flog_init</a>.<br />
<span class="par">[severity]: the default header ignores the severity</span><br />
<span class="ret"><strong>returns</strong>: the default header meant to be used for the current moment in time</span></p>
</section>
<section id="b_flog_headerDateSeverity" class="level6">
<h6>b_flog_headerDateSeverity [severity]</h6>
<p><small><em>flog/b_flog_headerDateSeverity</em></small><br />
An alternative to the default header callback function which appends the severity to the default header.<br />
<span class="par">[severity]: see <a href="#b_flog_init">b_flog_init</a></span><br />
<span class="ret"><strong>returns</strong>: the default header with the severity appended</span></p>
</section>
<section id="b_flog_headerDateScriptSeverity" class="level6">
<h6>b_flog_headerDateScriptSeverity [severity]</h6>
<p><small><em>flog/b_flog_headerDateScriptSeverity</em></small><br />
An alternative to the default header callback function which appends the calling script and the severity to the default header.<br />
<span class="par">[severity]: see <a href="#b_flog_init">b_flog_init</a></span><br />
<span class="ret"><strong>returns</strong>: the default header with the calling script and severity appended</span></p>
</section>
</section>
</section>
</section>
</section>
<section id="fs" class="level2">
<h2>fs</h2>
<p>Collection of file and file system related functions.</p>
<p>Copyright (C) 2022 David Hobach LGPLv3<br />
0.4</p>
<section id="dependencies-10" class="level3">
<h3>Dependencies</h3>
<p>cat<br />
findmnt<br />
head<br />
lsblk<br />
mktemp<br />
mount<br />
rm<br />
stat<br />
sync<br />
wc</p>
</section>
<section id="imports-10" class="level3">
<h3>Imports</h3>
<p>no imports</p>
</section>
<section id="functions-10" class="level3">
<h3>Functions</h3>
<section id="b_fs_isEmptyDir" class="level4">
<h4>b_fs_isEmptyDir [dir]</h4>
<p><small><em>fs/b_fs_isEmptyDir</em></small><br />
Check whether the given directory is empty or non-existing. It is not checked whether the passed parameter is a file preventing a directory from being created.<br />
<span class="par">[dir]: full path to the directory to check</span><br />
<span class="ret"><strong>returns</strong>: a zero exit code if the directory does not exist or is empty</span></p>
</section>
<section id="b_fs_getLineCount" class="level4">
<h4>b_fs_getLineCount [file]</h4>
<p><small><em>fs/b_fs_getLineCount</em></small><br />
Get the number of lines of the given file.<br />
<span class="par">[file]: full path to a file</span><br />
<span class="ret"><strong>returns</strong>: the number of lines; a non-zero exit code is set on errors</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_fs_waitForFile" class="level4">
<h4>b_fs_waitForFile [file] [maximum time]</h4>
<p><small><em>fs/b_fs_waitForFile</em></small><br />
Sleep until the given file appears. The check interval is 1s.<br />
<span class="par">[file]: full path to the file or directory to wait for</span><br />
<span class="par">[maximum time]: maximum time in s to wait for the file to appear (default: forever)</span><br />
<span class="ret"><strong>returns</strong>: Sets a zero exit code if the file appeared and a non-zero exit code on a timeout.</span></p>
</section>
<section id="b_fs_getMountpoints" class="level4">
<h4>b_fs_getMountpoints [device]</h4>
<p><small><em>fs/b_fs_getMountpoints</em></small><br />
Get all mountpoints for the given device.<br />
<span class="par">[device]: Full path to the device (incl. /dev/) for which to obtain the mountpoints.</span><br />
<span class="ret"><strong>returns</strong>: A newline-separated list of mountpoints where the given device is mounted to. Sets a non-zero exit code if no such mountpoints were found.</span></p>
</section>
<section id="b_fs_mountIfNecessary" class="level4">
<h4>b_fs_mountIfNecessary [device] [mount point] [enforce] [mount options]</h4>
<p><small><em>fs/b_fs_mountIfNecessary</em></small><br />
Mount the given device if it isn’t already mounted.<br />
<span class="par">[device]: Full path to the device (incl. /dev/) to mount.</span><br />
<span class="par">[mount point]: Full path where to mount the device. If no mount point is specified, a /tmp/ mount point is chosen. Non-existing directories are created. Is ignored if another mount point already exists.</span><br />
<span class="par">[enforce]: If set to 0, enforce the given mount point to be used in addition to potentially existing ones (default: 1). Mount options are ignored.</span><br />
<span class="par">[mount options]: Options to pass to <code>mount</code>, if it needs to be executed (default: none).</span><br />
<span class="ret"><strong>returns</strong>: The chosen mount point or a newline-separated list of existing mount points on success; sets a non-zero exit code on failure.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_fs_createLoopDeviceIfNecessary" class="level4">
<h4>b_fs_createLoopDeviceIfNecessary [file]</h4>
<p><small><em>fs/b_fs_createLoopDeviceIfNecessary</em></small><br />
Create a loop device for the given file if no old one exists. Usually requires root access rights.<br />
<span class="par">[file]: File for which to create a loop device.</span><br />
<span class="ret"><strong>returns</strong>: Created loop device or previously used one (incl. /dev/). Sets a non-zero exit code, if no device could be created.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_fs_removeUnusedLoopDevice" class="level4">
<h4>b_fs_removeUnusedLoopDevice [device|file]</h4>
<p><small><em>fs/b_fs_removeUnusedLoopDevice</em></small><br />
Remove a loop device, if and only if it is unused by the operating system. Otherwise mark it for removal once it becomes unused. Usually requires root access rights.<br />
<span class="par">[device|file]: Full path (incl. /dev/) to the loop device or to the backing file.</span><br />
<span class="ret"><strong>returns</strong>: Sets a zero exit code, if the loop device was not used and could thus be successfully removed <em>or</em> does not exist. A nonzero exit code indicates that the device is still being used. <a href="#B_E">B_E</a> is called on other errors.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_fs_parseSize" class="level4">
<h4>b_fs_parseSize [string] [check flag]</h4>
<p><small><em>fs/b_fs_parseSize</em></small><br />
Parse human-readable file system sizes that include units.<br />
<span class="par">[string]: A string denoting a file system size of the format [number][unit]. Unit may be one of KB 1000, K 1024, MB 1000<em>1000, M 1024</em>1024, GB 1000<em>1000</em>1000, G 1024<em>1024</em>1024, and so on for T, P. If no unit is provided, the number is assumed to denote bytes. The number must be an integer.</span><br />
<span class="par">[check flag]: Check whether the result makes sense (default: 0/true). This check will make integer overflows less likely.</span><br />
<span class="ret"><strong>returns</strong>: The respective number of bytes meant with the given string. <a href="#B_E">B_E</a> is called on parsing errors.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_fs_removeWithOverwrite" class="level4">
<h4>b_fs_removeWithOverwrite [file] [randomness source]</h4>
<p><small><em>fs/b_fs_removeWithOverwrite</em></small><br />
Overwrite the given file with random data, then remove it. This is meant to prevent a potential reconstruction of the file after its removal.<br />
<em>Warning</em>: The reconstruction may still work on some types of file systems or physical storage systems (e.g. on flash disks/SSDs).<br />
<span class="par">[file]: Full path to the file to remove. Directories are currently not supported.</span><br />
<span class="par">[randomness source]: Device to use as source of random data (default: /dev/urandom).</span><br />
<span class="ret"><strong>returns</strong>: Nothing. <a href="#B_E">B_E</a> is called on errors.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_fs_isRotatingDrive" class="level4">
<h4>b_fs_isRotatingDrive [block device]</h4>
<p><small><em>fs/b_fs_isRotatingDrive</em></small><br />
Check whether the given block device is a rotating disk (non-SSD) or not.<br />
<span class="par">[block device]: Device name or path to check.</span><br />
<span class="ret"><strong>returns</strong>: Nothing. Sets a zero exit code, if the device is a rotating one. Non-existing devices trigger <a href="#B_E">B_E</a>.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_fs_getBlockDevice" class="level4">
<h4>b_fs_getBlockDevice [file]</h4>
<p><small><em>fs/b_fs_getBlockDevice</em></small><br />
Get the block device on which the given file or directory is stored.<br />
<span class="par">[file]: Full path to the file.</span><br />
<span class="ret"><strong>returns</strong>: Full device path where the given file or directory is stored. May return pseudo file systems (e.g. tmpfs).</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_fs_removeRelativelySafely" class="level4">
<h4>b_fs_removeRelativelySafely [file] [randomness source]</h4>
<p><small><em>fs/b_fs_removeRelativelySafely</em></small><br />
A best-effort implementation that attempts to remove files from the file system in a non-reconstructible way.<br />
Contrary to <a href="#b_fs_removeWithOverwrite">b_fs_removeWithOverwrite</a> it’ll attempt to achieve similar results on SSDs.<br />
<strong>May require root privileges.</strong><br />
<em>Warning</em>: The reconstruction may still work depending on your hardware.<br />
<span class="par">[file]: Full path to the file to remove. Directories are currently not supported.</span><br />
<span class="par">[randomness source]: Device to use as source of random data (default: /dev/urandom).</span><br />
<span class="ret"><strong>returns</strong>: Nothing. <a href="#B_E">B_E</a> is called on errors.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_fs_enumerate" class="level4">
<h4>b_fs_enumerate [path list] [nonexisting]</h4>
<p><small><em>fs/b_fs_enumerate</em></small><br />
Enumerate all files found in the given list of paths. Recurse into directories as necessary.<br />
<span class="par">[path list]: Newline-separated list of files and directories.</span><br />
<span class="par">[nonexisting]: 0 = Error out with <a href="#B_E">B_E</a> on non-existing files (default). 1 = Silently drop non-existing files. 2 = Include non-exiting files in the output.</span><br />
<span class="ret"><strong>returns</strong>: List of files found in all of the given paths.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
</section>
</section>
<section id="hash" class="level2">
<h2>hash</h2>
<p>Hash functions.</p>
<p>Copyright (C) 2020 David Hobach LGPLv3<br />
0.5</p>
<section id="dependencies-11" class="level3">
<h3>Dependencies</h3>
<p>no dependencies</p>
</section>
<section id="imports-11" class="level3">
<h3>Imports</h3>
<p>no imports</p>
</section>
<section id="b_hash_file" class="level3">
<h3>b_hash_file [file] [algorithm]</h3>
<p><small><em>hash/b_hash_file</em></small><br />
Compute the hash of the given file.<br />
<span class="par">[file]: Full path to the file.</span><br />
<span class="par">[algorithm]: Algorithm to use. Currently supported: md5|sha1|sha224|sha256|sha384|sha512|crc|blake2 (default: md5).</span><br />
<span class="ret"><strong>returns</strong>: The hash of the given file.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_hash_str" class="level3">
<h3>b_hash_str [string] [algorithm]</h3>
<p><small><em>hash/b_hash_str</em></small><br />
Compute the hash of the given string.<br />
<span class="par">[string]: String which to compute the hash for.</span><br />
<span class="par">[algorithm]: Algorithm to use. Currently supported: md5|sha1|sha224|sha256|sha384|sha512|crc|blake2 (default: md5).</span><br />
<span class="ret"><strong>returns</strong>: The hash of the given string.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
</section>
<section id="http" class="level2">
<h2>http</h2>
<p>Collection of http related functions.</p>
<p>Copyright (C) 2018 David Hobach LGPLv3<br />
0.2</p>
<section id="dependencies-12" class="level3">
<h3>Dependencies</h3>
<p>curl</p>
</section>
<section id="imports-12" class="level3">
<h3>Imports</h3>
<p><a href="#types">types</a></p>
</section>
<section id="global-variables-5" class="level3">
<h3>Global Variables</h3>
<section id="B_HTTP_CHECKURLS" class="level4">
<h4>B_HTTP_CHECKURLS</h4>
<p><small><em>http/B_HTTP_CHECKURLS</em></small><br />
Each call to <a href="#b_http_getOnlineStatus">b_http_getOnlineStatus</a> causes one of the URLs in this array to be visited.<br />
It is recommended to pick a relatively large number of URLs with SSL support to remain relatively anonymous, if <a href="#b_http_getOnlineStatus">b_http_getOnlineStatus</a> is called multiple times.<br />
Defaults to the European/US Alexa Top 10 (which hopefully blends in to the masses).</p>
</section>
</section>
<section id="functions-11" class="level3">
<h3>Functions</h3>
<section id="b_http_rawUrlEncode" class="level4">
<h4>b_http_rawUrlEncode [string]</h4>
<p><small><em>http/b_http_rawUrlEncode</em></small><br />
Encode the given string according to RFC 3986.<br />
<span class="par">[string]: to encode</span><br />
<span class="ret"><strong>returns</strong>: Returns a string in which all non-alphanumeric characters except -_.~ have been replaced with a percent (%) sign followed by two hex digits. This is the encoding described in RFC 3986 for protecting literal characters from being interpreted as special URL delimiters, and for protecting URLs from being mangled by transmission media with character conversions (like some email systems). A non-zero exit code is set on errors.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_http_rawUrlDecode" class="level4">
<h4>b_http_rawUrlDecode [string]</h4>
<p><small><em>http/b_http_rawUrlDecode</em></small><br />
Decode the given string encoded with b_str_rawUrlEncode or an equivalent function.<br />
<span class="par">[string]: to decode</span><br />
<span class="ret"><strong>returns</strong>: The literal string with all hex characters replaced; a non-zero exit code is set on errors.</span></p>
</section>
<section id="b_http_getOnlineStatus" class="level4">
<h4>b_http_getOnlineStatus [timeout]</h4>
<p><small><em>http/b_http_getOnlineStatus</em></small><br />
Find out whether we are online or not by attempting an http connection.<br />
One of <a href="#B_HTTP_CHECKURLS">B_HTTP_CHECKURLS</a> is possibly visited during the process.<br />
Use <a href="#b_net_getDNSStatus">b_net_getDNSStatus</a> for DNS-only checks.<br />
<span class="par">[timeout]: Timeout in seconds for hanging checks (default: 5).</span><br />
<span class="ret"><strong>returns</strong>: 0, if we’re online, 1 if only DNS works, 2 if neither DNS nor http(s) worked, 3 if the check timed out; <a href="#B_E">B_E</a> will be called if the status cannot be determined.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_http_testProxy" class="level4">
<h4>b_http_testProxy [proxy string] [intransparent only] [timeout]</h4>
<p><small><em>http/b_http_testProxy</em></small><br />
Test whether the given proxy is working as advertised.<br />
<span class="par">[proxy string]: Connection string to test, e.g. <code>https://1.1.1.1:234</code>.</span><br />
<span class="par">[intransparent only]: If set to 0 (default), only accept intransparent proxies (i.e. those not revealing your IP).</span><br />
<span class="par">[timeout]: Time in seconds after which to consider the proxy non-responsive (default: 5).</span><br />
<span class="ret"><strong>returns</strong>: Nothing, but sets a zero exit code, if and only if the proxy appears to work.</span></p>
</section>
</section>
</section>
<section id="ini" class="level2">
<h2>ini</h2>
<p>Stateful ini reader for bash.</p>
<p>Currently only a single file per instance of this library/thread is kept in memory, but you can read multiple files one after another or in multiple threads.</p>
<p>Implementation Specifics:</p>
<ul>
<li>names/keys &amp; values are case sensitive</li>
<li>comment lines may start with ; or #</li>
<li>whitespace lines are ignored</li>
<li>duplicate names may result in undefined behaviour (usually the second will override the first)</li>
<li>all characters following the = are considered part of the value (incl. whitespace); whitespace before and after the value may be trimmed by the getters though (check their description)</li>
<li>values are not interpreted (e.g. quotes, escape characters, …)</li>
<li>whitespace around keys and around section qualifiers is ignored</li>
</ul>
<p>Copyright (C) 2018 David Hobach LGPLv3<br />
0.5</p>
<section id="dependencies-13" class="level3">
<h3>Dependencies</h3>
<p>no dependencies</p>
</section>
<section id="imports-13" class="level3">
<h3>Imports</h3>
<p>no imports</p>
</section>
<section id="functions-12" class="level3">
<h3>Functions</h3>
<section id="b_ini_read" class="level4">
<h4>b_ini_read [ini file]</h4>
<p><small><em>ini/b_ini_read</em></small><br />
read the given ini file and keep it in thread-local memory so that subsequent calls to the b_ini_get functions will return the values from the ini file; subsequent calls to this function will update the internal state to represent the file last read in this thread<br />
<span class="par">[ini file]: path to the ini file to read</span><br />
<span class="ret"><strong>returns</strong>: an error message on errors and sets a non-zero exit code on errors</span><br />
<span class="ann"><em><span class="citation" data-cites="StateChanging">@StateChanging</span></em></span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_ini_get" class="level4">
<h4>b_ini_get [name] [section]</h4>
<p><small><em>ini/b_ini_get</em></small><br />
get the value for the ini entry with the given name as String in raw format<br />
<span class="par">[name]: name/key of the ini entry to retrieve</span><br />
<span class="par">[section]: section where to look for the entry with the given name (default: without section)</span><br />
<span class="ret"><strong>returns</strong>: value of the ini entry matching exactly the given section and name incl. any whitespace; a non-zero exit code is set if such an entry wasn’t found</span></p>
</section>
<section id="b_ini_getString" class="level4">
<h4>b_ini_getString [name] [section]</h4>
<p><small><em>ini/b_ini_getString</em></small><br />
get the value for the ini entry with the given name as String and remove all whitespace around the returned String<br />
<span class="par">[name]: name/key of the ini entry to retrieve</span><br />
<span class="par">[section]: section where to look for the entry with the given name (default: without section)</span><br />
<span class="ret"><strong>returns</strong>: value of the ini entry matching exactly the given section and name excl. any whitespace around; a non-zero exit code is set if such an entry wasn’t found</span></p>
</section>
<section id="b_ini_getInt" class="level4">
<h4>b_ini_getInt [name] [section]</h4>
<p><small><em>ini/b_ini_getInt</em></small><br />
get the value for the ini entry with the given name as integer<br />
<span class="par">[name]: see <a href="#b_ini_get">b_ini_get</a></span><br />
<span class="par">[section]: see <a href="#b_ini_get">b_ini_get</a></span><br />
<span class="ret"><strong>returns</strong>: see <a href="#b_ini_get">b_ini_get</a>; additionally it is checked whether the return value is an integer (if not, a non-zero exit code of 2 is set and the return value is undefined)</span></p>
</section>
<section id="b_ini_getBool" class="level4">
<h4>b_ini_getBool [name] [section]</h4>
<p><small><em>ini/b_ini_getBool</em></small><br />
get the value for the ini entry with the given name as boolean<br />
<span class="par">[name]: see <a href="#b_ini_get">b_ini_get</a></span><br />
<span class="par">[section]: see <a href="#b_ini_get">b_ini_get</a></span><br />
<span class="ret"><strong>returns</strong>: see <a href="#b_ini_get">b_ini_get</a>; 0 is returned via echo for true, 1 for false; the exit code indicates a potential error during parsing (2) or a missing entry (1) and <em>not</em> true/false</span></p>
</section>
<section id="b_ini_assertNames" class="level4">
<h4>b_ini_assertNames [section 1] [name 1] … [name n] – [section 2] [name 1] … [name m]</h4>
<p><small><em>ini/b_ini_assertNames</em></small><br />
Assert that the given sections contains <em>at most</em> the given names and no additional ones.<br />
This is a useful function to detect user mistakes and should be called right after <a href="#b_ini_read">b_ini_read</a>.<br />
Multiple sections can be separated with “–”.<br />
<span class="par">[section]: see <a href="#b_ini_get">b_ini_get</a></span><br />
<span class="par">[name]: see <a href="#b_ini_get">b_ini_get</a></span><br />
<span class="ret"><strong>returns</strong>: Sets a zero exit code if and only if the last read ini file doesn’t contain any additional names. Otherwise <a href="#B_E">B_E</a> is triggered. <a href="#B_ERR">B_ERR</a> will list the invalid names.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
</section>
</section>
<section id="keys" class="level2">
<h2>keys</h2>
<p>Simple <em>system-wide</em> cryptographic key store protected by a master password.</p>
<p>A key store is only opened when necessary. It’ll remain open from then on until an application calls <a href="#b_keys_close">b_keys_close</a>.</p>
<p>The default key store can be found at <code>/etc/blib/keys</code>. Applications may deploy their own exclusive key store, if necessary (not recommended).</p>
<p>Usually requires root access rights.</p>
<p>Features:<br />
- thread safe: no write operation can happen to a closed key store (<a href="#b_keys_close">b_keys_close</a> and write operations are single threaded only)<br />
- retrieved keys are read-only unless managed via this interface</p>
<p>Copyright (C) 2022 David Hobach LGPLv3<br />
0.7</p>
<section id="dependencies-14" class="level3">
<h3>Dependencies</h3>
<p>cat<br />
cp<br />
find<br />
findmnt<br />
mkdir<br />
readlink<br />
rm</p>
</section>
<section id="imports-14" class="level3">
<h3>Imports</h3>
<p><a href="#dmcrypt">dmcrypt</a><br />
<a href="#multithreadingmtx">multithreading/mtx</a></p>
</section>
<section id="functions-13" class="level3">
<h3>Functions</h3>
<section id="b_keys_getDefaultStore" class="level4">
<h4>b_keys_getDefaultStore</h4>
<p><small><em>keys/b_keys_getDefaultStore</em></small><br />
Get the system-wide default key store directory.<br />
<span class="ret"><strong>returns</strong>: The default store directory. Always sets a zero exit code.</span></p>
</section>
<section id="b_keys_init" class="level4">
<h4>b_keys_init [app id] [auto create] [ui mode] [password prompt] [wait time] [store dir]</h4>
<p><small><em>keys/b_keys_init</em></small><br />
Initialize this module. This function <em>must</em> be called at least once before any other function except <a href="#b_keys_create">b_keys_create</a> can be used.<br />
Will open the key store, if it’s closed.<br />
<span class="par">[app id]: Unique application ID (recommended: <a href="#B_SCRIPT">$B_SCRIPT_NAME</a>).</span><br />
<span class="par">[auto create]: Automatically create a new key store, if none exists (default: 0 = do it). Users may create their own key store using <code>cryptsetup</code> otherwise.</span><br />
<span class="par">[ui mode]: How to request the master password from the user: auto|gui|tty (default: auto).</span><br />
<span class="par">[password prompt]: Prompt string to ask the user for his password (optional).</span><br />
<span class="par">[wait time]: Maximum time in ms to wait for another process writing to a key (default: 300) (-1 = indefinitely).</span><br />
<span class="par">[store dir]: Full path to a directory where to manage the keys (default: <a href="#b_keys_getDefaultStore">b_keys_getDefaultStore</a>). Only applications requiring an exclusive key store should use a non-default value here.</span><br />
<span class="ret"><strong>returns</strong>: Sets a zero exit code on success and errors out with <a href="#B_E">B_E</a> otherwise.</span><br />
<span class="ann"><em><span class="citation" data-cites="StateChanging">@StateChanging</span></em></span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_keys_add" class="level4">
<h4>b_keys_add [key id] [key path]</h4>
<p><small><em>keys/b_keys_add</em></small><br />
Add the given key to the key store.<br />
<span class="par">[key id]: Unique identifier for the key to add.</span><br />
<span class="par">[key path]: Full path to the key to add. It is <em>not</em> removed. Use functions such as <a href="#b_fs_removeRelativelySafely">b_fs_removeRelativelySafely</a> to do that.</span><br />
<span class="ret"><strong>returns</strong>: Sets a zero exit code on success and errors out with <a href="#B_E">B_E</a> otherwise.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_keys_get" class="level4">
<h4>b_keys_get [key id]</h4>
<p><small><em>keys/b_keys_get</em></small><br />
Retrieve the given key from the store. If you need the content as String, please use <a href="#b_keys_getContent">b_keys_getContent</a>.<br />
<span class="par">[key id]: Unique identifier for the key to retrieve.</span><br />
<span class="ret"><strong>returns</strong>: Path to the key. It may not exist, if the key store was closed in the meantime or the provided ID does not exist.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_keys_getAll" class="level4">
<h4>b_keys_getAll [global]</h4>
<p><small><em>keys/b_keys_getAll</em></small><br />
Retrieve all keys from the store.<br />
<span class="par">[global]: If set to 0, also retrieve keys for other application IDs (default: 1).</span><br />
<span class="ret"><strong>returns</strong>: All key paths for reading as a newline-separated list. If the key store is closed or modified during the runtime, the list may be empty or incomplete.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_keys_getContent" class="level4">
<h4>b_keys_getContent [key id]</h4>
<p><small><em>keys/b_keys_getContent</em></small><br />
Retrieve the given key content from the store. For binary keys please use <a href="#b_keys_get">b_keys_get</a>.<br />
<span class="par">[key id]: Unique identifier for the key to retrieve.</span><br />
<span class="ret"><strong>returns</strong>: The key content as String. If it doesn’t exist or other errors occurred, <a href="#B_E">B_E</a> is called.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_keys_delete" class="level4">
<h4>b_keys_delete [key id] [backup]</h4>
<p><small><em>keys/b_keys_delete</em></small><br />
Delete the given key from the key store.<br />
<span class="par">[key id]: Unique identifier for the key to delete.</span><br />
<span class="par">[backup]: Whether (0) or not (1) to create a backup (default: 0).</span><br />
<span class="ret"><strong>returns</strong>: Sets a zero exit code on success and errors out with <a href="#B_E">B_E</a> otherwise.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_keys_close" class="level4">
<h4>b_keys_close [store dir]</h4>
<p><small><em>keys/b_keys_close</em></small><br />
Close the key store, if necessary. Works without initialisation (which might open the key store), if necessary.<br />
<em>WARNING</em>: 99% of all applications should <em>never</em> call this function as it may block all subsequent read operations by any other applications using this system-wide key store. The only applications that might call this function are key store management applications and only upon explicit user request. The key store is otherwise automatically closed upon system shutdown by the running OS.<br />
<span class="par">[store dir]: The main directory of the store to close (default: the key store directory used in <a href="#b_keys_init">b_keys_init</a> or - if not initialised - <a href="#b_keys_getDefaultStore">b_keys_getDefaultStore</a>).</span><br />
<span class="ret"><strong>returns</strong>: Sets a zero exit code on success (closed key store) and errors out with <a href="#B_E">B_E</a> otherwise.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
</section>
</section>
<section id="meta" class="level2">
<h2>meta</h2>
<p>Functions providing information about blib modules or other bash scripts.</p>
<p>Copyright (C) 2020 David Hobach LGPLv3<br />
0.2</p>
<section id="dependencies-15" class="level3">
<h3>Dependencies</h3>
<p>no dependencies</p>
</section>
<section id="imports-15" class="level3">
<h3>Imports</h3>
<p><a href="#str">str</a></p>
</section>
<section id="functions-14" class="level3">
<h3>Functions</h3>
<section id="b_meta_getClearImports" class="level4">
<h4>b_meta_getClearImports [path]</h4>
<p><small><em>meta/b_meta_getClearImports</em></small><br />
Get the list of modules that the given script imports via <a href="#b_import">b_import</a>.<br />
<em>Important</em>: All <a href="#b_import">b_import</a> calls are assumed to be declared on a dedicated line and to start at the first character of that line (“clear” import). This is considered a feature to evade this method (for doc purposes mostly).<br />
<span class="par">[path]: Full path to the script to retrieve the module imports for.</span><br />
<span class="ret"><strong>returns</strong>: Newline-separated list of imports of the given script.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_meta_getClearDeps" class="level4">
<h4>b_meta_getClearDeps [path]</h4>
<p><small><em>meta/b_meta_getClearDeps</em></small><br />
Get the list of dependencies that the given script declares via <a href="#b_deps">b_deps</a>.<br />
<em>Important</em>: All <a href="#b_deps">b_deps</a> calls are assumed to be declared on a dedicated line and to start at the first character of that line (“clear” dependency). This is considered a feature to evade this method (for doc purposes mostly).<br />
<span class="par">[path]: Full path to the script to retrieve the dependencies for.</span><br />
<span class="ret"><strong>returns</strong>: Newline-separated list of dependencies of the given script.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
</section>
</section>
<section id="multithreadingipcm" class="level2">
<h2>multithreading/ipcm</h2>
<p>An inter-process map implementation.</p>
<p>The map is available to all running processes during a single boot session.</p>
<p>Both reading and writing to the map can be done from any number of processes.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Overall Features</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"># readers</td>
<td>multiple</td>
</tr>
<tr class="even">
<td style="text-align: left;"># writers</td>
<td>multiple</td>
</tr>
<tr class="odd">
<td style="text-align: left;">read consistency</td>
<td>always</td>
</tr>
<tr class="even">
<td style="text-align: left;">write consistency</td>
<td>always</td>
</tr>
<tr class="odd">
<td style="text-align: left;">blocking</td>
<td>on writes</td>
</tr>
</tbody>
</table>
<p>Copyright (C) 2019 David Hobach LGPLv3<br />
0.2</p>
<section id="dependencies-16" class="level3">
<h3>Dependencies</h3>
<p>no dependencies</p>
</section>
<section id="imports-16" class="level3">
<h3>Imports</h3>
<p><a href="#multithreadingipcv">multithreading/ipcv</a><br />
<a href="#multithreadingmtx">multithreading/mtx</a></p>
</section>
<section id="functions-15" class="level3">
<h3>Functions</h3>
<section id="b_ipcm_setNamespace" class="level4">
<h4>b_ipcm_setNamespace [namespace]</h4>
<p><small><em>multithreading/ipcm/b_ipcm_setNamespace</em></small><br />
Set the common process namespace to use. All processes inside the same namespace share a common state.<br />
It is recommended to call this function a single time before any other functions of this module. Otherwise the default namespace, which may include unrelated processes, is used.<br />
<span class="par">[namespace]: Name of the namespace to set.</span><br />
<span class="ret"><strong>returns</strong>: Errors out, if the name is unacceptable.</span><br />
<span class="ann"><em><span class="citation" data-cites="StateChanging">@StateChanging</span></em></span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_ipcm_getNamespace" class="level4">
<h4>b_ipcm_getNamespace</h4>
<p><small><em>multithreading/ipcm/b_ipcm_getNamespace</em></small><br />
Retrieve the currently used namespace.<br />
<span class="ret"><strong>returns</strong>: The currently used namespace.</span></p>
</section>
<section id="b_ipcm_change" class="level4">
<h4>b_ipcm_change [key] [change function] [maximum time]</h4>
<p><small><em>multithreading/ipcm/b_ipcm_change</em></small><br />
Change the given key/value combination inside the map in a thread-safe way.<br />
May wait for changes done by other processes.<br />
<span class="par">[key]: A global unique identifier for the given value.</span><br />
<span class="par">[change function]: Name of the function to execute the change of the value. It will be called with the current key as first parameter and the current value as second. It is expected to print the new value to set for this key. A non-zero exit code will cause <a href="#b_ipcm_change">b_ipcm_change</a> to abort the change.</span><br />
<span class="par">[maximum time]: maximum time in ms to wait for other processes to complete their operation (default: -1 = indefinitely)</span><br />
<span class="ret"><strong>returns</strong>: A zero exit code and prints the new value, if the change succeeded. An exit code of <a href="#B_RC">B_RC</a>+1 indicates that the change function returned a non-zero exit code. <a href="#B_E">B_E</a> is called otherwise.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_ipcm_get" class="level4">
<h4>b_ipcm_get [key] [fallback]</h4>
<p><small><em>multithreading/ipcm/b_ipcm_get</em></small><br />
Retrieve the data found at the given key.<br />
<span class="par">[key]: A global unique identifier for the data to retrieve.</span><br />
<span class="par">[fallback]: Data to return if nothing was found for the given key (default: empty).</span><br />
<span class="ret"><strong>returns</strong>: Sets a zero exit code and returns the data found on success. If no data was found, the fallback data is returned and a zero exit code is set. <a href="#B_E">B_E</a> is called on errors.</span></p>
</section>
<section id="b_ipcm_unsetNamespace" class="level4">
<h4>b_ipcm_unsetNamespace [namespace] [maximum time]</h4>
<p><small><em>multithreading/ipcm/b_ipcm_unsetNamespace</em></small><br />
Unsets the given namespace and all keys stored within it.<br />
It is recommended to call this function when all processes finished their work.<br />
<span class="par">[namespace]: The namespace to unset (default: the current namespace).</span><br />
<span class="par">[maximum time]: maximum time in ms to wait for other processes to complete their operation (default: 0 = indefinitely)</span><br />
<span class="ret"><strong>returns</strong>: Sets a zero exit code only upon successful removal. Otherwise <a href="#B_E">B_E</a> is triggered.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
</section>
</section>
<section id="multithreadingipcv" class="level2">
<h2>multithreading/ipcv</h2>
<p>Provides means for inter-process communication (ipc) via global bash variables (v).</p>
<p>This implementation uses shared memory, i.e. it should be reasonably fast.</p>
<p>Only a single process or thread is assumed to be writing (i.e. use <a href="#b_ipcv_save">b_ipcv_save</a>) a variable at a time and multiple processes may read it (using e.g. <a href="#b_ipcv_load">b_ipcv_load</a>). If you need to write a single variable from multiple processes, please consider using the <a href="#multithreadingmtx">multithreading/mtx</a> module or similar locking means in combination with this module (or just <a href="#multithreadingipcm">multithreading/ipcm</a>).</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Overall Features</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"># readers</td>
<td>multiple</td>
</tr>
<tr class="even">
<td style="text-align: left;"># writers</td>
<td>single</td>
</tr>
<tr class="odd">
<td style="text-align: left;">read consistency</td>
<td>always</td>
</tr>
<tr class="even">
<td style="text-align: left;">write consistency</td>
<td>only for one writer</td>
</tr>
<tr class="odd">
<td style="text-align: left;">blocking</td>
<td>never</td>
</tr>
</tbody>
</table>
<p>Copyright (C) 2018 David Hobach LGPLv3<br />
0.3</p>
<section id="dependencies-17" class="level3">
<h3>Dependencies</h3>
<p>findmnt<br />
mkdir<br />
mktemp<br />
mv<br />
rm</p>
</section>
<section id="imports-17" class="level3">
<h3>Imports</h3>
<p>no imports</p>
</section>
<section id="functions-16" class="level3">
<h3>Functions</h3>
<section id="b_ipcv_save" class="level4">
<h4>b_ipcv_save [namespace] [var name 1] .. [var name n]</h4>
<p><small><em>multithreading/ipcv/b_ipcv_save</em></small><br />
Save the current values of the given variables so that they are made available for other processes under the given namespace.</p>
<p>Please note that each variable is saved atomically, but individually. I.e. if you need multiple values to be updated at the same time, please use a single variable (e.g. a map).<br />
<span class="par">[namespace]: Name for a common group under which the given variables should be saved. The combination of [namespace] and [variable name] must be a unique identifier across all processes running on the system.</span><br />
<span class="par">[var name i]: The name of the global variable to make accessible for other processes. An arbitrary number of variable names can be specified.</span><br />
<span class="ret"><strong>returns</strong>: Nothing, but a non-zero exit code indicates failed variable save attempts. A failed save attempt also triggers <a href="#B_E">B_E</a>.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_ipcv_load" class="level4">
<h4>b_ipcv_load [namespace] [var name 1] .. [var name n]</h4>
<p><small><em>multithreading/ipcv/b_ipcv_load</em></small><br />
Load the given variables from the given namespace into the current process context.<br />
<span class="par">[namespace]: Name of the group under which the variable was saved with <a href="#b_ipcv_save">b_ipcv_save</a>. Must exist.</span><br />
<span class="par">[var name i]: Name of the variable to load. Multiple names can be specified.</span><br />
<span class="ret"><strong>returns</strong>: A non-zero exit code indicates the number of variables that could not be loaded unless some unexpected error occurred and <a href="#B_E">B_E</a> is triggered. Please note that a failed load attempt/unavailable variable does generally not trigger <a href="#B_E">B_E</a>.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_ipcv_loadNamespace" class="level4">
<h4>b_ipcv_loadNamespace [namespace] [check existence]</h4>
<p><small><em>multithreading/ipcv/b_ipcv_loadNamespace</em></small><br />
Load all variables that can be loaded for the given namespace into the current process context.<br />
<span class="par">[namespace]: Name of the group for which to load all available variables.</span><br />
<span class="par">[check existence]: Whether or not to make sure that the namespace to load exists (default: 0/check). Otherwise non-existing namespaces will not cause an error.</span><br />
<span class="ret"><strong>returns</strong>: Sets a zero exit code on success. Failing to load any single available variable will always trigger <a href="#B_E">B_E</a>.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_ipcv_unset" class="level4">
<h4>b_ipcv_unset [namespace] [var name 1] .. [var name n]</h4>
<p><small><em>multithreading/ipcv/b_ipcv_unset</em></small><br />
Unset/Remove the given variables from the global namespace.<br />
Please note that the variables will remain set in your current process context, if they were set before. Use the standard bash <code>unset</code> for that.<br />
<span class="par">[namespace]: Group where the given variables belong to.</span><br />
<span class="par">[var name i]: Name of the variable to remove. Multiple may be specified.</span><br />
<span class="ret"><strong>returns</strong>: The number of variables which could not be unset. <a href="#B_E">B_E</a> is not triggered for these.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_ipcv_unsetNamespace" class="level4">
<h4>b_ipcv_unsetNamespace [namespace]</h4>
<p><small><em>multithreading/ipcv/b_ipcv_unsetNamespace</em></small><br />
Remove the given global namespace and all variables it contains.<br />
Please note that the variables will remain set in your current process context, if they were set before. Use the standard bash <code>unset</code> for that.<br />
<span class="par">[namespace]: To remove.</span><br />
<span class="ret"><strong>returns</strong>: Sets a zero exit code only upon successful removal. Otherwise <a href="#B_E">B_E</a> is triggered.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
</section>
</section>
<section id="multithreadingmtx" class="level2">
<h2>multithreading/mtx</h2>
<p>Collection of mutex related functions.</p>
<p>Mutex: Only a single process may have it at any point in time.<br />
Semaphore: A specific maximum number of processes may have it at any point in time.</p>
<p>See the <a href="#keys">keys</a> module source code for an example on how to use this mutex implementation efficiently.</p>
<p>Copyright (C) 2018 David Hobach LGPLv3<br />
0.3</p>
<section id="dependencies-18" class="level3">
<h3>Dependencies</h3>
<p>cat<br />
mkdir<br />
mktemp<br />
rm<br />
rmdir<br />
sleep<br />
touch</p>
</section>
<section id="imports-18" class="level3">
<h3>Imports</h3>
<p><a href="#proc">proc</a></p>
</section>
<section id="functions-17" class="level3">
<h3>Functions</h3>
<section id="b_mtx_setSleepTime" class="level4">
<h4>b_mtx_setSleepTime [ms]</h4>
<p><small><em>multithreading/mtx/b_mtx_setSleepTime</em></small><br />
Sets the time to sleep for this module whenever active polling is done (default: 500).<br />
<span class="par">[ms]: time in miliseconds between active polling requests for e.g. mutexes done by this module; must be an integer</span><br />
<span class="ret"><strong>returns</strong>: Nothing, always sets a zero exit code.</span></p>
</section>
<section id="b_mtx_getSleepTime" class="level4">
<h4>b_mtx_getSleepTime</h4>
<p><small><em>multithreading/mtx/b_mtx_getSleepTime</em></small><br />
Gets the time to sleep for this module whenever active polling is done.<br />
<span class="ret"><strong>returns</strong>: The currently set time to sleep in ms.</span></p>
</section>
<section id="b_mtx_create" class="level4">
<h4>b_mtx_create [base dir]</h4>
<p><small><em>multithreading/mtx/b_mtx_create</em></small><br />
Allocate a new mutex without claiming it (use b_mtx_try for that).<br />
<span class="par">[base dir]: Path to an <em>existing</em> directory where to store the mutex (default: not specified). By default this module will pick a temporary location. If you need a mutex that persists across reboots, please set a directory that persists across reboots here. The path should point to a local, non-network file system destination. The module must be able to create remove files or directories there at will.</span><br />
<span class="ret"><strong>returns</strong>: A string identifying the mutex (mutex ID). Sets a non-zero exit code on errors.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_mtx_release" class="level4">
<h4>b_mtx_release [mutex] [block ID]</h4>
<p><small><em>multithreading/mtx/b_mtx_release</em></small><br />
Release the given mutex so that it can be used by other block IDs/threads.<br />
<span class="par">[mutex]: A mutex obtained via <a href="#b_mtx_create">b_mtx_create</a>.</span><br />
<span class="par">[block ID]: The block ID for which to release the mutex (default: $$).</span><br />
<span class="ret"><strong>returns</strong>: Sets a non-zero exit code if the mutex could not be removed as another process is blocking it and a zero exit code on successful removal.</span></p>
</section>
<section id="b_mtx_forceRelease" class="level4">
<h4>b_mtx_forceRelease [mutex]</h4>
<p><small><em>multithreading/mtx/b_mtx_forceRelease</em></small><br />
Release the given mutex so that it can be used by other blockIDs/threads. Warning: This function can remove mutexes from other threads and should generally <em>only</em> be used for the removal of mutexes which are known to be stale by the calling application.<br />
<span class="par">[mutex]: A mutex obtained via <a href="#b_mtx_create">b_mtx_create</a>.</span><br />
<span class="ret"><strong>returns</strong>: Nothing and sets a zero exit code.</span></p>
</section>
<section id="b_mtx_pass" class="level4">
<h4>b_mtx_pass [mutex] [block ID]</h4>
<p><small><em>multithreading/mtx/b_mtx_pass</em></small><br />
Pass a blocked mutex to another block ID (i.e. change the block ID of the given mutex).<br />
You should only do this if you currently own the mutex and the new process is ready to take over.<br />
<span class="par">[mutex]: A mutex obtained via <a href="#b_mtx_create">b_mtx_create</a>.</span><br />
<span class="par">[block ID]: The block ID to set for the given mutex.</span><br />
<span class="ret"><strong>returns</strong>: Sets a zero exit code on success and a non-zero exit code otherwise.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_mtx_try" class="level4">
<h4>b_mtx_try [mutex] [block ID] [claim stale] [claim own]</h4>
<p><small><em>multithreading/mtx/b_mtx_try</em></small><br />
Attempt to obtain the given mutex. Return immediately even if it cannot be obtained.<br />
<span class="par">[mutex]: A mutex obtained via <a href="#b_mtx_create">b_mtx_create</a>. You may also use a static and otherwise unused directory path as mutex and share it across all relevant processes.</span><br />
<span class="par">[block ID]: The ID to use by which to block (default: running (sub)shell process id $$). This should be the process ID of the process attempting to obtain the mutex or you should know what you’re doing. If you’re in a subshell that should deploy a mutex against other subshells, store their $BASHPID and call the function with that.</span><br />
<span class="par">[claim stale]: If set to 0, claim the mutex even if it is still blocked by some other process, but that process isn’t running anymore. If set to 1 (default), the function returns without obtaining the mutex. In general this should only be used in situations where a mutex has a high probability of being stale (e.g. application start).</span><br />
<span class="par">[claim own]: If set to 0 (default), claim the mutex if it appears to be blocked by the provided block ID. If set to 1, consider it blocked even then.</span><br />
<span class="ret"><strong>returns</strong>: The function incl. parameters to execute to remove the mutex if it was obtained and an error message stating the reason otherwise. The provided function <em>should</em> be called as part of an exit trap of the calling script or via eval. Sets an exit code of 0, if the mutex was obtained. An exit code of 1 is set, if the mutex was blocked and another non-zero exit code if some other error occurred (the mutex might be blocked even then). </span></p>
<p>Example code:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true"></a> <span class="bu">local</span> <span class="va">mutex=</span><span class="st">&quot;&quot;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true"></a> <span class="bu">local</span> <span class="va">mutexRet=</span><span class="st">&quot;&quot;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true"></a> <span class="va">mutex=</span><span class="st">&quot;</span><span class="va">$(</span><span class="ex">b_mtx_create</span><span class="va">)</span><span class="st">&quot;</span> <span class="kw">||</span> <span class="kw">{</span> <span class="va">B_ERR=</span><span class="st">&quot;Failed to create a mutex.&quot;</span> ; <span class="ex">B_E</span> <span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true"></a> <span class="va">mutexRet=</span><span class="st">&quot;</span><span class="va">$(</span><span class="ex">b_mtx_try</span> <span class="st">&quot;</span><span class="va">$mutex</span><span class="st">&quot;</span><span class="va">)</span><span class="st">&quot;</span> <span class="kw">\</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true"></a> <span class="kw">||</span> <span class="kw">{</span> <span class="va">B_ERR=</span><span class="st">&quot;Failed to obtain the mutex </span><span class="va">$mutex</span><span class="st">. Reason: </span><span class="va">$mutexRet</span><span class="st">&quot;</span> ; <span class="ex">B_E</span> <span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true"></a> <span class="co">#assuming the mutex is only meant to be removed after full</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true"></a> <span class="co">#execution of the script:</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true"></a> <span class="bu">trap</span> <span class="st">&quot;</span><span class="va">$mutexRet</span><span class="st">&quot;</span> EXIT</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true"></a> <span class="co">#direct removal:</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true"></a> <span class="co">#b_mtx_release &quot;$mutex&quot;</span></span></code></pre></div>
</section>
<section id="b_mtx_waitFor" class="level4">
<h4>b_mtx_waitFor [mutex] [block ID] [claim stale] [maximum time]</h4>
<p><small><em>multithreading/mtx/b_mtx_waitFor</em></small><br />
Wait for the given mutex to become available. This will block script execution.<br />
<span class="par">[mutex]: see <a href="#b_mtx_try">b_mtx_try</a></span><br />
<span class="par">[block ID]: see <a href="#b_mtx_try">b_mtx_try</a></span><br />
<span class="par">[claim stale]: see <a href="#b_mtx_try">b_mtx_try</a></span><br />
<span class="par">[maximum time]: maximum time in ms to wait for the mutex to become available (default: -1 = indefinitely)</span><br />
<span class="ret"><strong>returns</strong>: see <a href="#b_mtx_try">b_mtx_try</a></span></p>
</section>
</section>
</section>
<section id="multithreadingmultiw" class="level2">
<h2>multithreading/multiw</h2>
<p>Allow multiple processes to write to a <em>virtual</em> file at the same time without causing write inconsitencies (written data from each process mangled with each other).</p>
<p>This is achieved by keeping one file per process and relies on the assumption that both replacing and reading a symlink on your Linux distribution is atomic.</p>
<p>In order for this to work, all write operations must go through this module.</p>
<p>Currently reading only returns the data written by the process which wrote last. If you need some sort of appending, it makes more sense to deploy a mutex using e.g. the <a href="#multithreadingmtx">multithreading/mtx</a> module.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Overall Features</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"># readers</td>
<td>multiple</td>
</tr>
<tr class="even">
<td style="text-align: left;"># writers</td>
<td>multiple</td>
</tr>
<tr class="odd">
<td style="text-align: left;">read consistency</td>
<td>partial, last writer wins</td>
</tr>
<tr class="even">
<td style="text-align: left;">write consistency</td>
<td>always</td>
</tr>
<tr class="odd">
<td style="text-align: left;">blocking</td>
<td>never</td>
</tr>
</tbody>
</table>
<p>Copyright (C) 2019 David Hobach LGPLv3<br />
0.2</p>
<section id="dependencies-19" class="level3">
<h3>Dependencies</h3>
<p>ln<br />
mv<br />
rm<br />
shuf<br />
stat</p>
</section>
<section id="imports-19" class="level3">
<h3>Imports</h3>
<p>no imports</p>
</section>
<section id="functions-18" class="level3">
<h3>Functions</h3>
<section id="b_multiw_setMaxHangTime" class="level4">
<h4>b_multiw_setMaxHangTime [seconds]</h4>
<p><small><em>multithreading/multiw/b_multiw_setMaxHangTime</em></small><br />
Set the maximum time that a process is expected to hang between two instructions. This is relevant for various internal guarantees.<br />
<span class="par">[seconds]: Time in seconds that a process hangs at most.</span><br />
<span class="ret"><strong>returns</strong>: Nothing.</span><br />
<span class="ann"><em><span class="citation" data-cites="StateChanging">@StateChanging</span></em></span></p>
</section>
<section id="b_multiw_getMaxHangTime" class="level4">
<h4>b_multiw_getMaxHangTime</h4>
<p><small><em>multithreading/multiw/b_multiw_getMaxHangTime</em></small><br />
Get the maximum time that a process is expected to hang between two instructions. This is relevant for various internal guarantees.<br />
<span class="ret"><strong>returns</strong>: Time in seconds.</span></p>
</section>
<section id="b_multiw_write" class="level4">
<h4>b_multiw_write [file path]</h4>
<p><small><em>multithreading/multiw/b_multiw_write</em></small><br />
Write all data lying in stdin to the given <em>virtual</em> file in a thread-safe way.<br />
<span class="par">[file path]: Full path to the virtual file to write to. Must not be a regular file (but may not exist).</span><br />
<span class="ret"><strong>returns</strong>: A zero exit code, if the write operation was successful and a non-zero exit code otherwise.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_multiw_remove" class="level4">
<h4>b_multiw_remove [file path]</h4>
<p><small><em>multithreading/multiw/b_multiw_remove</em></small><br />
Remove the given virtual file <em>and all of its revisions</em>.<br />
This function should only be called when all processes finished reading and writing. It is recommended to use it over the standard Linux <code>rm</code> as the latter will leave remnants behind.<br />
<span class="ret"><strong>returns</strong>: A zero exit code on success.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
</section>
</section>
<section id="net" class="level2">
<h2>net</h2>
<p>Collection of network related functions.</p>
<p>Copyright (C) 2020 David Hobach LGPLv3<br />
0.1</p>
<section id="dependencies-20" class="level3">
<h3>Dependencies</h3>
<p>dig</p>
</section>
<section id="imports-20" class="level3">
<h3>Imports</h3>
<p>no imports</p>
</section>
<section id="global-variables-6" class="level3">
<h3>Global Variables</h3>
<section id="B_NET_CHECKHOSTS" class="level4">
<h4>B_NET_CHECKHOSTS</h4>
<p><small><em>net/B_NET_CHECKHOSTS</em></small><br />
Each call to <a href="#b_net_getDNSStatus">b_net_getDNSStatus</a> causes one of the host records in this array to be requested.<br />
It is recommended to pick a relatively large number of URLs with SSL support to remain relatively anonymous, if <a href="#b_net_getDNSStatus">b_net_getDNSStatus</a> is called multiple times.<br />
Defaults to the European/US Alexa Top 10 (which hopefully blends in to the masses).</p>
</section>
<section id="B_NET_DNSSERVERS" class="level4">
<h4>B_NET_DNSSERVERS</h4>
<p><small><em>net/B_NET_DNSSERVERS</em></small><br />
Each call to <a href="#b_net_getDNSStatus">b_net_getDNSStatus</a> with a <code>random</code> [server] causes one of the IPs in this array to be used as DNS server.<br />
Defaults to common large-scale free DNS providers (that probably save your requests).<br />
Sources:<br />
- https://www.techradar.com/news/best-dns-server<br />
- https://dnsmap.io/articles/most-popular-dns-servers</p>
</section>
</section>
<section id="functions-19" class="level3">
<h3>Functions</h3>
<section id="b_net_getDNSStatus" class="level4">
<h4>b_net_getDNSStatus [timeout] [server]</h4>
<p><small><em>net/b_net_getDNSStatus</em></small><br />
Find out whether DNS appears to work or not by testing it.<br />
One of <a href="#B_NET_CHECKHOSTS">B_NET_CHECKHOSTS</a> is possibly requested during the process.<br />
Use <a href="#b_http_getOnlineStatus">b_http_getOnlineStatus</a> for http checks.<br />
<span class="par">[timeout]: Timeout in seconds for hanging checks (default: 5).</span><br />
<span class="par">[server]: DNS server to use (default: the OS default). Passing <code>random</code> will pick a random DNS server.</span><br />
<span class="ret"><strong>returns</strong>: 0 if DNS works as expected, 1 if DNS works but returns NXDOMAIN and 2 on timeout; <a href="#B_E">B_E</a> will be called if the status cannot be determined.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
</section>
</section>
<section id="notify" class="level2">
<h2>notify</h2>
<p>Collection of notification related functions.</p>
<p>Copyright (C) 2021 David Hobach LGPLv3<br />
0.6</p>
<section id="dependencies-21" class="level3">
<h3>Dependencies</h3>
<p>getent<br />
id<br />
notify-send<br />
su</p>
</section>
<section id="imports-21" class="level3">
<h3>Imports</h3>
<p><a href="#fs">fs</a></p>
</section>
<section id="functions-20" class="level3">
<h3>Functions</h3>
<section id="b_notify_waitForUserDbus" class="level4">
<h4>b_notify_waitForUserDbus [user] [maximum time]</h4>
<p><small><em>notify/b_notify_waitForUserDbus</em></small><br />
Wait for <em>some</em> dbus user session to come up at <code>/run/user/[uid]/bus</code>. As dbus is required for notifications to work, waiting may be required for early notifications.<br />
<span class="par">[maximum time]: Maximum time in s to wait for the file to appear (default: forever).</span><br />
<span class="par">[user]: Name of the user whose instance to wait for (default: first user with a readable home directory).</span><br />
<span class="ret"><strong>returns</strong>: Sets a zero exit code and returns the identified dbus instance, if a dbus instance came up and a non-zero exit code on timeout. <a href="#B_E">B_E</a> is used for exceptional errors.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_notify_send" class="level4">
<h4>b_notify_send [arg 1] … [arg n]</h4>
<p><small><em>notify/b_notify_send</em></small><br />
Send out a notification to the user via <code>notify-send</code>.<br />
If run as root, may send the notification to <em>all</em> active non-root users.<br />
Calling <code>notify-send</code> directly can be problematic depending on the user, dbus session, environment variables, … This function aims to circumvent these potential issues.<br />
<span class="par">[arg i]: All arguments are directly passed to <code>notify-send</code>.</span><br />
<span class="ret"><strong>returns</strong>: Nothing. Errors during notification sending will trigger <a href="#B_E">B_E</a>.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_notify_sendNoError" class="level4">
<h4>b_notify_sendNoError [arg 1] … [arg n]</h4>
<p><small><em>notify/b_notify_sendNoError</em></small><br />
Convenience variant of <a href="#b_notify_send">b_notify_send</a> that does not exit and only prints errors with <a href="#b_defaultErrorHandler">b_defaultErrorHandler</a>. This function should e.g. be used in custom error handlers to avoid recursion.<br />
<span class="ret"><strong>returns</strong>: Sets a non-zero exit code on errors.</span></p>
</section>
</section>
</section>
<section id="ososid" class="level2">
<h2>os/osid</h2>
<p>Functions for operating system identification.</p>
<p>Copyright (C) 2018 David Hobach LGPLv3<br />
0.2</p>
<section id="dependencies-22" class="level3">
<h3>Dependencies</h3>
<p>no dependencies</p>
</section>
<section id="imports-22" class="level3">
<h3>Imports</h3>
<p>no imports</p>
</section>
<section id="functions-21" class="level3">
<h3>Functions</h3>
<section id="b_osid_init" class="level4">
<h4>b_osid_init [force]</h4>
<p><small><em>os/osid/b_osid_init</em></small><br />
<span class="par">[force]: if set to 0, force an init even if it would otherwise not be necessary (default: 1 - only initialize if it didn’t happen before)</span><br />
Initialize the osid module. It should normally <em>not</em> be necessary to call this function directly, but it will be called by the osid module internally as needed.<br />
<span class="ret"><strong>returns</strong>: May error out and set a non-zero exit code on failures.</span></p>
</section>
<section id="b_osid_isDebian" class="level4">
<h4>b_osid_isDebian</h4>
<p><small><em>os/osid/b_osid_isDebian</em></small><br />
Check whether the OS running this function is a Debian Linux.<br />
<span class="ret"><strong>returns</strong>: Sets a zero exit code if the check returns true. Does not print any output.</span></p>
</section>
<section id="b_osid_isDebianLike" class="level4">
<h4>b_osid_isDebianLike</h4>
<p><small><em>os/osid/b_osid_isDebianLike</em></small><br />
Check whether the OS running this function is a Debian Linux or one of its derivatives (e.g. ubuntu).<br />
<span class="ret"><strong>returns</strong>: Sets a zero exit code if the check returns true. Does not print any output.</span></p>
</section>
<section id="b_osid_isOpenSuse" class="level4">
<h4>b_osid_isOpenSuse</h4>
<p><small><em>os/osid/b_osid_isOpenSuse</em></small><br />
Check whether the OS running this function is a OpenSUSE.<br />
<span class="ret"><strong>returns</strong>: Sets a zero exit code if the check returns true. Does not print any output.</span></p>
</section>
<section id="b_osid_isFedora" class="level4">
<h4>b_osid_isFedora</h4>
<p><small><em>os/osid/b_osid_isFedora</em></small><br />
Check whether the OS running this function is a Fedora Linux.<br />
<span class="ret"><strong>returns</strong>: Sets a zero exit code if the check returns true. Does not print any output.</span></p>
</section>
<section id="b_osid_isCentOS" class="level4">
<h4>b_osid_isCentOS</h4>
<p><small><em>os/osid/b_osid_isCentOS</em></small><br />
Check whether the OS running this function is a CentOS.<br />
<span class="ret"><strong>returns</strong>: Sets a zero exit code if the check returns true. Does not print any output.</span></p>
</section>
<section id="b_osid_isRedHat" class="level4">
<h4>b_osid_isRedHat</h4>
<p><small><em>os/osid/b_osid_isRedHat</em></small><br />
Check whether the OS running this function is a RedHat Linux.<br />
<span class="ret"><strong>returns</strong>: Sets a zero exit code if the check returns true. Does not print any output.</span></p>
</section>
<section id="b_osid_isUbuntu" class="level4">
<h4>b_osid_isUbuntu</h4>
<p><small><em>os/osid/b_osid_isUbuntu</em></small><br />
Check whether the OS running this function is an Ubuntu Linux.<br />
<span class="ret"><strong>returns</strong>: Sets a zero exit code if the check returns true. Does not print any output.</span></p>
</section>
<section id="b_osid_isFedoraLike" class="level4">
<h4>b_osid_isFedoraLike</h4>
<p><small><em>os/osid/b_osid_isFedoraLike</em></small><br />
Check whether the OS running this function is a Fedora Linux or one of its derivatives (e.g. CentOS, Red Hat, Qubes OS).<br />
<span class="ret"><strong>returns</strong>: Sets a zero exit code if the check returns true. Does not print any output.</span></p>
</section>
<section id="b_osid_isQubesDom0" class="level4">
<h4>b_osid_isQubesDom0</h4>
<p><small><em>os/osid/b_osid_isQubesDom0</em></small><br />
Check whether the OS running this function is a Qubes OS in dom0.<br />
<span class="ret"><strong>returns</strong>: Sets a zero exit code if the check returns true. Does not print any output.</span></p>
</section>
<section id="b_osid_isQubesVM" class="level4">
<h4>b_osid_isQubesVM</h4>
<p><small><em>os/osid/b_osid_isQubesVM</em></small><br />
Check whether the OS running this function is a Qubes OS in a VM.<br />
<span class="ret"><strong>returns</strong>: Sets a zero exit code if the check returns true. Does not print any output.</span></p>
</section>
</section>
</section>
<section id="osqubes4dom0" class="level2">
<h2>os/qubes4/dom0</h2>
<p>Collection of functions supporting scripting in Qubes OS 4.x dom0.</p>
<p><strong>Important</strong>: Whenever you parse output from VMs to dom0, you <strong>must</strong> be extra careful and assume it totally untrusted as parsing bugs are a plausible attack vector for compromised VMs. Passing data to potentially compromised VMs of course also exposes that data’s confidentiality.</p>
<p>Copyright (C) 2022 David Hobach LGPLv3<br />
0.7</p>
<section id="dependencies-23" class="level3">
<h3>Dependencies</h3>
<p>basename<br />
cat<br />
dd<br />
dirname<br />
kill<br />
losetup<br />
mktemp<br />
ps<br />
python3<br />
qubesdb-rm<br />
qubesdb-write<br />
qubes-prefs<br />
qvm-block<br />
qvm-check<br />
qvm-firewall<br />
qvm-ls<br />
qvm-pool<br />
qvm-run<br />
qvm-shutdown<br />
qvm-volume<br />
readlink<br />
setsid<br />
sleep<br />
sort<br />
tar<br />
tee<br />
timeout<br />
xxd</p>
</section>
<section id="imports-23" class="level3">
<h3>Imports</h3>
<p><a href="#fs">fs</a><br />
<a href="#proc">proc</a><br />
<a href="#types">types</a><br />
<a href="#ui">ui</a></p>
</section>
<section id="global-variables-7" class="level3">
<h3>Global Variables</h3>
<section id="B_DOM0_VM_STDERR" class="level4">
<h4>B_DOM0_VM_STDERR</h4>
<p><small><em>os/qubes4/dom0/B_DOM0_VM_STDERR</em></small><br />
Where to append the VM stderr output for <a href="#b_dom0_qvmRun">b_dom0_qvmRun</a> and its related functions.<br />
Defaults to <code>/dev/null</code> for security reasons (VM output is always untrusted).</p>
</section>
<section id="B_DOM0_QVM_RUN_PARAMS" class="level4">
<h4>B_DOM0_QVM_RUN_PARAMS</h4>
<p><small><em>os/qubes4/dom0/B_DOM0_QVM_RUN_PARAMS</em></small><br />
Alternative method to pass parameters to <a href="#b_dom0_qvmRun">b_dom0_qvmRun</a> and its related functions.<br />
Useful for e.g. <code>--no-gui</code> to speed up performance when you never use a VM’s GUI.<br />
Default: Empty array.</p>
</section>
</section>
<section id="functions-22" class="level3">
<h3>Functions</h3>
<section id="b_dom0_setVMDeps" class="level4">
<h4>b_dom0_setVMDeps [list] [keep defaults]</h4>
<p><small><em>os/qubes4/dom0/b_dom0_setVMDeps</em></small><br />
Set the dependencies for all VMs used with this module to the given list of binaries.<br />
These dependencies are checked before <em>any</em> execution of commands in <em>any</em> VM; in particular whenever <a href="#b_dom0_qvmRun">b_dom0_qvmRun</a>, <a href="#b_dom0_execIn">b_dom0_execIn</a>, <a href="#b_dom0_execStrIn">b_dom0_execStrIn</a> or <a href="#b_dom0_execFuncIn">b_dom0_execFuncIn</a> are called.<br />
<span class="par">[list]: Newline-separated list of binaries or commands that VMs must be able to execute.</span><br />
<span class="par">[keep defaults]: If set to 0 (default), merge the default list of dependencies with the supplied one. Otherwise only keep the supplied list of dependencies.</span><br />
<span class="ret"><strong>returns</strong>: Nothing.</span><br />
<span class="ann"><em><span class="citation" data-cites="StateChanging">@StateChanging</span></em></span></p>
</section>
<section id="b_dom0_getVMDeps" class="level4">
<h4>b_dom0_getVMDeps</h4>
<p><small><em>os/qubes4/dom0/b_dom0_getVMDeps</em></small><br />
Getter for <a href="#b_dom0_setVMDeps">b_dom0_setVMDeps</a>.<br />
<span class="ret"><strong>returns</strong>: The current list of dependencies for VMs.</span></p>
</section>
<section id="b_dom0_qvmRun" class="level4">
<h4>b_dom0_qvmRun [parameter 1] … [parameter n] [vm] [command]</h4>
<p><small><em>os/qubes4/dom0/b_dom0_qvmRun</em></small><br />
A wrapper for qvm-run which sets reasonable defaults for shell scripting and applies various fixes.</p>
<p>Most calls to qvm-run should be made via this function rather than interacting with qvm-run directly as the Qubes OS qvm-run was designed with interactive shell usage in mind whereas this wrapper is intended for bash developers.</p>
<p>Particular features:</p>
<ul>
<li>a certain set of reasonable default parameters is used: -p -q -n -u root</li>
<li>-n was set as auto-starting VMs during Bash scripting can heavily influence the user experience (imagine the VM being shut down manually by the user whilst a bash script is running –&gt; constant restarts)</li>
<li>stdin is redirected to /dev/null by default to avoid potential security implications (accidental reads from dom0 stdin passed to a VM); this can be overridden using –stdin</li>
<li>stdout has the VM output and the exit code is the one of the VM</li>
<li>stderr VM output is appended to <a href="#B_DOM0_VM_STDERR">B_DOM0_VM_STDERR</a> (defult: <code>/dev/null</code> for security reasons)</li>
<li>distinguished exit conditions (executed command failed vs. qvm-run failed)</li>
<li>workarounds for known Qubes bugs wrt qvm-run may be implemented here (e.g. qubes issues #3083, #4476, #4633 in the past)</li>
<li>VM dependencies set with <a href="#b_dom0_setVMDeps">b_dom0_setVMDeps</a> are checked</li>
</ul>
<p>Please note that calling this function will make your script wait for the execution of the commands in the client VM.</p>
<p>Wherever possible, this function should be combined with <a href="#b_silence">b_silence</a> as the VM output shouldn’t be trusted. Otherwise please keep in mind that <strong>both</strong> stdout <em>and</em> stderr may have untrusted output which may even contain binary data. In order to validate against binary data you can e.g. use <a href="#b_types_parseString">b_types_parseString</a> or <a href="#b_types_str">b_types_str</a>.</p>
<p><span class="par">[parameters]: Any parameters supported by qvm-run. If you pass -a, the default -n will be overridden. If you pass -u, the default root user is overridden. If you pass -v, -q will be overridden. If you pass –stdin, even stdin is passed to qvm-run. -p can be overridden by using /dev/null redirection. Only the short parameter versions and only one switch per argument are supported. Parameters may also be globally specified via <a href="#B_DOM0_QVM_RUN_PARAMS">B_DOM0_QVM_RUN_PARAMS</a>, but the global parameters are ignored, if any local parameters are specified.</span><br />
<span class="par">[vm]: The VM where to run the given [command].</span><br />
<span class="par">[command]: The command to run.</span><br />
<span class="ret"><strong>returns</strong>: Sets the exit code of qvm-run and prints its output. May error out using <a href="#B_E">B_E</a> if qvm-run itself fails.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_dom0_getDispVMs" class="level4">
<h4>b_dom0_getDispVMs</h4>
<p><small><em>os/qubes4/dom0/b_dom0_getDispVMs</em></small><br />
Get a list of all currently existing disposable VMs.<br />
<span class="ret"><strong>returns</strong>: The currently existing disposable VMs as newline-separated list.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_dom0_startDispVM" class="level4">
<h4>b_dom0_startDispVM [template]</h4>
<p><small><em>os/qubes4/dom0/b_dom0_startDispVM</em></small><br />
Start a dispVM from the given template in the background and return its name.<br />
The disposable VM will remain started until it is shut down. If you only wish to execute a single command, please use <a href="#b_dom0_qvmRun">b_dom0_qvmRun</a> with the –dispVM parameter.<br />
It may take a while for this function to obtain the name of the dispVM.<br />
<span class="par">[template]: The template to use for the dispVM. If no template is specified, use the default Qubes template.</span><br />
<span class="ret"><strong>returns</strong>: Name of the dispVM that was started and sets a zero exit code on success. This function may error out.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_dom0_execIn" class="level4">
<h4>b_dom0_execIn [vm] [file] [user]</h4>
<p><small><em>os/qubes4/dom0/b_dom0_execIn</em></small><br />
Execute the file as bash code in the given VM and wait for it to finish.</p>
<p>See <a href="#b_dom0_qvmRun">b_dom0_qvmRun</a> for various notes and words of caution.<br />
<span class="par">[vm]: Name of the VM where to execute the given string. The VM is assumed to be started.</span><br />
<span class="par">[file]: Bash file to execute in the given VM.</span><br />
<span class="par">[user]: user as which to execute the bash file (default: root)</span><br />
<span class="ret"><strong>returns</strong>: Whatever the executed Bash code prints in the VM to stderr or stdout; the status code is set to the one of the executed Bash code on success (0). Non-zero exit codes and error messages may come from both this function as well as the code executed in the given VM.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_dom0_execStrIn" class="level4">
<h4>b_dom0_execStrIn [vm] [string] [user]</h4>
<p><small><em>os/qubes4/dom0/b_dom0_execStrIn</em></small><br />
Execute the String as bash code in the given VM and wait for it to finish.</p>
<p>Convenience wrapper for <a href="#b_dom0_execIn">b_dom0_execIn</a>.</p>
<p>See <a href="#b_dom0_qvmRun">b_dom0_qvmRun</a> for various notes and words of caution.<br />
<span class="par">[vm]: see <a href="#b_dom0_execIn">b_dom0_execIn</a></span><br />
<span class="par">[string]: Bash String to execute in the given VM.</span><br />
<span class="par">[user]: see <a href="#b_dom0_execIn">b_dom0_execIn</a></span><br />
<span class="ret"><strong>returns</strong>: see <a href="#b_dom0_execIn">b_dom0_execIn</a>; <a href="#B_E">B_E</a> is <em>not</em> called if the executed command returns an error</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_dom0_execFuncIn" class="level4">
<h4>b_dom0_execFuncIn [vm] [user] [function] [module dep 1] .. [module dep n] - [function dep 1] .. [function dep d] - [function param 1] .. [function param p]</h4>
<p><small><em>os/qubes4/dom0/b_dom0_execFuncIn</em></small><br />
Execute the Bash function in the given VM and wait for it to finish.</p>
<p>Convenience wrapper for <a href="#b_dom0_execIn">b_dom0_execIn</a>.</p>
<p>See <a href="#b_dom0_qvmRun">b_dom0_qvmRun</a> for various notes and words of caution.<br />
<span class="par">[vm]: see <a href="#b_dom0_execIn">b_dom0_execIn</a></span><br />
<span class="par">[user]: see <a href="#b_dom0_execIn">b_dom0_execIn</a></span><br />
<span class="par">[function]: Name of the function as it is declared in the current scope.</span><br />
<span class="par">[module dep i]: Names of the modules required by the function. They do not need to be imported by the function itself.</span><br />
<span class="par">[-]: A dash as separator character between the various parameters.</span><br />
<span class="par">[function dep j]: An arbitrary number of functions that need to be added in order to satisfy the dependencies of the function to call (e.g. if function A is meant to be called, but uses function B internally, you’ll have to pass B as one of its dependencies). Dependencies that can be found in added modules must <em>not</em> be added.</span><br />
<span class="par">[function param p]: An arbitrary number of function parameters.</span><br />
<span class="ret"><strong>returns</strong>: see <a href="#b_dom0_execIn">b_dom0_execIn</a>; <a href="#B_E">B_E</a> is <em>not</em> called if the executed command returns an error</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_dom0_waitForFileIn" class="level4">
<h4>b_dom0_waitForFileIn [vm] [file] [maximum time]</h4>
<p><small><em>os/qubes4/dom0/b_dom0_waitForFileIn</em></small><br />
Convenience wrapper for <a href="#b_fs_waitForFile">b_fs_waitForFile</a>.<br />
<span class="par">[vm]: VM where to execute.</span><br />
<span class="par">[file]: See [b_fs_waitForFile].</span><br />
<span class="par">[maximum time]: See [b_fs_waitForFile].</span><br />
<span class="ret"><strong>returns</strong>: See [b_fs_waitForFile].</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_dom0_isMountedIn" class="level4">
<h4>b_dom0_isMountedIn [vm] [device]</h4>
<p><small><em>os/qubes4/dom0/b_dom0_isMountedIn</em></small><br />
Check whether the device is mounted in the given VM.<br />
<span class="par">[vm]: VM where to execute.</span><br />
<span class="par">[device]: Full path to the device (incl. /dev/) to check.</span><br />
<span class="ret"><strong>returns</strong>: Sets a zero exit code if the device is mounted in the VM; a non-zero exit code means that it’s either not mounted or some other error occurred.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_dom0_mountIfNecessary" class="level4">
<h4>b_dom0_mountIfNecessary [vm] [device] [mount point] [enforce] [mount options]</h4>
<p><small><em>os/qubes4/dom0/b_dom0_mountIfNecessary</em></small><br />
Mount the given device in the target VM if it isn’t already mounted there. Actually a wrapper for <a href="#b_fs_mountIfNecessary">b_fs_mountIfNecessary</a>.<br />
<span class="par">[vm]: VM where to execute.</span><br />
<span class="par">[device]: Full path to the device (incl. /dev/) to mount.</span><br />
<span class="par">[mount point]: Full path where to mount the device. If no mount point is specified, a /tmp/ mount point is chosen. Non-existing directories are created. Is ignored if another mount point already exists.</span><br />
<span class="par">[enforce]: If set to 0, enforce the given mount point to be used in addition to potentially existing ones (default: 1).</span><br />
<span class="par">[mount options]: Options to pass to <code>mount</code>, if it needs to be executed (default: none).</span><br />
<span class="ret"><strong>returns</strong>: The chosen mount point or a newline-separated list of existing mount points on success; sets a non-zero exit code on failure. As these strings are returned from the VM, extra care must be taken when parsing them.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_dom0_createLoopDeviceIfNecessary" class="level4">
<h4>b_dom0_createLoopDeviceIfNecessary [vm] [file]</h4>
<p><small><em>os/qubes4/dom0/b_dom0_createLoopDeviceIfNecessary</em></small><br />
Create a loop device for the file in the given VM if no old one exists. Actually a wrapper for <a href="#b_fs_createLoopDeviceIfNecessary">b_fs_createLoopDeviceIfNecessary</a>.<br />
This usually requires root privileges.<br />
<span class="par">[vm]: VM where to execute.</span><br />
<span class="par">[file]: File for which to create a loop device.</span><br />
<span class="ret"><strong>returns</strong>: Created loop device or previously used one (incl. /dev/). Sets a non-zero exit code, if no device could be created.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_dom0_removeUnusedLoopDevice" class="level4">
<h4>b_dom0_removeUnusedLoopDevice [vm] [device|file] [type] [map]</h4>
<p><small><em>os/qubes4/dom0/b_dom0_removeUnusedLoopDevice</em></small><br />
Remove a loop device from the given VM, if it is <em>neither</em> used by Qubes OS <em>nor</em> by the given VM.<br />
<em>Important</em>: Calling this function may cause the device to be removed as soon as it becomes unused by the VM (and the VM <em>only</em>!). So if you called this function, you should <em>not</em> use the device any further from dom0 with e.g. <code>qvm-block</code> afterwards - even if it wasn’t removed.<br />
<span class="par">[vm]: VM where to remove the loop device.</span><br />
<span class="par">[device|file]: Full path (incl. /dev/) to the loop device or to the backing file inside the VM.</span><br />
<span class="par">[type]: Whether the given path represents a loop device (0) or the backing file (1). If not specified, a device will be assumed, if and only if the path starts with <code>/dev/</code>.</span><br />
<span class="par">[map]: Optional output from a previous call to <a href="#b_dom0_parseQvmBlock">b_dom0_parseQvmBlock</a>. If none is specified, this function will internally call <a href="#b_dom0_parseQvmBlock">b_dom0_parseQvmBlock</a>.</span><br />
<span class="ret"><strong>returns</strong>: Sets a zero exit code, if the loop device was not used and could thus be successfully removed <em>or</em> does not exist. A nonzero exit code indicates that the device is still being used. <a href="#B_E">B_E</a> is called on other errors.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_dom0_copy" class="level4">
<h4>b_dom0_copy [dom0 file] [target VM] [target VM dir] [overwrite] [parent dir]</h4>
<p><small><em>os/qubes4/dom0/b_dom0_copy</em></small><br />
Grab a file or directory in dom0 and push it to the given file path in the target VM.<br />
<span class="par">[dom0 file]: location of the dom0 file or directory to read from, assumed to exist</span><br />
<span class="par">[target VM]: VM to write to, assumed to exist. Must be started.</span><br />
<span class="par">[target VM dir]: full path to the parent directory in the target VM to copy the file or directory to; non-existing parent directories are created; the name is taken from the name of the file/directory in dom0</span><br />
<span class="par">[overwrite]: Whether or not to overwrite an existing [destination file] (default: 0 = overwrite).</span><br />
<span class="par">[parent dir]: Set this to 0, if the [target VM dir] is the target <em>parent</em> directory (default) and to 1 if it includes the target file or folder <em>name</em> as last element.</span><br />
<span class="ret"><strong>returns</strong>: Sets an exit code of 0, if everything went fine, and a non-zero exit code otherwise.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_dom0_crossCopy" class="level4">
<h4>b_dom0_crossCopy [source VM] [source file] [target VM] [target VM dir] [overwrite] [parent dir]</h4>
<p><small><em>os/qubes4/dom0/b_dom0_crossCopy</em></small><br />
Cross copy a file or directory from one VM to another, initiated by dom0. No user prompt is displayed.<br />
<span class="par">[source VM]: Where to copy the source file from. Must be started.</span><br />
<span class="par">[source file]: The file or directory to copy.</span><br />
<span class="par">[target VM]: Where to copy the file to. Must be started.</span><br />
<span class="par">[target VM dir]: full path to the parent directory in the target VM to copy the file or directory to; non-existing parent directories are created; the name is taken from the name of the file/directory in dom0</span><br />
<span class="par">[overwrite]: Whether or not to overwrite an existing [destination file] (default: 0 = overwrite).</span><br />
<span class="par">[parent dir]: Set this to 0, if the [target VM dir] is the target <em>parent</em> directory (default) and to 1 if it includes the target file or folder <em>name</em> as last element.</span><br />
<span class="ret"><strong>returns</strong>: Sets an exit code of 0, if everything went fine, and a non-zero exit code otherwise.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_dom0_ensureRunning" class="level4">
<h4>b_dom0_ensureRunning [vm 1] … [vm n]</h4>
<p><small><em>os/qubes4/dom0/b_dom0_ensureRunning</em></small><br />
Start or unpause the given VMs if needed.<br />
<span class="par">[vm i]: The VM to start.</span><br />
<span class="ret"><strong>returns</strong>: Nothing. <a href="#B_E">B_E</a> will be called for VMs that could not be started (maybe they don’t exist?).</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_dom0_isRunning" class="level4">
<h4>b_dom0_isRunning [vm 1] … [vm n]</h4>
<p><small><em>os/qubes4/dom0/b_dom0_isRunning</em></small><br />
Check whether the given VMs are running <em>and</em> fully operational / not hanging / not paused / not booting.<br />
In contrast <code>qvm-check --running [vm]</code> returns true for VMs which are currently booting and <code>qvm-ls</code> doesn’t check whether the OS of a VM is hanging.<br />
<span class="par">[vm i]: The VM to check.</span><br />
<span class="ret"><strong>returns</strong>: Nothing. <a href="#B_E">B_E</a> will be called for VMs that are not running (or don’t exist?).</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_dom0_isHalted" class="level4">
<h4>b_dom0_isHalted [vm 1] … [vm n]</h4>
<p><small><em>os/qubes4/dom0/b_dom0_isHalted</em></small><br />
Check whether the given VMs are halted.<br />
This is not necessarily the inverse of <a href="#b_dom0_isRunning">b_dom0_isRunning</a> as VMs may e.g. be paused.<br />
<span class="par">[vm i]: The VM to check.</span><br />
<span class="ret"><strong>returns</strong>: Nothing. <a href="#B_E">B_E</a> will be called for VMs that are not halted (or don’t exist?).</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_dom0_ensureHalted" class="level4">
<h4>b_dom0_ensureHalted [vm 1] … [vm n]</h4>
<p><small><em>os/qubes4/dom0/b_dom0_ensureHalted</em></small><br />
Shut down the given VMs if needed.<br />
<span class="par">[vm i]: The VM to halt.</span><br />
<span class="ret"><strong>returns</strong>: Nothing. <a href="#B_E">B_E</a> will be called for VMs that could not be halted (maybe they don’t exist?).</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_dom0_exists" class="level4">
<h4>b_dom0_exists [vm]</h4>
<p><small><em>os/qubes4/dom0/b_dom0_exists</em></small><br />
Check whether the given VM exists.<br />
<span class="par">[vm]: The VM to check.</span><br />
<span class="ret"><strong>returns</strong>: Sets a zero exit code, if the VM exists a non-zero exit code otherwise.</span></p>
</section>
<section id="b_dom0_openCrypt" class="level4">
<h4>b_dom0_openCrypt [vm] [device] [mapper name] [rw flag] [mount point] [key file] [additional options] [password prompt]</h4>
<p><small><em>os/qubes4/dom0/b_dom0_openCrypt</em></small><br />
In the given VM, open the given crypto device with dm-crypt and mount it to the mount point.<br />
<span class="par">[vm]: The VM where to open the crypto device.</span><br />
<span class="par">[device]: Full path to the device (incl. /dev/) to open.</span><br />
<span class="par">[mapper name]: The name to assign to the decrypted version of the crypto block device. The created decrypted device will be found at <em>/dev/mapper/[mapper name]</em>.</span><br />
<span class="par">[rw flag]: 0=open read-write, 1=open read-only (default: 0)</span><br />
<span class="par">[mount point]: Where to mount the decrypted data to. Non-existing directories will be created. If no mount point is specified, it will not be mounted (default).</span><br />
<span class="par">[key file]: Full vm path to the key to use for decryption. If none is specified, password-based decryption is assumed and stdin will be read to obtain the password.</span><br />
<span class="par">[additional options]: Single string with additional cryptsetup parameters to pass on (default: none). They are passed <em>as-is</em>, i.e. you’ll have to take care of proper escaping etc. yourself.</span><br />
<span class="par">[password prompt]: Optional string to use when the user is required to provide a decryption password.</span><br />
<span class="ret"><strong>returns</strong>: nothing (except for user interaction prompts if no key file is provided), but sets a non-zero exit code on errors</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_dom0_closeCrypt" class="level4">
<h4>b_dom0_closeCrypt [vm] [mapper name] [mount point]</h4>
<p><small><em>os/qubes4/dom0/b_dom0_closeCrypt</em></small><br />
Close a crypto device opened with <a href="#b_dom0_openCrypt">b_dom0_openCrypt</a>.<br />
<span class="par">[vm]: The VM where to close the crypto device.</span><br />
<span class="par">[mapper name]: The name used when it was opened.</span><br />
<span class="par">[mount point]: If the decrypted data is mounted inside the [vm], please specify the mount point here so that it can be unmounted before closing the device. Otherwise the function will attempt to close the device without unmounting (likely to fail).</span><br />
<span class="ret"><strong>returns</strong>: nothing, but sets a non-zero exit code on errors</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_dom0_parseQvmBlock" class="level4">
<h4>b_dom0_parseQvmBlock [variable name] [input]</h4>
<p><small><em>os/qubes4/dom0/b_dom0_parseQvmBlock</em></small><br />
Parse data from <code>qvm-block ls</code> to an associative array.<br />
The indices of the associative array will be of the format <em>[counter]_[field]</em> (counters run from 0 (inclusive) to max (exclusive)).<br />
The special index “max” is equal to the number of lines. It can be used for iterations over the map.<br />
Currently supported [field] values: backend|device id|id|description|used by|read-only|frontend-dev<br />
<span class="par">[variable name]: Name of the associative array to use as output.</span><br />
<span class="par">[input]: Optional output from a previous <code>qvm-block ls</code> call; if none is specified, this function will execute the call and use its output.</span><br />
<span class="ret"><strong>returns</strong>: A string specifying an associative array in bash syntax. You can eval that string to obtain all relevant data or use the more convenient <a href="#b_dom0_getQvmBlockInfo">b_dom0_getQvmBlockInfo</a>. On errors <a href="#B_E">B_E</a> is called.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_dom0_getQvmBlockInfo" class="level4">
<h4>b_dom0_getQvmBlockInfo [map] [retrieve field] [filter field 1] [filter value 1] .. [filter field n] .. [filter value n]</h4>
<p><small><em>os/qubes4/dom0/b_dom0_getQvmBlockInfo</em></small><br />
Convenience function to retrieve information from the output of <a href="#b_dom0_parseQvmBlock">b_dom0_parseQvmBlock</a>.<br />
Searches for the given filter values in the given fields and retrieves the first field value matching all filters.<br />
More simple, but less flexible than <a href="#b_dom0_parseQvmBlock">b_dom0_parseQvmBlock</a>.<br />
<span class="par">[map]: Optional output from a previous call to <a href="#b_dom0_parseQvmBlock">b_dom0_parseQvmBlock</a>. If none is specified, this function will internally call <a href="#b_dom0_parseQvmBlock">b_dom0_parseQvmBlock</a>.</span><br />
<span class="par">[retrieve field]: Name of the field to retrieve.</span><br />
<span class="par">[filter field i]: Name of any field supported by <a href="#b_dom0_parseQvmBlock">b_dom0_parseQvmBlock</a>.</span><br />
<span class="par">[filter value i]: The value to search for in [filter field i] (equality check).</span><br />
<span class="ret"><strong>returns</strong>: The value of the requested field and sets a zero exit code on success. Sets a non-zero exit code if no matching value could be found. On errors <a href="#B_E">B_E</a> is called.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_dom0_attachDevice" class="level4">
<h4>b_dom0_attachDevice [dom0 device] [target VM] [rw flag] [force]</h4>
<p><small><em>os/qubes4/dom0/b_dom0_attachDevice</em></small><br />
Attach the given device from dom0 (!) as block device to the target VM.<br />
<span class="par">[dom0 device]: Full path to the device node (incl. /dev/) <em>in dom0</em>.</span><br />
<span class="par">[target VM]: VM to attach the device to. Must be started.</span><br />
<span class="par">[rw flag]: If set to 0, attaches the dom0 device in r/w (read-write) mode. If set to 1 (default), attaches the file in r/o (read only) mode.</span><br />
<span class="par">[force]: If set to 0, attempt to force Qubes OS to recognize the device (default: 1). This is required for e.g. VM images. Please call <a href="#b_dom0_detachDevice">b_dom0_detachDevice</a> with the clean flag for the detach operation, if set to 0.</span><br />
<span class="ret"><strong>returns</strong>: The full path to the device created in the target VM and sets a zero exit code on success. Otherwise a non-zero exit code is set.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_dom0_attachFile" class="level4">
<h4>b_dom0_attachFile [dom0 file] [target VM] [rw flag] [force]</h4>
<p><small><em>os/qubes4/dom0/b_dom0_attachFile</em></small><br />
Attach the given file from dom0 (!) as block device to the target VM.<br />
The function may attempt to acquire root privileges (and thus display a password prompt).<br />
<span class="par">[dom0 file]: Full path to the file <em>in dom0</em> to attach.</span><br />
<span class="par">[target VM]: VM to attach the file to. Must be started.</span><br />
<span class="par">[rw flag]: If set to 0, attaches the dom0 file in r/w (read-write) mode. If set to 1 (default), attaches the file in r/o (read only) mode.</span><br />
<span class="par">[force]: If set to 0, attempt to force Qubes OS to recognize the device (default: 1). This is required for e.g. VM images. Please call <a href="#b_dom0_detachDevice">b_dom0_detachDevice</a> with the clean flag for the detach operation, if set to 0.</span><br />
<span class="ret"><strong>returns</strong>: The full path to the device created in the target VM and sets a zero exit code on success. Otherwise a non-zero exit code is set.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_dom0_attachVMDisk" class="level4">
<h4>b_dom0_attachVMDisk [source VM] [target VM] [rw flag] [pool driver] [disk path]</h4>
<p><small><em>os/qubes4/dom0/b_dom0_attachVMDisk</em></small><br />
Attach the entire private disk image (private.img) of the source VM to the target VM.<br />
<strong>Warning</strong>: This is contradictory to all Qubes principles and should only be done if you know exactly what you’re doing. Qubes OS even has some countermeasures to prevent accidental use of this feature which are bypassed here.<br />
<span class="par">[source VM]: Name of the VM whose private disk to attach to the target VM. <em>All data</em> of that VM will be shared with the target VM. Will be shut down as part of this function and must remain shut down as long as the disk is attached.</span><br />
<span class="par">[target VM]: VM where to attach the disk as block device to. Must be started.</span><br />
<span class="par">[rw flag]: If set to 0, attaches the disk file in r/w (read-write) mode. If set to 1 (default), attaches the file in r/o (read only) mode.</span><br />
<span class="par">[pool driver]: Driver of the pool that the disk was created in: One of file, file-reflink or lvm_thin (default: driver of the given [source VM]).</span><br />
<span class="par">[disk path]: Full path to the disk. Default: Path to the private volume of the [source VM] in the pool of the respective [pool driver]. May override the [source VM] parameter.</span><br />
<span class="ret"><strong>returns</strong>: The full path to the device created in the target VM and sets a zero exit code on success. Otherwise a non-zero exit code is set. Please call <a href="#b_dom0_detachDevice">b_dom0_detachDevice</a> with the clean flag for the detach operation.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_dom0_getPoolDriver" class="level4">
<h4>b_dom0_getPoolDriver [vm] [volume]</h4>
<p><small><em>os/qubes4/dom0/b_dom0_getPoolDriver</em></small><br />
Get the name of the pool driver used by the given VM.<br />
<span class="par">[vm]: VM for which to retrieve the pool driver (default: system default pool).</span><br />
<span class="par">[volume]: VM volume type for which to retrieve the pool driver (default: private).</span><br />
<span class="ret"><strong>returns</strong>: Name of the pool driver. <a href="#B_E">B_E</a> is called on errors.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_dom0_getDefaultPoolDriver" class="level4">
<h4>b_dom0_getDefaultPoolDriver [volume]</h4>
<p><small><em>os/qubes4/dom0/b_dom0_getDefaultPoolDriver</em></small><br />
Retrieve the driver name of the system’s default pool.<br />
<span class="par">[volume]: Volume type for which to retrieve the pool driver (default: private).</span><br />
<span class="ret"><strong>returns</strong>: Driver name of the system’s default pool.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_dom0_crossAttachDevice" class="level4">
<h4>b_dom0_crossAttachDevice [source VM] [source device] [target VM] [rw flag]</h4>
<p><small><em>os/qubes4/dom0/b_dom0_crossAttachDevice</em></small><br />
Attach the given block device from the source VM to the target VM.<br />
This is merely a convenience wrapper for <code>qvm-block attach</code>.<br />
<span class="par">[source VM]: VM where the source file can be found.</span><br />
<span class="par">[source device]: Device to attach to the [target VM].</span><br />
<span class="par">[target VM]: VM to attach the device to. Must be started.</span><br />
<span class="par">[rw flag]: If set to 0, attaches the [source deivce] in r/w (read-write) mode. If set to 1 (default), attaches the file in r/o (read only) mode.</span><br />
<span class="ret"><strong>returns</strong>: The full path to the device created in the target VM and sets a zero exit code on success. Otherwise a non-zero exit code is set.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_dom0_crossAttachFile" class="level4">
<h4>b_dom0_crossAttachFile [source VM] [source file] [target VM] [rw flag]</h4>
<p><small><em>os/qubes4/dom0/b_dom0_crossAttachFile</em></small><br />
Attach the given file from the source VM as block device to the target VM.<br />
<span class="par">[source VM]: VM where the source file can be found.</span><br />
<span class="par">[source file]: File to attach as block device.</span><br />
<span class="par">[target VM]: VM to attach the file to. Must be started.</span><br />
<span class="par">[rw flag]: If set to 0, attaches the [source file] in r/w (read-write) mode. If set to 1 (default), attaches the file in r/o (read only) mode.</span><br />
<span class="ret"><strong>returns</strong>: The full path to the device created in the target VM and sets a zero exit code on success. Otherwise a non-zero exit code is set.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_dom0_detachDevice" class="level4">
<h4>b_dom0_detachDevice [vm] [device] [clean flag]</h4>
<p><small><em>os/qubes4/dom0/b_dom0_detachDevice</em></small><br />
Attempts to detach the given device from the VM. This may fail if the VM is using the device and thus it is usually a better idea to just shut the VM down.<br />
<span class="par">[vm]: VM from which to detach the device.</span><br />
<span class="par">[device]: Full path to the device in the VM. E.g. the return values of <a href="#b_dom0_crossAttachFile">b_dom0_crossAttachFile</a>, <a href="#b_dom0_attachFile">b_dom0_attachFile</a> or <a href="#b_dom0_attachVMDisk">b_dom0_attachVMDisk</a>.</span><br />
<span class="par">[clean flag]: Also wipe the device from the Qubes DB, if it’s there (default: 1).</span><br />
<span class="ret"><strong>returns</strong>: nothing, but sets a zero exit code on success</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_dom0_enterEventLoop" class="level4">
<h4>b_dom0_enterEventLoop [callback function] [heartbeat interval]</h4>
<p><small><em>os/qubes4/dom0/b_dom0_enterEventLoop</em></small><br />
Enter a blocking loop to react to Qubes OS events. <a href="#b_dom0_disconnectEventLoop">b_dom0_disconnectEventLoop</a> can be used to disconnect from the event loop asynchronously, e.g. from exit traps.<br />
If you want to obtain an overview of Qubes OS events, please use the <code>qwatch</code> utility manually.<br />
<span class="par">[callback function]: Name of the function to call for <em>every</em> Qubes OS event. Since the number of events may be high, the function should do appropriate filtering at high performance.</span><br />
The callback function should be declared as follows:</p>
<pre><code>callback_function_name [subject] [event name] [event info] [timestamp]
[subject]: The subject name Qubes OS provides. Usually the VM for which the
    event was reported. &#39;None&#39; appears to mean &#39;dom0&#39;.
[event name]: Name of the event for which the callback function was called.
[event info]: May contain additional information about the event (e.g.
              arguments).
[timestamp]: When the event was received in ms since EPOCH.
returns:  Nothing. A non-zero exit code will abort further processing.</code></pre>
<p><span class="par">[heartbeat interval]: Interval in ms at which to send heartbeat events (default: no heartbeat events).</span><br />
<span class="ret"><strong>returns</strong>: Nothing, but uses the exit code of the last callback function execution as its own. Sets an exit code of 0, if the event loop was terminated by <a href="#b_dom0_disconnectEventLoop">b_dom0_disonnectEventLoop</a>. <a href="#B_E">B_E</a> is only called on exceptional errors.</span><br />
<span class="ann"><em><span class="citation" data-cites="StateChanging">@StateChanging</span></em></span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_dom0_disconnectEventLoop" class="level4">
<h4>b_dom0_disconnectEventLoop</h4>
<p><small><em>os/qubes4/dom0/b_dom0_disconnectEventLoop</em></small><br />
Send a termination request to a dom0 event loop started with <a href="#b_dom0_enterEventLoop">b_dom0_enterEventLoop</a>. This is useful to exit the event loop from outside of it.<br />
<span class="ret"><strong>returns</strong>: A non-zero exit code indicates that either no active event loop existed or the signal sending failed. Never errors out to be suitable for e.g. exit traps.</span><br />
<span class="ann"><em><span class="citation" data-cites="StateChanging">@StateChanging</span></em></span></p>
</section>
<section id="b_dom0_testMultiple" class="level4">
<h4>b_dom0_testMultiple [vm] [operator] [list]</h4>
<p><small><em>os/qubes4/dom0/b_dom0_testMultiple</em></small><br />
Run multiple <code>test</code> checks inside the given VM with a single <code>qvm-run</code> call.<br />
<span class="par">[vm]: Where to run the checks.</span><br />
<span class="par">[operator]: The test operator to use for the list of parameters, e.g. <code>-f</code>.</span><br />
<span class="par">[list]: Newline-separated list of parameters to check, e.g. a list of files for the <code>-f</code> operator.</span><br />
<span class="ret"><strong>returns</strong>: The subset of the list that matched the operator and sets a zero exit code on success.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_dom0_applyFirewall" class="level4">
<h4>b_dom0_applyFirewall [vm] [rules]</h4>
<p><small><em>os/qubes4/dom0/b_dom0_applyFirewall</em></small><br />
Apply the given rules to the VM firewall.<br />
<strong>Important</strong>: Since the rules are applied iteratively, there may be short timeframes during which the VM may have no network access.<br />
<span class="par">[vm]: VM for which to apply the firewall rules.</span><br />
<span class="par">[rules]: Newline-separated list of firewall rules in <em>raw</em> format (cf. <code>man qvm-firewall</code>). The rules are added in the order as specified.</span><br />
(This corresponds to the <code>qvm-firewall --raw [vm]</code> output.) Previously applied rules are left untouched.<br />
Empty lines and lines starting with <code>#</code> (comments) are ignored.<br />
<span class="ret"><strong>returns</strong>: Nothing. If a rule cannot be added for whatever reason, a drop-all rule will be inserted in the beginning for security reasons.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_dom0_clearFirewall" class="level4">
<h4>b_dom0_clearFirewall [vm]</h4>
<p><small><em>os/qubes4/dom0/b_dom0_clearFirewall</em></small><br />
Clears the given VM firewall entirely (no rules left). This will make the VM firewall drop all connections.<br />
Existing connections may continue to work as long as the VM and the connection remain up (this is a known Qubes OS quirk).<br />
<span class="par">[vm]: VM for which to clear all rules.</span><br />
<span class="ret"><strong>returns</strong>: Nothing. Errors will result in a drop-all state.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
</section>
</section>
<section id="proc" class="level2">
<h2>proc</h2>
<p>Collection of process and thread related functions.</p>
<p>Copyright (C) 2020 David Hobach LGPLv3<br />
0.2</p>
<section id="dependencies-24" class="level3">
<h3>Dependencies</h3>
<p>kill<br />
killall<br />
tail<br />
timeout</p>
</section>
<section id="imports-24" class="level3">
<h3>Imports</h3>
<p>no imports</p>
</section>
<section id="functions-23" class="level3">
<h3>Functions</h3>
<section id="b_proc_pidExists" class="level4">
<h4>b_proc_pidExists [pid]</h4>
<p><small><em>proc/b_proc_pidExists</em></small><br />
Check whether the given process ID exists on the system.<br />
<span class="par">[pid]: process ID to check for existence (process exists)</span><br />
<span class="ret"><strong>returns</strong>: A zero exit code, if it exists and a non-zero exit code if it doesn’t; this function attempts to check the existence of the given process across <em>all</em> users, but it cannot guarantee correctness if the user running this script has very low privileges.</span></p>
</section>
<section id="b_proc_childExists" class="level4">
<h4>b_proc_childExists [pid]</h4>
<p><small><em>proc/b_proc_childExists</em></small><br />
Check whether the given process ID exists <em>and</em> is a <em>direct</em> child of the calling bash process.<br />
<span class="par">[pid]: process ID to check</span><br />
<span class="ret"><strong>returns</strong>: A zero exit code, if the caller is a parent of the given pid.</span></p>
</section>
<section id="b_proc_waitForPid" class="level4">
<h4>b_proc_waitForPid [pid] [maximum time]</h4>
<p><small><em>proc/b_proc_waitForPid</em></small><br />
Wait for the given process to exit. If it doesn’t exist, exit immediately.<br />
<span class="par">[pid]: Process ID of the process to wait for.</span><br />
<span class="par">[maximum time]: Maximum time in seconds to wait for the process to exit (default: 0 = indefinitely).</span><br />
<span class="ret"><strong>returns</strong>: Nothing, always sets a zero exit code. Use <a href="#b_proc_pidExists">b_proc_pidExists</a> if you need to know whether the process finished.</span></p>
</section>
<section id="b_proc_resolveSignal" class="level4">
<h4>b_proc_resolveSignal [signal]</h4>
<p><small><em>proc/b_proc_resolveSignal</em></small><br />
Resolve process (kill) signal names to their numeric identifiers.<br />
<span class="par">[signal]: Signal name (string) or numeric identifier.</span><br />
<span class="ret"><strong>returns</strong>: The numeric identifier corresponding to the given signal.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_proc_killAndWait" class="level4">
<h4>b_proc_killAndWait [pid] [signal] [timeout]</h4>
<p><small><em>proc/b_proc_killAndWait</em></small><br />
Send a kill/exit signal to a process and wait for it to terminate.<br />
<span class="par">[pid]: Process ID of the process to wait to terminate.</span><br />
<span class="par">[signal]: Signal name (string) or numeric identifier to send (default: SIGTERM).</span><br />
<span class="par">[timeout]: Time in seconds after which to send a SIGKILL if the process doesn’t terminate (default: 0 = wait forever).</span><br />
<span class="ret"><strong>returns</strong>: A zero exit code, if the process terminated without timeout or could not be found.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_proc_killByRegexAndWait" class="level4">
<h4>b_proc_killByRegexAndWait [regex] [signal] [timeout]</h4>
<p><small><em>proc/b_proc_killByRegexAndWait</em></small><br />
Kill/Terminate all matching processes.<br />
<span class="par">[regex]: Regular expression matched against running process names. Matching processes will be terminated.</span><br />
<span class="par">[signal]: Signal name (string) or numeric identifier to send (default: SIGTERM).</span><br />
<span class="par">[timeout]: Time in seconds after which to send a SIGKILL if the processes don’t terminate (default: 0 = wait forever).</span><br />
<span class="ret"><strong>returns</strong>: A zero exit code, if the process terminated without timeout or could not be found.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
</section>
</section>
<section id="sqlite3" class="level2">
<h2>sqlite3</h2>
<p>Stateful sqlite driver for bash.</p>
<p>This module provides all features of the sqlite interactive mode to non-interactive bash scripts. See <code>man sqlite3</code> for the available commands.</p>
<p>Keeping a single database connection open usually exhibits better performance than calling <code>sqlite3</code> in batch mode over and over again.</p>
<p>Side Note: If you want to read or write csv files, this module can also do the job for you with standard SQL syntax. See <code>man sqlite3</code> on how to read and write csv files with sqlite.</p>
<p>Copyright (C) 2020 David Hobach LGPLv3<br />
0.5</p>
<section id="dependencies-25" class="level3">
<h3>Dependencies</h3>
<p>mkfifo<br />
mktemp<br />
rm<br />
sqlite3</p>
</section>
<section id="imports-25" class="level3">
<h3>Imports</h3>
<p>no imports</p>
</section>
<section id="functions-24" class="level3">
<h3>Functions</h3>
<section id="b_sqlite3_open" class="level4">
<h4>b_sqlite3_open [db file] [timeout]</h4>
<p><small><em>sqlite3/b_sqlite3_open</em></small><br />
Open a new sqlite connection to a database. This <strong>must</strong> be called exactly once before any calls to <a href="#b_sqlite3_exec">b_sqlite3_exec</a>.<br />
<span class="par">[db file]: The database file to connect to (default: a new in-memory database). If it doesn’t exist, it may be created (the behaviour is identical to <code>sqlite3</code>).</span><br />
<span class="par">[timeout]: Maximum time in seconds to wait for a command to execute on the database via <a href="#b_sqlite3_exec">b_sqlite3_exec</a>. Default: -1 = indefinitely</span><br />
<span class="ret"><strong>returns</strong>: Nothing.</span><br />
<span class="ann"><em><span class="citation" data-cites="StateChanging">@StateChanging</span></em></span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_sqlite3_getOpen" class="level4">
<h4>b_sqlite3_getOpen</h4>
<p><small><em>sqlite3/b_sqlite3_getOpen</em></small><br />
Retrieve the currently open database.<br />
<span class="ret"><strong>returns</strong>: Prints the currently open database and an empty string for an unnamed database. Sets a zero exit code, if and only if a database is currently open.</span></p>
</section>
<section id="b_sqlite3_exec" class="level4">
<h4>b_sqlite3_exec [command] [timeout] [filter input]</h4>
<p><small><em>sqlite3/b_sqlite3_exec</em></small><br />
Executes the given command on an open sqlite database (cf. <a href="#b_sqlite3_open">b_sqlite3_open</a>).<br />
<span class="par">[command]: The command to execute. All commands supported by <code>sqlite3</code> in interactive mode incl. the SQL commands are supported. The only exception is the <code>.output</code> command. Please use the bash output redirection instead of <code>.output</code>. <strong>Warning</strong>: Incomplete (e.g. missing <code>;</code>) or incorrect commands may cause this function to make your bash script hang forever, if no [timeout] is specified.</span><br />
<span class="par">[timeout]: Maximum time in seconds to wait for the command to execute on the database (default: the timeout initialized via <a href="#b_sqlite3_open">b_sqlite3_open</a>).</span><br />
<span class="par">[filter input]: Whether or not to filter command input lines from the returned output (default: 0 = true).</span><br />
<span class="ret"><strong>returns</strong>: The output provided by the database in response to the executed command incl. potential errors. The function attempts to set a non-zero exit code, if the output contains error messages. <a href="#B_E">B_E</a> is only called on timeouts or other database connectivity issues.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_sqlite3_close" class="level4">
<h4>b_sqlite3_close</h4>
<p><small><em>sqlite3/b_sqlite3_close</em></small><br />
Closes a currently open database connection.<br />
It is highly recommended to execute this function once you don’t need the database connection anymore (usually at the end of a script).<br />
<span class="ret"><strong>returns</strong>: Nothing. A non-zero exit code indicates a failed close operation.</span><br />
<span class="ann"><em><span class="citation" data-cites="StateChanging">@StateChanging</span></em></span></p>
</section>
</section>
</section>
<section id="str" class="level2">
<h2>str</h2>
<p>Collection of string related functions.</p>
<p>Copyright (C) 2021 David Hobach LGPLv3<br />
0.2</p>
<section id="dependencies-26" class="level3">
<h3>Dependencies</h3>
<p>no dependencies</p>
</section>
<section id="imports-26" class="level3">
<h3>Imports</h3>
<p>no imports</p>
</section>
<section id="functions-25" class="level3">
<h3>Functions</h3>
<section id="b_str_stripQuotes" class="level4">
<h4>b_str_stripQuotes [string]</h4>
<p><small><em>str/b_str_stripQuotes</em></small><br />
Remove any single or double quotes around the given string.<br />
<span class="par">[string]: string which might be enclosed in single or double quotes (’ or &quot;)</span><br />
<span class="ret"><strong>returns</strong>: [string] without the enclosed single or double quotes, if there were any; if none were found the original string is returned; the exit code is always zero</span></p>
</section>
<section id="b_str_trim" class="level4">
<h4>b_str_trim [string]</h4>
<p><small><em>str/b_str_trim</em></small><br />
Remove any whitespace from around a string.<br />
<span class="par">[string]: string to trim</span><br />
<span class="ret"><strong>returns</strong>: [string] beginning and ending without whitespace; the exit code is always zero</span></p>
</section>
<section id="b_str_prefixLines" class="level4">
<h4>b_str_prefixLines [string] [prefix]</h4>
<p><small><em>str/b_str_prefixLines</em></small><br />
Prefix all lines of the given string with a given prefix.<br />
<span class="par">[string]: Each line of this string will be prefixed.</span><br />
<span class="par">[prefix]: The string to put in front of each line.</span><br />
<span class="ret"><strong>returns</strong>: All lines of the input string, each of them prefixed with the given prefix.</span></p>
</section>
</section>
</section>
<section id="tcolors" class="level2">
<h2>tcolors</h2>
<p>Defines some tput related constants. In order to change terminal colors you can then use something such as</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true"></a><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$(</span><span class="ex">tput</span> setaf <span class="va">${B_TCOLORS[red]})</span><span class="st">This is red, \</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true"></a><span class="va">$(</span><span class="ex">tput</span> setaf <span class="va">${B_TCOLORS[blue]})</span><span class="st">this blue, </span><span class="va">$(</span><span class="ex">tput</span> sgr0<span class="va">)</span><span class="st">this normal.&quot;</span></span></code></pre></div>
<p>tput can do a lot more than colors, see: man tput &amp; man terminfo.</p>
<p>Copyright (C) 2018 David Hobach LGPLv3<br />
0.1</p>
<section id="dependencies-27" class="level3">
<h3>Dependencies</h3>
<p>tput</p>
</section>
<section id="imports-27" class="level3">
<h3>Imports</h3>
<p>no imports</p>
</section>
<section id="global-variables-8" class="level3">
<h3>Global Variables</h3>
<section id="B_TCOLORS" class="level4">
<h4>B_TCOLORS</h4>
<p><small><em>tcolors/B_TCOLORS</em></small><br />
Global map for human readable colors to tput style color identifiers.<br />
Currently supported values: black|red|green|yellow|blue|magenta|cyan|white</p>
</section>
</section>
</section>
<section id="traps" class="level2">
<h2>traps</h2>
<p>Collection of trap related functions.</p>
<p>Copyright (C) 2018 David Hobach LGPLv3<br />
0.2</p>
<section id="dependencies-28" class="level3">
<h3>Dependencies</h3>
<p>no dependencies</p>
</section>
<section id="imports-28" class="level3">
<h3>Imports</h3>
<p>no imports</p>
</section>
<section id="functions-26" class="level3">
<h3>Functions</h3>
<section id="b_traps_getCodeFor" class="level4">
<h4>b_traps_getCodeFor [signal]</h4>
<p><small><em>traps/b_traps_getCodeFor</em></small><br />
Retrieve the current trap code / commands for the given signal.<br />
<span class="ret"><strong>returns</strong>: The current code and sets a zero exit code on success.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_traps_add" class="level4">
<h4>b_traps_add [code] [signal] [tag] [append flag]</h4>
<p><small><em>traps/b_traps_add</em></small><br />
Add the given commands to the given trap signal.<br />
<span class="par">[code]: Whatever should be added to the trap.</span><br />
<span class="par">[signal]: Name of the signal to add the commands to.</span><br />
<span class="par">[tag]: An optional <em>unique</em> marker for these commands so that they can be removed with <a href="#b_traps_remove">b_traps_remove</a> later on.</span><br />
<span class="par">[append flag]: Whether to append the new commands to the end (0: default) or insert them in the beginning (1).</span><br />
<span class="ret"><strong>returns</strong>: Whatever the internal call to <em>trap</em> to set the new trap returns.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_traps_prepend" class="level4">
<h4>b_traps_prepend [code] [signal] [tag]</h4>
<p><small><em>traps/b_traps_prepend</em></small><br />
Prepend the given commands to the ones currently existing for the given trap signal.</p>
<p>Convenience wrapper to <a href="#b_traps_add">b_traps_add</a> with [append flag] set to 1.<br />
<span class="par">[code]: see <a href="#b_traps_add">b_traps_add</a></span><br />
<span class="par">[signal]: see <a href="#b_traps_add">b_traps_add</a></span><br />
<span class="par">[tag]: see <a href="#b_traps_add">b_traps_add</a></span><br />
<span class="ret"><strong>returns</strong>: see <a href="#b_traps_add">b_traps_add</a></span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_traps_remove" class="level4">
<h4>b_traps_remove [signal] [tag]</h4>
<p><small><em>traps/b_traps_remove</em></small><br />
Remove the commands tagged with the given tag from the signal trap.<br />
<span class="par">[signal]: Name of the signal to remove the commands from.</span><br />
<span class="par">[tag]: The <em>unique</em> marker to identify the commands to be removed.</span><br />
<span class="ret"><strong>returns</strong>: Nothing, but sets a zero exit code on success. May error out if the tag isn’t found or the internal trap call failed.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
</section>
</section>
<section id="types" class="level2">
<h2>types</h2>
<p>Functions for data type checks and conversions.</p>
<p>Copyright (C) 2022 David Hobach LGPLv3<br />
0.6</p>
<section id="dependencies-29" class="level3">
<h3>Dependencies</h3>
<p>python3</p>
</section>
<section id="imports-29" class="level3">
<h3>Imports</h3>
<p>no imports</p>
</section>
<section id="global-variables-9" class="level3">
<h3>Global Variables</h3>
<section id="B_TYPES_ENCODING" class="level4">
<h4>B_TYPES_ENCODING</h4>
<p><small><em>types/B_TYPES_ENCODING</em></small><br />
String encoding parameter for <a href="#b_types_str">b_types_str</a> and <a href="#b_types_parseString">b_types_parseString</a>. Default: ascii<br />
<code>ascii</code> makes sense in 99% of all cases as scripts should use ASCII only anyway (when no user-interaction is involved) in order to remain portable. Keep in mind that bash also needs to support the target encoding in order to support further processing. Currently available encodings: <a href="https://docs.python.org/3.7/library/codecs.html#standard-encodings" class="uri">https://docs.python.org/3.7/library/codecs.html#standard-encodings</a></p>
</section>
<section id="B_TYPES_MAX_BYTES" class="level4">
<h4>B_TYPES_MAX_BYTES</h4>
<p><small><em>types/B_TYPES_MAX_BYTES</em></small><br />
Parameter for <a href="#b_types_str">b_types_str</a> and <a href="#b_types_parseString">b_types_parseString</a> to specify the maximum number of bytes to read per line (default: -1/infinite). Ignore additional bytes. Useful to avoid memory DoS for untrusted input.</p>
</section>
<section id="B_TYPES_CHECK_NON_BINARY" class="level4">
<h4>B_TYPES_CHECK_NON_BINARY</h4>
<p><small><em>types/B_TYPES_CHECK_NON_BINARY</em></small><br />
Whether or not <a href="#b_types_int">b_types_int</a> should also ensure that the command output is non-binary (default: 0/true).</p>
</section>
</section>
<section id="functions-27" class="level3">
<h3>Functions</h3>
<section id="b_types_parseString" class="level4">
<h4>b_types_parseString [encoding] [max bytes]</h4>
<p><small><em>types/b_types_parseString</em></small><br />
Checks whether whatever is lying in stdin is a string (and not binary) and if so, prints it to stdout.</p>
<p><strong>Important</strong>:</p>
<ul>
<li>bash has major issues whenever binary data is involved. For example equality checks may return undefined results. So whenever you are unsure as to whether a variable is a string or not, better pass it thorugh this function.</li>
<li>The input is taken from <em>stdin</em> rather than as parameter as binary parameters may also cause issues (special bytes etc.).</li>
<li>Even builtins such as <code>echo</code> do not necessarily play well with binary data. So it is recommended to pipe binary data through this function before further processing.</li>
</ul>
<p>Examples:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true"></a> <span class="co">#check a file</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true"></a> <span class="ex">b_types_parseString</span> <span class="op">&lt;</span> <span class="st">&quot;/path/to/potential/binary&quot;</span> <span class="op">&gt;</span> /dev/null <span class="kw">&amp;&amp;</span> <span class="bu">echo</span> <span class="st">&quot;It is a string file.&quot;</span> <span class="kw">||</span> <span class="bu">echo</span> <span class="st">&quot;It is a binary file.&quot;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true"></a> <span class="co">#read parts of a file as string</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true"></a> <span class="va">str=</span><span class="st">&quot;</span><span class="va">$(</span><span class="fu">dd</span> if=<span class="st">&quot;/path/to/another/file&quot;</span> bs=1 skip=8 <span class="kw">|</span> <span class="ex">b_types_parseString</span><span class="va">)</span><span class="st">&quot;</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true"></a><span class="bu"> [</span> <span class="va">$?</span> <span class="ot">-eq</span> 0<span class="bu"> ]</span> <span class="kw">&amp;&amp;</span> <span class="bu">echo</span> <span class="st">&quot;Found the following string: </span><span class="va">$str</span><span class="st">&quot;</span></span></code></pre></div>
<p><span class="par">[encoding]: The encoding of the string lying in stdin. Default: <a href="#B_TYPES_ENCODING">B_TYPES_ENCODING</a>/ascii</span><br />
<span class="par">[max bytes]: Maximum number of bytes to read per line. Additional bytes are ignored. Default: <a href="#B_TYPES_MAX_BYTES">B_TYPES_MAX_BYTES</a>/-1/infinite</span><br />
<span class="ret"><strong>returns</strong>: The data as String, if the input data was found to be a String. If no String was found to be lying in stdin, the output is an undefined string and a non-zero exit code is set. <a href="#B_E">B_E</a> is only called on exceptional errors.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_types_str" class="level4">
<h4>b_types_str [cmd] [cmd arg 1] … [cmd arg n]</h4>
<p><small><em>types/b_types_str</em></small><br />
Execute the given command and ensure that its output / stdout is a string.<br />
Use <a href="#B_TYPES_ENCODING">B_TYPES_ENCODING</a> to specify the encoding (default: ascii) and <a href="#B_TYPES_MAX_BYTES">B_TYPES_MAX_BYTES</a> (default: -1/infinite) to specify the maximum number of bytes to read.<br />
<span class="par">[cmd]: Command to execute. Stdout is checked to be a string, stderr is passed through.</span><br />
<span class="par">[cmd arg i]: Arguments to pass to [cmd].</span><br />
<span class="ret"><strong>returns</strong>: Stdout of [cmd], if it is a string and an undefined string otherwise. The exit code is that of the executed command. <a href="#B_E">B_E</a> is called if the output is <em>not</em> a string.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_types_parseInteger" class="level4">
<h4>b_types_parseInteger</h4>
<p><small><em>types/b_types_parseInteger</em></small><br />
Checks whether whatever is lying in stdin is an Integer and if so, prints it to stdout.<br />
<a href="#B_TYPES_CHECK_NON_BINARY">B_TYPES_CHECK_NON_BINARY</a> can be used to enable/disable additional non-binary checking (default: 0/enabled).<br />
<span class="ret"><strong>returns</strong>: The data as Integer, if the input data was found to be an Integer. If no Integer was found to be lying in stdin, the output is an undefined string and a non-zero exit code is set. <a href="#B_E">B_E</a> is only called on exceptional errors.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_types_isInteger" class="level4">
<h4>b_types_isInteger [string]</h4>
<p><small><em>types/b_types_isInteger</em></small><br />
Check whether the given String is an integer (positive or negative) or not.<br />
<a href="#B_TYPES_CHECK_NON_BINARY">B_TYPES_CHECK_NON_BINARY</a> can be used to enable/disable additional non-binary checking (default: 0/enabled).<br />
<span class="par">[string]: The string to check.</span><br />
<span class="ret"><strong>returns</strong>: Nothing, but sets a zero exit code if and only if the given string represents an integer.</span></p>
</section>
<section id="b_types_assertInteger" class="level4">
<h4>b_types_assertInteger [string] [error msg]</h4>
<p><small><em>types/b_types_assertInteger</em></small><br />
Check whether the given String is an integer (positive or negative) and if not, error out.<br />
<a href="#B_TYPES_CHECK_NON_BINARY">B_TYPES_CHECK_NON_BINARY</a> can be used to enable/disable additional non-binary checking (default: 0/enabled).<br />
<span class="par">[string]: The string to check.</span><br />
<span class="par">[error msg]: Error message to use, if the check fails (optional).</span><br />
<span class="ret"><strong>returns</strong>: Nothing. If it’s no integer, <a href="#B_E">B_E</a> is called.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_types_int" class="level4">
<h4>b_types_int [cmd] [cmd arg 1] … [cmd arg n]</h4>
<p><small><em>types/b_types_int</em></small><br />
Execute the given command and ensure that its output / stdout is an integer (positive or negative).<br />
<a href="#B_TYPES_CHECK_NON_BINARY">B_TYPES_CHECK_NON_BINARY</a> can be used to enable/disable additional non-binary checking (default: 0/enabled).<br />
<span class="par">[cmd]: Command to execute. Stdout is checked to be an integer, stderr is passed through.</span><br />
<span class="par">[cmd arg i]: Arguments to pass to [cmd].</span><br />
<span class="ret"><strong>returns</strong>: Stdout of [cmd], if it is an integer and an undefined string otherwise. The exit code is that of the executed command. <a href="#B_E">B_E</a> is called if the output is <em>not</em> an integer.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_types_looksLikeArray" class="level4">
<h4>b_types_looksLikeArray [string]</h4>
<p><small><em>types/b_types_looksLikeArray</em></small><br />
Check whether the given String “looks like” a bash array or not.<br />
It may still contain malicious code or whatnot. So you <strong>must not</strong> rely on this function when processing untrusted input.<br />
<span class="par">[string]: The string to check. Use <code>&quot;$(declare -p var)&quot;</code> on variables to obtain it.</span><br />
<span class="ret"><strong>returns</strong>: Nothing, but sets a zero exit code if the given string looks like it could be <code>eval</code>’ed to a bash array. References (<code>declare -n</code>) will result in a non-zero exit code.</span></p>
</section>
<section id="b_types_assertLooksLikeArray" class="level4">
<h4>b_types_assertLooksLikeArray [string] [error msg]</h4>
<p><small><em>types/b_types_assertLooksLikeArray</em></small><br />
Check whether the given String “looks like” a bash array and if not, error out.<br />
It may still contain malicious code or whatnot. So you <strong>must not</strong> rely on this function when processing untrusted input.<br />
<span class="par">[string]: The string to check. Use <code>&quot;$(declare -p var)&quot;</code> on variables to obtain it.</span><br />
<span class="par">[error msg]: Error message to use, if the check fails (optional).</span><br />
<span class="ret"><strong>returns</strong>: Nothing. If doesn’t look like a bash array, <a href="#B_E">B_E</a> is called.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
<section id="b_types_looksLikeMap" class="level4">
<h4>b_types_looksLikeMap [string]</h4>
<p><small><em>types/b_types_looksLikeMap</em></small><br />
Check whether the given String “looks like” a bash map / associative array or not.<br />
It may still contain malicious code or whatnot. So you <strong>must not</strong> rely on this function when processing untrusted input.<br />
<span class="par">[string]: The string to check. Use <code>&quot;$(declare -p var)&quot;</code> on variables to obtain it.</span><br />
<span class="ret"><strong>returns</strong>: Nothing, but sets a zero exit code if the given string looks like it could be <code>eval</code>’ed to a bash associative array. References (<code>declare -n</code>) will result in a non-zero exit code.</span></p>
</section>
<section id="b_types_assertLooksLikeMap" class="level4">
<h4>b_types_assertLooksLikeMap [string] [error msg]</h4>
<p><small><em>types/b_types_assertLooksLikeMap</em></small><br />
Check whether the given String “looks like” a bash map / associative array and if not, error out.<br />
It may still contain malicious code or whatnot. So you <strong>must not</strong> rely on this function when processing untrusted input.<br />
<span class="par">[string]: The string to check. Use <code>&quot;$(declare -p var)&quot;</code> on variables to obtain it.</span><br />
<span class="par">[error msg]: Error message to use, if the check fails (optional).</span><br />
<span class="ret"><strong>returns</strong>: Nothing. If doesn’t look like a bash array, <a href="#B_E">B_E</a> is called.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
</section>
</section>
<section id="ui" class="level2">
<h2>ui</h2>
<p>Collection of user interface and user interaction related functions.</p>
<p>Copyright (C) 2020 David Hobach LGPLv3<br />
0.2</p>
<section id="dependencies-30" class="level3">
<h3>Dependencies</h3>
<p>no dependencies</p>
</section>
<section id="imports-30" class="level3">
<h3>Imports</h3>
<p>no imports</p>
</section>
<section id="functions-28" class="level3">
<h3>Functions</h3>
<section id="b_ui_passwordPrompt" class="level4">
<h4>b_ui_passwordPrompt [output var] [ui mode] [prompt string]</h4>
<p><small><em>ui/b_ui_passwordPrompt</em></small><br />
Prompt the user for a password. Should run inside the parent process (i.e. not inside a subshell).<br />
Once you do not need the password anymore, it is recommended to wipe it from memory as such:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true"></a><span class="co">#overwrite the password in memory with zeroes, then free it</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true"></a><span class="va">pass=</span><span class="st">&quot;</span><span class="va">${pass//</span>?<span class="va">/</span>0<span class="va">}</span><span class="st">&quot;</span> ; <span class="va">pass=</span><span class="st">&quot;&quot;</span></span></code></pre></div>
<p><span class="par">[output var]: The name of the variable to write the password to.</span><br />
<span class="par">[ui mode]: How to request the password from the user: auto|gui|tty (default: auto).</span><br />
<span class="par">[prompt string]: The string to present to the user asking for the password (default: “Password:”).</span><br />
<span class="ret"><strong>returns</strong>: Nothing. Sets a non-zero exit code on errors.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
</section>
</section>
<section id="wm" class="level2">
<h2>wm</h2>
<p>Collection of functions related to window managers.</p>
<p>Copyright (C) 2020 David Hobach LGPLv3<br />
0.1</p>
<section id="dependencies-31" class="level3">
<h3>Dependencies</h3>
<p>wmctrl</p>
</section>
<section id="imports-31" class="level3">
<h3>Imports</h3>
<p>no imports</p>
</section>
<section id="functions-29" class="level3">
<h3>Functions</h3>
<section id="b_wm_getActiveWindowProperties" class="level4">
<h4>b_wm_getActiveWindowProperties [variable name]</h4>
<p><small><em>wm/b_wm_getActiveWindowProperties</em></small><br />
Retrieve information about the currently active windows.<br />
<span class="par">[variable name]: Name of the associative array to use as output.</span><br />
<span class="ret"><strong>returns</strong>: A string specifying an associative array in bash syntax. You can eval that string to obtain all relevant data. On errors <a href="#B_E">B_E</a> is called.</span><br />
The information is returned as an associative array containing the following data:<br />
[window ID]_[id] = hexadecimal window ID<br />
[window ID]_[desktop] = desktop number<br />
[window ID]_[pid] = PID of the window<br />
[window ID]_[x] = x-offset<br />
[window ID]_[y] = y-offset<br />
[window ID]_[width] = window width<br />
[window ID]_[height] = window height<br />
[window ID]_[class] = window class name<br />
[window ID]_[client] = client machine name<br />
[window ID]_[title] = window title<br />
Missing data may result in an empty String for the respective property.<br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
</section>
</section>
<section id="teststest_common.bash" class="level2">
<h2>tests/test_common.bash</h2>
<p>Some code and vars meant to be shared across bats tests.</p>
<p>Copyright (C) 2018 David Hobach LGPLv3<br />
0.5</p>
<section id="dependencies-32" class="level3">
<h3>Dependencies</h3>
<p>no dependencies</p>
</section>
<section id="imports-32" class="level3">
<h3>Imports</h3>
<p>no imports</p>
</section>
<section id="global-variables-10" class="level3">
<h3>Global Variables</h3>
<section id="TEST_STATE" class="level4">
<h4>TEST_STATE</h4>
<p><small><em>tests/test_common.bash/TEST_STATE</em></small><br />
A map which can be used to create a persistent state across multiple tests.<br />
By default, bats creates a new shell environment for each test it runs, resetting all changes to global variables.<br />
The state can be managed with the load/save/clearBlibTestState functions below.</p>
</section>
</section>
<section id="functions-30" class="level3">
<h3>Functions</h3>
<section id="loadBlib" class="level4">
<h4>loadBlib</h4>
<p><small><em>tests/test_common.bash/loadBlib</em></small><br />
Loads blib for testing.<br />
<span class="ret"><strong>returns</strong>: Nothing</span></p>
</section>
<section id="skipIfNoUserData" class="level4">
<h4>skipIfNoUserData</h4>
<p><small><em>tests/test_common.bash/skipIfNoUserData</em></small><br />
Skip the test if no user data was found.<br />
<span class="ret"><strong>returns</strong>: Nothing.</span></p>
</section>
<section id="skipIfCommandMissing" class="level4">
<h4>skipIfCommandMissing [command]</h4>
<p><small><em>tests/test_common.bash/skipIfCommandMissing</em></small><br />
Skip the test if the given command is not installed.<br />
<span class="ret"><strong>returns</strong>: Nothing.</span></p>
</section>
<section id="skipIfNotQubesDom0" class="level4">
<h4>skipIfNotQubesDom0</h4>
<p><small><em>tests/test_common.bash/skipIfNotQubesDom0</em></small><br />
Skip the test if we’re not running inside Qubes OS dom0.<br />
<span class="ret"><strong>returns</strong>: Nothing.</span></p>
</section>
<section id="skipIfNotRoot" class="level4">
<h4>skipIfNotRoot</h4>
<p><small><em>tests/test_common.bash/skipIfNotRoot</em></small><br />
Skip the test if root is not available.<br />
<span class="ret"><strong>returns</strong>: Nothing.</span></p>
</section>
<section id="loadBlibTestState" class="level4">
<h4>loadBlibTestState</h4>
<p><small><em>tests/test_common.bash/loadBlibTestState</em></small><br />
Load the <a href="#TEST_STATE">TEST_STATE</a> with the data that was saved last via <a href="#saveBlibState">saveBlibState</a>. If you want to use <a href="#TEST_STATE">TEST_STATE</a>, call this function during test setup.<br />
<span class="ret"><strong>returns</strong>: Nothing.</span></p>
</section>
<section id="saveBlibTestState" class="level4">
<h4>saveBlibTestState</h4>
<p><small><em>tests/test_common.bash/saveBlibTestState</em></small><br />
Save the current <a href="#TEST_STATE">TEST_STATE</a> to make it available for further tests.<br />
<span class="ret"><strong>returns</strong>: Nothing.</span></p>
</section>
<section id="clearBlibTestState" class="level4">
<h4>clearBlibTestState</h4>
<p><small><em>tests/test_common.bash/clearBlibTestState</em></small><br />
Clears the current test state and removes its persistent files.<br />
<span class="ret"><strong>returns</strong>: Nothing.</span></p>
</section>
<section id="testGetterSetter" class="level4">
<h4>testGetterSetter [setter function] [value to set] [reset]</h4>
<p><small><em>tests/test_common.bash/testGetterSetter</em></small><br />
Executes the given setter function <em>in the current environment</em> and makes sure the respective getter function (assumed to have the same name with just a <em>get</em> instead of <em>set</em>) returns that value.<br />
<span class="par">[setter function]: name of the setter function to call</span><br />
<span class="par">[value to set]: value to set with the setter function</span><br />
<span class="par">[reset]: if set to 0 (default), reset the value back to its original value after testing the setter function</span><br />
<span class="ret"><strong>returns</strong>: nothing, but errors out on test failures</span></p>
</section>
<section id="startTimer" class="level4">
<h4>startTimer</h4>
<p><small><em>tests/test_common.bash/startTimer</em></small><br />
Start a new time measurement window.<br />
<span class="ret"><strong>returns</strong>: nothing</span></p>
</section>
<section id="endTimer" class="level4">
<h4>endTimer</h4>
<p><small><em>tests/test_common.bash/endTimer</em></small><br />
Get the differencee in time in seconds since the last time <a href="#startTimer">startTimer</a> was called.<br />
<span class="ret"><strong>returns</strong>: time difference in seconds</span></p>
</section>
<section id="funcTimeout" class="level4">
<h4>funcTimeout [timeout] [function] <a href="#args">args</a></h4>
<p><small><em>tests/test_common.bash/funcTimeout</em></small><br />
Run the given function with a timeout inside a subshell.<br />
<span class="par">[timeout]: Timeout in seconds after which to terminate the function.</span><br />
<span class="par">[function]: The function to execute.</span><br />
<span class="par">[args]: Function arguments.</span><br />
<span class="ret"><strong>returns</strong>: An exit code of 124, if the function timed out. Otherwise returns whatever the function returned.</span></p>
</section>
<section id="runSL" class="level4">
<h4>runSL [commands]</h4>
<p><small><em>tests/test_common.bash/runSL</em></small><br />
A version of the bats <code>run</code> command which makes sure that the bash runtime state does not change after running the given commands (SL = stateless).<br />
This <em>should</em> be the default method of executing tests for blib.<br />
If the given commands are expected to change the state, use <a href="#runSC">runSC</a> instead. In particular the default bats <code>run</code> should almost never be used.<br />
Also prints an identifier for easier debugging. The identifier starts at 1 on the first run call per test and increases with each further run call.<br />
<em>WARNING</em>: As the bats <code>run</code> it runs inside a subshell. So don’t expect changes to persist.<br />
<span class="par">[commands]: The commands to run.</span><br />
<span class="ret"><strong>returns</strong>: whatever bats run returns</span></p>
</section>
<section id="runSC" class="level4">
<h4>runSC [commands]</h4>
<p><small><em>tests/test_common.bash/runSC</em></small><br />
A version of the bats <code>run</code> command which ignore changes to the bash runtime state (SC = state changing).<br />
If the given commands are expected to be stateless, use <a href="#runSL">runSL</a> instead. In particular the default bats <code>run</code> should almost never be used.<br />
Also prints an identifier for easier debugging. The identifier starts at 1 on the first run call per test and increases with each further run call.<br />
<em>WARNING</em>: As the bats <code>run</code> it runs inside a subshell. So don’t expect changes to persist.<br />
<span class="par">[commands]: The commands to run.</span><br />
<span class="ret"><strong>returns</strong>: whatever bats run returns</span></p>
</section>
<section id="assertReadOnly" class="level4">
<h4>assertReadOnly [path]</h4>
<p><small><em>tests/test_common.bash/assertReadOnly</em></small><br />
Assert that the given file or directory is read-only by attempting to write to it.<br />
<span class="par">[path]: Full path to a file or directory. If it is not r/o, it may be changed.</span><br />
<span class="ret"><strong>returns</strong>: A zero exit code, if the path is r/o.</span><br />
<span class="ann"><em><span class="citation" data-cites="B_E">@B_E</span></em></span></p>
</section>
</section>
</section>
<section id="testsuser_test_data.bash" class="level2">
<h2>tests/user_test_data.bash</h2>
<p>Example of a user_test_data file.<br />
That file is meant for static bash varibles that must be set <em>by the user</em> (as they may e.g. be OS specific) in order for some tests to work.<br />
If that file doesn’t exist or could not be loaded, these tests may be skipped by blib.</p>
<p>Copyright (C) 2018 David Hobach LGPLv3<br />
0.5</p>
<section id="dependencies-33" class="level3">
<h3>Dependencies</h3>
<p>no dependencies</p>
</section>
<section id="imports-33" class="level3">
<h3>Imports</h3>
<p>no imports</p>
</section>
<section id="global-variables-11" class="level3">
<h3>Global Variables</h3>
<section id="UTD_ONLINE" class="level4">
<h4>UTD_ONLINE</h4>
<p><small><em>tests/user_test_data.bash/UTD_ONLINE</em></small><br />
Whether or not the test machine is connected to the Internet.</p>
</section>
<section id="UTD_OS" class="level4">
<h4>UTD_OS</h4>
<p><small><em>tests/user_test_data.bash/UTD_OS</em></small><br />
Specify your operating system here, currently supported values:<br />
debian|fedora|red hat|centos|ubuntu|opensuse|qubes dom0|other<br />
Qubes VMs should be specified with their OS.</p>
</section>
<section id="UTD_QUBES" class="level4">
<h4>UTD_QUBES</h4>
<p><small><em>tests/user_test_data.bash/UTD_QUBES</em></small><br />
Specify whether you are running Qubes OS and in what environment here, possible values:<br />
no|vm|dom0</p>
</section>
<section id="UTD_QUBES_TESTVM" class="level4">
<h4>UTD_QUBES_TESTVM</h4>
<p><small><em>tests/user_test_data.bash/UTD_QUBES_TESTVM</em></small><br />
If you’re using Qubes OS, please specify a <em>disposable</em> virtual machine with a static name to be used for testing here. This test VM may crash, be destroyed or whatever - so please don’t use a production VM!<br />
Apart from that, the tests will be conducted with disposable VMs with dynamic names using your default template.</p>
<p>Example command to create such a test VM:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true"></a><span class="ex">qvm-create</span> --class DispVM --prop netvm=<span class="st">&#39;&#39;</span> --template nonet-dvm -l red d-testing</span></code></pre></div>
<p>Can safely be ignored if you don’t run Qubes OS-related tests.</p>
</section>
<section id="UTD_QUBES_TESTVM_PERSISTENT" class="level4">
<h4>UTD_QUBES_TESTVM_PERSISTENT</h4>
<p><small><em>tests/user_test_data.bash/UTD_QUBES_TESTVM_PERSISTENT</em></small><br />
If you’re using Qubes OS, please specify a <em>persistent/non-disposable</em> virtual machine with a static name to be used for testing here. This test VM may crash, be destroyed or whatever - so please don’t use a production VM!</p>
<p>Example command to create such a test VM:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true"></a><span class="ex">qvm-create</span> -l red --prop netvm=<span class="st">&#39;&#39;</span> testing-pers</span></code></pre></div>
<p>Can safely be ignored if you don’t run Qubes OS-related tests.</p>
</section>
<section id="UTD_QUBES_DISPVM_TEMPLATE" class="level4">
<h4>UTD_QUBES_DISPVM_TEMPLATE</h4>
<p><small><em>tests/user_test_data.bash/UTD_QUBES_DISPVM_TEMPLATE</em></small><br />
Qubes OS disposable VM template to use for testing. The test code will create disposable VMs from that template. It will <em>not</em> modify the template itself.<br />
If no template is specified, the Qubes OS default template is used.</p>
</section>
<section id="UTD_PW_FREE_USER" class="level4">
<h4>UTD_PW_FREE_USER</h4>
<p><small><em>tests/user_test_data.bash/UTD_PW_FREE_USER</em></small><br />
A user that allows password-less logons with sudo or su for testing.</p>
<p>If you run bats as root, neither sudo nor su should ask for a password.<br />
Tests requiring admin privileges (e.g. mounting devices) may require this to be root or skip otherwise.</p>
</section>
</section>
</section>
<section id="reflist" class="level2">
<h2>Reference List</h2>
<p><a href="#assertReadOnly">assertReadOnly</a></p>
<p><a href="#B_ARGS">B_ARGS</a></p>
<p><a href="#b_args_assertOptions">b_args_assertOptions</a></p>
<p><a href="#b_args_get">b_args_get</a></p>
<p><a href="#b_args_getAll">b_args_getAll</a></p>
<p><a href="#b_args_getAllOptions">b_args_getAllOptions</a></p>
<p><a href="#b_args_getCount">b_args_getCount</a></p>
<p><a href="#b_args_getInt">b_args_getInt</a></p>
<p><a href="#b_args_getOption">b_args_getOption</a></p>
<p><a href="#b_args_getOptionCount">b_args_getOptionCount</a></p>
<p><a href="#b_args_getOptionInt">b_args_getOptionInt</a></p>
<p><a href="#b_args_getOptionParamSeparator">b_args_getOptionParamSeparator</a></p>
<p><a href="#b_args_init">b_args_init</a></p>
<p><a href="#B_ARGS_OPTS">B_ARGS_OPTS</a></p>
<p><a href="#b_args_parse">b_args_parse</a></p>
<p><a href="#b_args_setOptionParamSeparator">b_args_setOptionParamSeparator</a></p>
<p><a href="#b_arr_contains">b_arr_contains</a></p>
<p><a href="#b_arr_join">b_arr_join</a></p>
<p><a href="#b_arr_mapsAreEqual">b_arr_mapsAreEqual</a></p>
<p><a href="#b_arr_toList">b_arr_toList</a></p>
<p><a href="#b_assertLastPipes">b_assertLastPipes</a></p>
<p><a href="#b_cachingMessageHandler">b_cachingMessageHandler</a></p>
<p><a href="#B_CALLER_NAME">B_CALLER_NAME</a></p>
<p><a href="#b_cdoc_cbPrintFirstParam">b_cdoc_cbPrintFirstParam</a></p>
<p><a href="#b_cdoc_cbPrintNewline">b_cdoc_cbPrintNewline</a></p>
<p><a href="#b_cdoc_generate">b_cdoc_generate</a></p>
<p><a href="#b_cdoc_generateBlibStyle">b_cdoc_generateBlibStyle</a></p>
<p><a href="#b_cdoc_getBlockCallback">b_cdoc_getBlockCallback</a></p>
<p><a href="#b_cdoc_getDocumentBeginCallback">b_cdoc_getDocumentBeginCallback</a></p>
<p><a href="#b_cdoc_getDocumentEndCallback">b_cdoc_getDocumentEndCallback</a></p>
<p><a href="#b_cdoc_getExtractionRegex">b_cdoc_getExtractionRegex</a></p>
<p><a href="#b_cdoc_getFileCallback">b_cdoc_getFileCallback</a></p>
<p><a href="#b_cdoc_getPostProcessingCallback">b_cdoc_getPostProcessingCallback</a></p>
<p><a href="#b_cdoc_setBlockCallback">b_cdoc_setBlockCallback</a></p>
<p><a href="#b_cdoc_setDocumentBeginCallback">b_cdoc_setDocumentBeginCallback</a></p>
<p><a href="#b_cdoc_setDocumentEndCallback">b_cdoc_setDocumentEndCallback</a></p>
<p><a href="#b_cdoc_setExtractionRegex">b_cdoc_setExtractionRegex</a></p>
<p><a href="#b_cdoc_setFileCallback">b_cdoc_setFileCallback</a></p>
<p><a href="#b_cdoc_setPostProcessingCallback">b_cdoc_setPostProcessingCallback</a></p>
<p><a href="#b_checkVersion">b_checkVersion</a></p>
<p><a href="#B_CONF_DIR">B_CONF_DIR</a></p>
<p><a href="#b_daemon_getPid">b_daemon_getPid</a></p>
<p><a href="#B_DAEMON_ID">B_DAEMON_ID</a></p>
<p><a href="#b_daemon_init">b_daemon_init</a></p>
<p><a href="#b_daemon_restart">b_daemon_restart</a></p>
<p><a href="#b_daemon_sendSignal">b_daemon_sendSignal</a></p>
<p><a href="#b_daemon_start">b_daemon_start</a></p>
<p><a href="#b_daemon_status">b_daemon_status</a></p>
<p><a href="#b_daemon_statusPid">b_daemon_statusPid</a></p>
<p><a href="#b_daemon_stop">b_daemon_stop</a></p>
<p><a href="#b_date_add">b_date_add</a></p>
<p><a href="#b_date_addDays">b_date_addDays</a></p>
<p><a href="#b_date_diff">b_date_diff</a></p>
<p><a href="#b_date_getFileModAge">b_date_getFileModAge</a></p>
<p><a href="#b_defaultErrorHandler">b_defaultErrorHandler</a></p>
<p><a href="#b_defaultMessageHandler">b_defaultMessageHandler</a></p>
<p><a href="#b_delay_execute">b_delay_execute</a></p>
<p><a href="#B_DELAY_EXECUTED">B_DELAY_EXECUTED</a></p>
<p><a href="#b_delay_getCommandAt">b_delay_getCommandAt</a></p>
<p><a href="#b_delay_to">b_delay_to</a></p>
<p><a href="#b_deps">b_deps</a></p>
<p><a href="#b_dmcrypt_close">b_dmcrypt_close</a></p>
<p><a href="#b_dmcrypt_createLuks">b_dmcrypt_createLuks</a></p>
<p><a href="#b_dmcrypt_getMapperName">b_dmcrypt_getMapperName</a></p>
<p><a href="#b_dmcrypt_init">b_dmcrypt_init</a></p>
<p><a href="#b_dmcrypt_isOpen">b_dmcrypt_isOpen</a></p>
<p><a href="#b_dmcrypt_open">b_dmcrypt_open</a></p>
<p><a href="#b_dom0_applyFirewall">b_dom0_applyFirewall</a></p>
<p><a href="#b_dom0_attachDevice">b_dom0_attachDevice</a></p>
<p><a href="#b_dom0_attachFile">b_dom0_attachFile</a></p>
<p><a href="#b_dom0_attachVMDisk">b_dom0_attachVMDisk</a></p>
<p><a href="#b_dom0_clearFirewall">b_dom0_clearFirewall</a></p>
<p><a href="#b_dom0_closeCrypt">b_dom0_closeCrypt</a></p>
<p><a href="#b_dom0_copy">b_dom0_copy</a></p>
<p><a href="#b_dom0_createLoopDeviceIfNecessary">b_dom0_createLoopDeviceIfNecessary</a></p>
<p><a href="#b_dom0_crossAttachDevice">b_dom0_crossAttachDevice</a></p>
<p><a href="#b_dom0_crossAttachFile">b_dom0_crossAttachFile</a></p>
<p><a href="#b_dom0_crossCopy">b_dom0_crossCopy</a></p>
<p><a href="#b_dom0_detachDevice">b_dom0_detachDevice</a></p>
<p><a href="#b_dom0_disconnectEventLoop">b_dom0_disconnectEventLoop</a></p>
<p><a href="#b_dom0_ensureHalted">b_dom0_ensureHalted</a></p>
<p><a href="#b_dom0_ensureRunning">b_dom0_ensureRunning</a></p>
<p><a href="#b_dom0_enterEventLoop">b_dom0_enterEventLoop</a></p>
<p><a href="#b_dom0_execFuncIn">b_dom0_execFuncIn</a></p>
<p><a href="#b_dom0_execIn">b_dom0_execIn</a></p>
<p><a href="#b_dom0_execStrIn">b_dom0_execStrIn</a></p>
<p><a href="#b_dom0_exists">b_dom0_exists</a></p>
<p><a href="#b_dom0_getDefaultPoolDriver">b_dom0_getDefaultPoolDriver</a></p>
<p><a href="#b_dom0_getDispVMs">b_dom0_getDispVMs</a></p>
<p><a href="#b_dom0_getPoolDriver">b_dom0_getPoolDriver</a></p>
<p><a href="#b_dom0_getQvmBlockInfo">b_dom0_getQvmBlockInfo</a></p>
<p><a href="#b_dom0_getVMDeps">b_dom0_getVMDeps</a></p>
<p><a href="#b_dom0_isHalted">b_dom0_isHalted</a></p>
<p><a href="#b_dom0_isMountedIn">b_dom0_isMountedIn</a></p>
<p><a href="#b_dom0_isRunning">b_dom0_isRunning</a></p>
<p><a href="#b_dom0_mountIfNecessary">b_dom0_mountIfNecessary</a></p>
<p><a href="#b_dom0_openCrypt">b_dom0_openCrypt</a></p>
<p><a href="#b_dom0_parseQvmBlock">b_dom0_parseQvmBlock</a></p>
<p><a href="#b_dom0_qvmRun">b_dom0_qvmRun</a></p>
<p><a href="#B_DOM0_QVM_RUN_PARAMS">B_DOM0_QVM_RUN_PARAMS</a></p>
<p><a href="#b_dom0_removeUnusedLoopDevice">b_dom0_removeUnusedLoopDevice</a></p>
<p><a href="#b_dom0_setVMDeps">b_dom0_setVMDeps</a></p>
<p><a href="#b_dom0_startDispVM">b_dom0_startDispVM</a></p>
<p><a href="#b_dom0_testMultiple">b_dom0_testMultiple</a></p>
<p><a href="#B_DOM0_VM_STDERR">B_DOM0_VM_STDERR</a></p>
<p><a href="#b_dom0_waitForFileIn">b_dom0_waitForFileIn</a></p>
<p><a href="#B_E">B_E</a></p>
<p><a href="#b_enforceUser">b_enforceUser</a></p>
<p><a href="#B_ERR">B_ERR</a></p>
<p><a href="#b_error">b_error</a></p>
<p><a href="#b_execFuncAs">b_execFuncAs</a></p>
<p><a href="#b_execFuncInCurrentContext">b_execFuncInCurrentContext</a></p>
<p><a href="#b_fd_closeAll">b_fd_closeAll</a></p>
<p><a href="#b_fd_closeNonStandard">b_fd_closeNonStandard</a></p>
<p><a href="#b_fd_getOpen">b_fd_getOpen</a></p>
<p><a href="#b_flog_close">b_flog_close</a></p>
<p><a href="#b_flog_defaultHeader">b_flog_defaultHeader</a></p>
<p><a href="#b_flog_getDateFormat">b_flog_getDateFormat</a></p>
<p><a href="#b_flog_getHeaderFunction">b_flog_getHeaderFunction</a></p>
<p><a href="#b_flog_getLogReductionLinesLowerBound">b_flog_getLogReductionLinesLowerBound</a></p>
<p><a href="#b_flog_getLogReductionLinesUpperBound">b_flog_getLogReductionLinesUpperBound</a></p>
<p><a href="#b_flog_headerDateScriptSeverity">b_flog_headerDateScriptSeverity</a></p>
<p><a href="#b_flog_headerDateSeverity">b_flog_headerDateSeverity</a></p>
<p><a href="#b_flog_init">b_flog_init</a></p>
<p><a href="#b_flog_log">b_flog_log</a></p>
<p><a href="#b_flog_messageHandler">b_flog_messageHandler</a></p>
<p><a href="#b_flog_printSeverity">b_flog_printSeverity</a></p>
<p><a href="#b_flog_setDateFormat">b_flog_setDateFormat</a></p>
<p><a href="#b_flog_setHeaderFunction">b_flog_setHeaderFunction</a></p>
<p><a href="#b_flog_setLogReductionLinesApprox">b_flog_setLogReductionLinesApprox</a></p>
<p><a href="#b_flog_setLogReductionLinesLowerBound">b_flog_setLogReductionLinesLowerBound</a></p>
<p><a href="#b_flog_setLogReductionLinesUpperBound">b_flog_setLogReductionLinesUpperBound</a></p>
<p><a href="#B_FLOG_SEV">B_FLOG_SEV</a></p>
<p><a href="#b_fs_createLoopDeviceIfNecessary">b_fs_createLoopDeviceIfNecessary</a></p>
<p><a href="#b_fs_enumerate">b_fs_enumerate</a></p>
<p><a href="#b_fs_getBlockDevice">b_fs_getBlockDevice</a></p>
<p><a href="#b_fs_getLineCount">b_fs_getLineCount</a></p>
<p><a href="#b_fs_getMountpoints">b_fs_getMountpoints</a></p>
<p><a href="#b_fs_isEmptyDir">b_fs_isEmptyDir</a></p>
<p><a href="#b_fs_isRotatingDrive">b_fs_isRotatingDrive</a></p>
<p><a href="#b_fs_mountIfNecessary">b_fs_mountIfNecessary</a></p>
<p><a href="#b_fs_parseSize">b_fs_parseSize</a></p>
<p><a href="#b_fs_removeRelativelySafely">b_fs_removeRelativelySafely</a></p>
<p><a href="#b_fs_removeUnusedLoopDevice">b_fs_removeUnusedLoopDevice</a></p>
<p><a href="#b_fs_removeWithOverwrite">b_fs_removeWithOverwrite</a></p>
<p><a href="#b_fs_waitForFile">b_fs_waitForFile</a></p>
<p><a href="#b_generateStandalone">b_generateStandalone</a></p>
<p><a href="#b_getBlibModules">b_getBlibModules</a></p>
<p><a href="#b_getDefaultMessageHandlerIntermediate">b_getDefaultMessageHandlerIntermediate</a></p>
<p><a href="#b_getDefaultMessageHandlerPrefix">b_getDefaultMessageHandlerPrefix</a></p>
<p><a href="#b_getErrorHandler">b_getErrorHandler</a></p>
<p><a href="#b_getMessageHandler">b_getMessageHandler</a></p>
<p><a href="#b_hash_file">b_hash_file</a></p>
<p><a href="#b_hash_str">b_hash_str</a></p>
<p><a href="#B_HTTP_CHECKURLS">B_HTTP_CHECKURLS</a></p>
<p><a href="#b_http_getOnlineStatus">b_http_getOnlineStatus</a></p>
<p><a href="#b_http_rawUrlDecode">b_http_rawUrlDecode</a></p>
<p><a href="#b_http_rawUrlEncode">b_http_rawUrlEncode</a></p>
<p><a href="#b_http_testProxy">b_http_testProxy</a></p>
<p><a href="#b_import">b_import</a></p>
<p><a href="#b_info">b_info</a></p>
<p><a href="#b_ini_assertNames">b_ini_assertNames</a></p>
<p><a href="#b_ini_get">b_ini_get</a></p>
<p><a href="#b_ini_getBool">b_ini_getBool</a></p>
<p><a href="#b_ini_getInt">b_ini_getInt</a></p>
<p><a href="#b_ini_getString">b_ini_getString</a></p>
<p><a href="#b_ini_read">b_ini_read</a></p>
<p><a href="#b_initCachingMessageHandler">b_initCachingMessageHandler</a></p>
<p><a href="#b_ipcm_change">b_ipcm_change</a></p>
<p><a href="#b_ipcm_get">b_ipcm_get</a></p>
<p><a href="#b_ipcm_getNamespace">b_ipcm_getNamespace</a></p>
<p><a href="#b_ipcm_setNamespace">b_ipcm_setNamespace</a></p>
<p><a href="#b_ipcm_unsetNamespace">b_ipcm_unsetNamespace</a></p>
<p><a href="#b_ipcv_load">b_ipcv_load</a></p>
<p><a href="#b_ipcv_loadNamespace">b_ipcv_loadNamespace</a></p>
<p><a href="#b_ipcv_save">b_ipcv_save</a></p>
<p><a href="#b_ipcv_unset">b_ipcv_unset</a></p>
<p><a href="#b_ipcv_unsetNamespace">b_ipcv_unsetNamespace</a></p>
<p><a href="#b_isFunction">b_isFunction</a></p>
<p><a href="#b_isModule">b_isModule</a></p>
<p><a href="#b_keys_add">b_keys_add</a></p>
<p><a href="#b_keys_close">b_keys_close</a></p>
<p><a href="#b_keys_delete">b_keys_delete</a></p>
<p><a href="#b_keys_get">b_keys_get</a></p>
<p><a href="#b_keys_getAll">b_keys_getAll</a></p>
<p><a href="#b_keys_getContent">b_keys_getContent</a></p>
<p><a href="#b_keys_getDefaultStore">b_keys_getDefaultStore</a></p>
<p><a href="#b_keys_init">b_keys_init</a></p>
<p><a href="#B_LIB_DIR">B_LIB_DIR</a></p>
<p><a href="#b_listContains">b_listContains</a></p>
<p><a href="#b_meta_getClearDeps">b_meta_getClearDeps</a></p>
<p><a href="#b_meta_getClearImports">b_meta_getClearImports</a></p>
<p><a href="#b_mtx_create">b_mtx_create</a></p>
<p><a href="#b_mtx_forceRelease">b_mtx_forceRelease</a></p>
<p><a href="#b_mtx_getSleepTime">b_mtx_getSleepTime</a></p>
<p><a href="#b_mtx_pass">b_mtx_pass</a></p>
<p><a href="#b_mtx_release">b_mtx_release</a></p>
<p><a href="#b_mtx_setSleepTime">b_mtx_setSleepTime</a></p>
<p><a href="#b_mtx_try">b_mtx_try</a></p>
<p><a href="#b_mtx_waitFor">b_mtx_waitFor</a></p>
<p><a href="#b_multiw_getMaxHangTime">b_multiw_getMaxHangTime</a></p>
<p><a href="#b_multiw_remove">b_multiw_remove</a></p>
<p><a href="#b_multiw_setMaxHangTime">b_multiw_setMaxHangTime</a></p>
<p><a href="#b_multiw_write">b_multiw_write</a></p>
<p><a href="#B_NET_CHECKHOSTS">B_NET_CHECKHOSTS</a></p>
<p><a href="#B_NET_DNSSERVERS">B_NET_DNSSERVERS</a></p>
<p><a href="#b_net_getDNSStatus">b_net_getDNSStatus</a></p>
<p><a href="#b_nop">b_nop</a></p>
<p><a href="#b_notify_send">b_notify_send</a></p>
<p><a href="#b_notify_sendNoError">b_notify_sendNoError</a></p>
<p><a href="#b_notify_waitForUserDbus">b_notify_waitForUserDbus</a></p>
<p><a href="#b_osid_init">b_osid_init</a></p>
<p><a href="#b_osid_isCentOS">b_osid_isCentOS</a></p>
<p><a href="#b_osid_isDebian">b_osid_isDebian</a></p>
<p><a href="#b_osid_isDebianLike">b_osid_isDebianLike</a></p>
<p><a href="#b_osid_isFedora">b_osid_isFedora</a></p>
<p><a href="#b_osid_isFedoraLike">b_osid_isFedoraLike</a></p>
<p><a href="#b_osid_isOpenSuse">b_osid_isOpenSuse</a></p>
<p><a href="#b_osid_isQubesDom0">b_osid_isQubesDom0</a></p>
<p><a href="#b_osid_isQubesVM">b_osid_isQubesVM</a></p>
<p><a href="#b_osid_isRedHat">b_osid_isRedHat</a></p>
<p><a href="#b_osid_isUbuntu">b_osid_isUbuntu</a></p>
<p><a href="#b_printStackTrace">b_printStackTrace</a></p>
<p><a href="#b_proc_childExists">b_proc_childExists</a></p>
<p><a href="#b_proc_killAndWait">b_proc_killAndWait</a></p>
<p><a href="#b_proc_killByRegexAndWait">b_proc_killByRegexAndWait</a></p>
<p><a href="#b_proc_pidExists">b_proc_pidExists</a></p>
<p><a href="#b_proc_resolveSignal">b_proc_resolveSignal</a></p>
<p><a href="#b_proc_waitForPid">b_proc_waitForPid</a></p>
<p><a href="#B_RC">B_RC</a></p>
<p><a href="#b_resetErrorHandler">b_resetErrorHandler</a></p>
<p><a href="#B_SCRIPT">B_SCRIPT</a></p>
<p><a href="#B_SCRIPT_DIR">B_SCRIPT_DIR</a></p>
<p><a href="#B_SCRIPT_NAME">B_SCRIPT_NAME</a></p>
<p><a href="#b_setBE">b_setBE</a></p>
<p><a href="#b_setDefaultMessageHandlerIntermediate">b_setDefaultMessageHandlerIntermediate</a></p>
<p><a href="#b_setDefaultMessageHandlerPrefix">b_setDefaultMessageHandlerPrefix</a></p>
<p><a href="#b_setErrorHandler">b_setErrorHandler</a></p>
<p><a href="#b_setMessageHandler">b_setMessageHandler</a></p>
<p><a href="#b_silence">b_silence</a></p>
<p><a href="#b_sqlite3_close">b_sqlite3_close</a></p>
<p><a href="#b_sqlite3_exec">b_sqlite3_exec</a></p>
<p><a href="#b_sqlite3_getOpen">b_sqlite3_getOpen</a></p>
<p><a href="#b_sqlite3_open">b_sqlite3_open</a></p>
<p><a href="#b_str_prefixLines">b_str_prefixLines</a></p>
<p><a href="#b_str_stripQuotes">b_str_stripQuotes</a></p>
<p><a href="#b_str_trim">b_str_trim</a></p>
<p><a href="#B_TCOLORS">B_TCOLORS</a></p>
<p><a href="#B_TEST_MODE">B_TEST_MODE</a></p>
<p><a href="#b_traps_add">b_traps_add</a></p>
<p><a href="#b_traps_getCodeFor">b_traps_getCodeFor</a></p>
<p><a href="#b_traps_prepend">b_traps_prepend</a></p>
<p><a href="#b_traps_remove">b_traps_remove</a></p>
<p><a href="#b_types_assertInteger">b_types_assertInteger</a></p>
<p><a href="#b_types_assertLooksLikeArray">b_types_assertLooksLikeArray</a></p>
<p><a href="#b_types_assertLooksLikeMap">b_types_assertLooksLikeMap</a></p>
<p><a href="#B_TYPES_CHECK_NON_BINARY">B_TYPES_CHECK_NON_BINARY</a></p>
<p><a href="#B_TYPES_ENCODING">B_TYPES_ENCODING</a></p>
<p><a href="#b_types_int">b_types_int</a></p>
<p><a href="#b_types_isInteger">b_types_isInteger</a></p>
<p><a href="#b_types_looksLikeArray">b_types_looksLikeArray</a></p>
<p><a href="#b_types_looksLikeMap">b_types_looksLikeMap</a></p>
<p><a href="#B_TYPES_MAX_BYTES">B_TYPES_MAX_BYTES</a></p>
<p><a href="#b_types_parseInteger">b_types_parseInteger</a></p>
<p><a href="#b_types_parseString">b_types_parseString</a></p>
<p><a href="#b_types_str">b_types_str</a></p>
<p><a href="#b_ui_passwordPrompt">b_ui_passwordPrompt</a></p>
<p><a href="#b_version">b_version</a></p>
<p><a href="#b_wm_getActiveWindowProperties">b_wm_getActiveWindowProperties</a></p>
<p><a href="#clearBlibTestState">clearBlibTestState</a></p>
<p><a href="#endTimer">endTimer</a></p>
<p><a href="#funcTimeout">funcTimeout</a></p>
<p><a href="#loadBlib">loadBlib</a></p>
<p><a href="#loadBlibTestState">loadBlibTestState</a></p>
<p><a href="#runSC">runSC</a></p>
<p><a href="#runSL">runSL</a></p>
<p><a href="#saveBlibTestState">saveBlibTestState</a></p>
<p><a href="#skipIfCommandMissing">skipIfCommandMissing</a></p>
<p><a href="#skipIfNotQubesDom0">skipIfNotQubesDom0</a></p>
<p><a href="#skipIfNotRoot">skipIfNotRoot</a></p>
<p><a href="#skipIfNoUserData">skipIfNoUserData</a></p>
<p><a href="#startTimer">startTimer</a></p>
<p><a href="#testGetterSetter">testGetterSetter</a></p>
<p><a href="#TEST_STATE">TEST_STATE</a></p>
<p><a href="#UTD_ONLINE">UTD_ONLINE</a></p>
<p><a href="#UTD_OS">UTD_OS</a></p>
<p><a href="#UTD_PW_FREE_USER">UTD_PW_FREE_USER</a></p>
<p><a href="#UTD_QUBES">UTD_QUBES</a></p>
<p><a href="#UTD_QUBES_DISPVM_TEMPLATE">UTD_QUBES_DISPVM_TEMPLATE</a></p>
<p><a href="#UTD_QUBES_TESTVM">UTD_QUBES_TESTVM</a></p>
<p><a href="#UTD_QUBES_TESTVM_PERSISTENT">UTD_QUBES_TESTVM_PERSISTENT</a></p>
</section>
</body>
</html>
